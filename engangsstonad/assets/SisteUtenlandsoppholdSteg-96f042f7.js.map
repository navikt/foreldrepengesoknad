{"version":3,"file":"SisteUtenlandsoppholdSteg-96f042f7.js","sources":["../../src/sider/steg/utenlandsoppholdSiste/SisteUtenlandsoppholdPeriode.tsx","../../src/sider/steg/utenlandsoppholdSiste/SisteUtenlandsoppholdSteg.tsx"],"sourcesContent":["import { FormattedMessage, IntlShape, useIntl } from 'react-intl';\nimport dayjs from 'dayjs';\nimport { useFormContext } from 'react-hook-form';\nimport { TrashIcon } from '@navikt/aksel-icons';\nimport { Button, VStack } from '@navikt/ds-react';\nimport { date1YearAgo, dateRangesCollide, dateToday } from '@navikt/fp-common';\n\nimport { createCountryOptions } from 'fpcommon/util/countryUtils';\nimport { Datepicker, Select } from '@navikt/fp-form-hooks';\nimport {\n    validateDatesNotEqual,\n    isRequired,\n    validateFromDate,\n    validateToDate,\n} from 'fpcommon/validering/valideringsregler';\nimport { UtenlandsoppholdPeriode } from 'types/Utenlandsopphold';\n\nconst validerPeriodeOverlapp = (\n    intl: IntlShape,\n    alleAndrePerioder: UtenlandsoppholdPeriode[],\n    fom: string,\n    tom: string,\n): string | null => {\n    const dateRanges = alleAndrePerioder.map((u) => ({\n        from: dayjs(u.fom).toDate(),\n        to: dayjs(u.tom).toDate(),\n    }));\n\n    const allDateRanges = dateRanges.concat({\n        from: dayjs(fom).toDate(),\n        to: dayjs(tom).toDate(),\n    });\n\n    if (dateRangesCollide(allDateRanges)) {\n        return intl.formatMessage({\n            id: 'valideringsfeil.utenlandsopphold.overlapp',\n        });\n    }\n    return null;\n};\n\ninterface OwnProps {\n    index: number;\n    fjernOpphold: (index: number) => void;\n}\n\nconst SisteUtenlandsoppholdPeriode: React.FunctionComponent<OwnProps> = ({ index, fjernOpphold }) => {\n    const intl = useIntl();\n\n    const {\n        watch,\n        trigger,\n        formState: { isSubmitted },\n    } = useFormContext<{ utenlandsoppholdSiste12Mnd: UtenlandsoppholdPeriode[] }>();\n\n    const alleAndreUtenlandsopphold = watch(`utenlandsoppholdSiste12Mnd`).filter((_u, i) => i !== index);\n    const fom = watch(`utenlandsoppholdSiste12Mnd.${index}.fom`);\n    const tom = watch(`utenlandsoppholdSiste12Mnd.${index}.tom`);\n\n    const minDateFom = dayjs(date1YearAgo).toDate();\n    const maxDateFom = tom ? dayjs(tom).toDate() : dayjs(dateToday).toDate();\n\n    const minDateTom = fom ? dayjs(fom).toDate() : dayjs(date1YearAgo).toDate();\n    const maxDateTom = dayjs(dateToday).toDate();\n\n    return (\n        <VStack gap=\"5\" align=\"start\">\n            <Select\n                name={`utenlandsoppholdSiste12Mnd.${index}.landkode`}\n                label={\n                    <FormattedMessage id=\"utenlandsopphold.leggTilUtenlandsopphold.spørsmål.hvilketLandHarDuBoddI\" />\n                }\n                validate={[\n                    isRequired(\n                        intl.formatMessage({\n                            id: 'valideringsfeil.leggTilUtenlandsopphold.landDuHarBoddIPåkrevd',\n                        }),\n                    ),\n                ]}\n            >\n                {createCountryOptions().map((o: Record<string, any>) => (\n                    <option key={o[0]} value={o[0]}>\n                        {o[1]}\n                    </option>\n                ))}\n            </Select>\n            <Datepicker\n                name={`utenlandsoppholdSiste12Mnd.${index}.fom`}\n                label={<FormattedMessage id=\"utenlandsopphold.leggTilUtenlandsopphold.fraogmed\" />}\n                minDate={minDateFom}\n                maxDate={maxDateFom}\n                validate={[\n                    isRequired(\n                        intl.formatMessage({\n                            id: 'valideringsfeil.leggTilUtenlandsopphold.landFomDuSkalBoIPåkreved',\n                        }),\n                    ),\n                    validateDatesNotEqual(\n                        intl.formatMessage({\n                            id: 'valideringsfeil.fomErLikTom',\n                        }),\n                        tom,\n                    ),\n                    (fomValue) => {\n                        //TODO Del opp denne funksjonen\n                        return validateFromDate(\n                            intl,\n                            dayjs(fomValue).toDate(),\n                            minDateFom,\n                            maxDateFom,\n                            dayjs(tom).toDate(),\n                        );\n                    },\n                    (fomValue) => {\n                        return validerPeriodeOverlapp(intl, alleAndreUtenlandsopphold, fomValue, tom);\n                    },\n                ]}\n                onChange={() => isSubmitted && trigger()}\n            />\n            <Datepicker\n                name={`utenlandsoppholdSiste12Mnd.${index}.tom`}\n                label={<FormattedMessage id=\"utenlandsopphold.leggTilUtenlandsopphold.tilogmed\" />}\n                minDate={minDateTom}\n                maxDate={maxDateTom}\n                validate={[\n                    isRequired(\n                        intl.formatMessage({\n                            id: 'valideringsfeil.leggTilUtenlandsopphold.landTomDuHarBoddIPåkreved',\n                        }),\n                    ),\n                    validateDatesNotEqual(\n                        intl.formatMessage({\n                            id: 'valideringsfeil.tomErLikFom',\n                        }),\n                        fom,\n                    ),\n                    (tomValue) => {\n                        //TODO Del opp denne funksjonen\n                        return validateToDate(\n                            intl,\n                            dayjs(tomValue).toDate(),\n                            minDateTom,\n                            maxDateTom,\n                            dayjs(fom).toDate(),\n                        );\n                    },\n                    (tomValue) => {\n                        return validerPeriodeOverlapp(intl, alleAndreUtenlandsopphold, fom, tomValue);\n                    },\n                ]}\n                onChange={() => isSubmitted && trigger()}\n            />\n            {index > 0 && (\n                <Button\n                    type=\"button\"\n                    variant=\"tertiary\"\n                    size=\"small\"\n                    icon={<TrashIcon aria-hidden />}\n                    onClick={() => fjernOpphold(index)}\n                >\n                    <FormattedMessage id=\"utenlandsopphold.knapp.SlettOpphold\" />\n                </Button>\n            )}\n        </VStack>\n    );\n};\n\nexport default SisteUtenlandsoppholdPeriode;\n","import { Fragment, useCallback, useMemo } from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { useFieldArray, useForm } from 'react-hook-form';\nimport { PlusIcon } from '@navikt/aksel-icons';\nimport { Button, VStack } from '@navikt/ds-react';\nimport { Step } from '@navikt/fp-common';\n\nimport { ErrorSummaryHookForm, StepButtonsHookForm, Form } from '@navikt/fp-form-hooks';\nimport SisteUtenlandsoppholdPeriode from './SisteUtenlandsoppholdPeriode';\nimport useEsNavigator from 'appData/useEsNavigator';\nimport { Path } from 'appData/paths';\nimport { EsDataType, useEsStateData, useEsStateSaveFn } from 'appData/EsDataContext';\nimport useStepData from 'appData/useStepData';\nimport { UtenlandsoppholdSiste, UtenlandsoppholdPeriode } from 'types/Utenlandsopphold';\n\nconst DEFAULT_PERIODE = {\n    fom: '',\n    tom: '',\n    landkode: '',\n} as UtenlandsoppholdPeriode;\nconst DEFAULT_FORM_VALUES = {\n    utenlandsoppholdSiste12Mnd: [DEFAULT_PERIODE],\n} as UtenlandsoppholdSiste;\n\nconst SisteUtenlandsoppholdSteg: React.FunctionComponent = () => {\n    const intl = useIntl();\n\n    const stepData = useStepData();\n    const navigator = useEsNavigator();\n\n    const utenlandsopphold = useEsStateData(EsDataType.UTENLANDSOPPHOLD);\n    const sisteUtenlandsopphold = useEsStateData(EsDataType.UTENLANDSOPPHOLD_SISTE);\n    const lagreSisteUtenlandsopphold = useEsStateSaveFn(EsDataType.UTENLANDSOPPHOLD_SISTE);\n\n    const defaultValues = useMemo(() => sisteUtenlandsopphold || DEFAULT_FORM_VALUES, []);\n    const formMethods = useForm<UtenlandsoppholdSiste>({\n        defaultValues,\n    });\n    const { fields, append, remove } = useFieldArray({\n        name: 'utenlandsoppholdSiste12Mnd',\n        control: formMethods.control,\n    });\n\n    const leggTilOpphold = useCallback(() => {\n        append(DEFAULT_PERIODE);\n    }, [append]);\n    const fjernOpphold = useCallback(\n        (index: number) => {\n            remove(index);\n        },\n        [remove],\n    );\n\n    const lagre = useCallback((formValues: UtenlandsoppholdSiste) => {\n        lagreSisteUtenlandsopphold(formValues);\n        navigator.goToNextStep(\n            utenlandsopphold?.skalBoUtenforNorgeNeste12Mnd ? Path.NESTE_UTENLANDSOPPHOLD : Path.OPPSUMMERING,\n        );\n    }, []);\n\n    return (\n        <Step\n            bannerTitle={intl.formatMessage({ id: 'Søknad.Pageheading' })}\n            pageTitle={intl.formatMessage({ id: 'søknad.utenlandsopphold.tidligere' })}\n            onCancel={navigator.avbrytSøknad}\n            steps={stepData.stepConfig}\n            activeStepId={stepData.activeStepId}\n            useNoTempSavingText\n        >\n            <Form formMethods={formMethods} onSubmit={lagre}>\n                <VStack gap=\"10\">\n                    <ErrorSummaryHookForm />\n                    <VStack gap=\"10\" align=\"start\">\n                        {fields.map((field, index) => (\n                            <Fragment key={field.id}>\n                                <SisteUtenlandsoppholdPeriode index={index} fjernOpphold={fjernOpphold} />\n                                {fields.length > 1 && <hr style={{ width: '100%' }} color=\"#99C4DD\" />}\n                            </Fragment>\n                        ))}\n                        <Button\n                            type=\"button\"\n                            variant=\"secondary\"\n                            size=\"small\"\n                            icon={<PlusIcon aria-hidden />}\n                            onClick={leggTilOpphold}\n                        >\n                            <FormattedMessage id=\"utenlandsopphold.knapp.leggTilLand\" />\n                        </Button>\n                    </VStack>\n                    <StepButtonsHookForm<UtenlandsoppholdSiste>\n                        goToPreviousStep={navigator.goToPreviousDefaultStep}\n                        saveDataOnPreviousClick={lagreSisteUtenlandsopphold}\n                    />\n                </VStack>\n            </Form>\n        </Step>\n    );\n};\n\nexport default SisteUtenlandsoppholdSteg;\n"],"names":["validerPeriodeOverlapp","intl","alleAndrePerioder","fom","tom","allDateRanges","u","dayjs","dateRangesCollide","SisteUtenlandsoppholdPeriode","index","fjernOpphold","useIntl","watch","trigger","isSubmitted","useFormContext","alleAndreUtenlandsopphold","_u","i","minDateFom","date1YearAgo","maxDateFom","dateToday","minDateTom","maxDateTom","jsxs","VStack","jsx","Select","FormattedMessage","isRequired","createCountryOptions","Datepicker","validateDatesNotEqual","fomValue","validateFromDate","tomValue","validateToDate","Button","TrashIcon","DEFAULT_PERIODE","DEFAULT_FORM_VALUES","SisteUtenlandsoppholdSteg","stepData","useStepData","navigator","useEsNavigator","utenlandsopphold","useEsStateData","EsDataType","sisteUtenlandsopphold","lagreSisteUtenlandsopphold","useEsStateSaveFn","defaultValues","useMemo","formMethods","useForm","fields","append","remove","useFieldArray","leggTilOpphold","useCallback","lagre","formValues","Path","Step","Form","ErrorSummaryHookForm","field","Fragment","PlusIcon","StepButtonsHookForm","SisteUtenlandsoppholdSteg$1"],"mappings":"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"}