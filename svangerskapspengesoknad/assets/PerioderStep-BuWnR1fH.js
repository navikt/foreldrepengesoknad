import{j as s}from"./tslib.es6-D_L490Ab.js";import{r as R,R as q}from"./index-CTjT7uj6.js";import{b as ee,c as te,D as B,R as re,a as C,T as ie,u as se,F as oe,E as ne,S as ae}from"./ErrorSummaryHookForm-wMCPAGdp.js";import{B as b,c as de,u as X,a as $,M as c,H as J}from"./Button-B1PUoZR5.js";import{H as me,A as le,S as ge}from"./CalendarLabel-BtFyb3uE.js";import{d as m,b as fe,I as Q,v as j,V as I,H as z,j as pe}from"./Uttaksdagen-BvdO4nAB.js";import{T as V,c as T,n as E,u as ce,a as ve}from"./useSvpNavigator-Bi3xcxec.js";import{i as O,a as H,k as G,e as ue}from"./dateFormValidation-CZBy-b6N.js";import{u as N,C as k,b as U,a as K}from"./routes-DqIFKQUo.js";import{g as Te,b as W,a as ye}from"./dateUtils-B3-vhtDR.js";import{B as Se}from"./Bedriftsbanner-CUKwpvKJ.js";import{g as he}from"./tilretteleggingUtils-CQjlwNYI.js";import{g as y}from"./numberUtils-DCxWcr3S.js";import{h as F,b as L}from"./validationUtils-DuMMxZh1.js";import{S as Me}from"./Modal-CN6gi_wN.js";import{R as je}from"./ReadMore-C6urK32l.js";import{S as De}from"./Plus-DX0DtNPv.js";var Ee=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(i[r[o]]=e[r[o]]);return i};const xe=R.forwardRef((e,t)=>{var{children:i,className:r,variant:o,size:n="medium",icon:a}=e,g=Ee(e,["children","className","variant","size","icon"]);return q.createElement(b,Object.assign({},g,{ref:t,as:"span",size:n==="medium"?"medium":"small",className:de("navds-tag",r,`navds-tag--${o}`,`navds-tag--${n}`)}),a&&q.createElement("span",{className:"navds-tag__icon--left"},a),i)}),_e=(e,t)=>m(e.fom).isBetween(t.fom,t.tom,"day","[]")||m(e.tom).isBetween(t.fom,t.tom,"day","[]")||m(t.fom).isBetween(e.fom,e.tom,"day","[]")||m(t.tom).isBetween(e.fom,e.tom,"day","[]"),ke=(e,t,i)=>!!e&&F(t.fom)&&F(t.stillingsprosent)&&m(t.fom).isAfter(e.fom,"day")&&(i>0&&y(t.stillingsprosent)<i||i===0&&y(t.stillingsprosent)<100),Ie=(e,t,i)=>{const o={...i.find(a=>a.id===e),varierendePerioder:t.varierendePerioder.map(a=>({...a,type:V.DELVIS}))};return i.map(a=>a.id===e?o:a)},be=(e,t)=>e?e.find(i=>t>0?F(i.stillingsprosent)&&y(i.stillingsprosent)===t:F(i.stillingsprosent)&&y(i.stillingsprosent)===100):void 0,Fe=(e,t)=>e&&fe(e)?m(e).toDate():t,Ae=(e,t,i,r)=>{var o;if((o=r==null?void 0:r[e])!=null&&o.fom&&(r[e].tomType===T.SISTE_DAG_MED_SVP||r[e].tom)){const n=r[e].fom,a=r[e].tomType===T.SISTE_DAG_MED_SVP?t:m(r[e].tom).format(Q),g=m(a).diff(n,"days")+1,d=Math.floor(g/7),f=g-d*7;return`${j(n)} - ${j(a)} ${i.formatMessage({id:"PerioderStep.tidsperiode"},{ukeAntall:d,dagAntall:f})}`}return i.formatMessage({id:"ny.periode"})},Oe=(e,t)=>{if(!t||t.length===0)return"";const i=t.filter(o=>o.tom||o.tomType===T.SISTE_DAG_MED_SVP).map(o=>o.tomType===T.SISTE_DAG_MED_SVP?m(e).add(1,"d"):m(o.tom)),r=i.length>0?m.max(i):void 0;return r?r.add(1,"d").format(Q):""},Ge=(e,t)=>({fom:Oe(e,t),tom:"",stillingsprosent:"",tomType:void 0,type:V.DELVIS}),Ne=(e,t)=>!t||t.trim()===""?e.formatMessage({id:"valideringsfeil.stillingsprosent.required"}):y(t)===void 0?e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreEtTall"}):void 0,Re=(e,t,i,r,o)=>n=>{const a=Ne(e,n);if(a)return a;const g=y(n);if(g&&o>0&&g>o)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLikOpprinneligStillingsprosent"},{prosent:o});if(g&&o===0&&g>100)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLik100Prosent"},{prosent:o});if(o>0&&(r!=null&&r.every(d=>d.stillingsprosent&&y(d.stillingsprosent)===o)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kunFullTilrettelegging"},{prosent:o});if(o===0&&(r!=null&&r.every(d=>d.stillingsprosent&&y(d.stillingsprosent)===100)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kun100Prosent"},{prosent:o});if(t&&i)return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.nySøknad"},{fom:j(i.fom)})},Ve=(e,t,i,r,o,n,a)=>g=>{const d=i&&i.length>0?i[t].tom:void 0,f=i&&i.length>0?i[t].tomType:void 0;if(g&&r&&m(g).isBefore(m(r),"d"))return e.formatMessage({id:"valideringsfeil.periode.fom.førBehovForTilretteleggingFom"});if(a&&m(g).isAfter(m(a),"d")){const u=L(a,e);return e.formatMessage({id:"valideringsfeil.periode.fom.etterSluttDatoArbeid"},{dato:j(a),navn:n,slutteTekst:u})}const l=Pe(g,d,f,i,t,e,o);return l||qe(g,i,o,e)},Le=(e,t,i)=>r=>{if(i&&m(r).isAfter(m(i),"d")){const o=L(i,e);return e.formatMessage({id:"valideringsfeil.periode.tom.etterSluttDatoArbeid"},{dato:j(i),navn:t,slutteTekst:o})}},we=(e,t,i,r)=>o=>{if(r&&o===T.SISTE_DAG_MED_SVP&&m(t).isAfter(m(r),"d")){const n=L(r,e);return e.formatMessage({id:"valideringsfeil.periode.tomType.etterSluttDatoArbeid"},{navn:i,slutteTekst:n})}},Pe=(e,t,i,r,o,n,a)=>{if((t||i)&&e&&r&&r.length>0){const d=r.filter((f,l)=>l>o).filter(f=>{let l;return f.tomType&&f.tomType===T.SISTE_DAG_MED_SVP&&(l=a),f.tom&&(l=f.tom),l?_e({fom:e,tom:t||a},{fom:f.fom,tom:l}):!1});if(d.length>0){const f=d[0].tom?d[0].tom:a;return n.formatMessage({id:"valideringsfeil.periode.overlapper"},{fom:j(d[0].fom),tom:j(f)})}}},qe=(e,t,i,r)=>{const o=t?t.filter(d=>d.fom).map(d=>m(d.fom)):void 0,n=o?m.min(o):void 0;if(n&&m(e).isSameOrBefore(n,"day"))return;const a=t?t.filter(d=>d.tom||d.tomType===T.SISTE_DAG_MED_SVP).map(d=>d.tomType===T.SISTE_DAG_MED_SVP?m(i):m(d.tom)):void 0;if(!(a?a.find(d=>m(e).subtract(1,"d").isSame(m(d),"day")):void 0))return r.formatMessage({id:"valideringsfeil.periode.ikkeSammenhengende"})},Be={type:V.DELVIS,fom:"",tom:"",stillingsprosent:"",tomType:void 0},Y=({tilrettelegginger:e,barn:t,valgtTilretteleggingId:i,kanHaSVPFremTilTreUkerFørTermin:r})=>{const o=pe("perioderStep"),n=X(),a=ee(),{fields:g,append:d,remove:f}=te({name:"varierendePerioder",control:a.control}),l=a.watch("varierendePerioder"),u=E(e.find(M=>M.id===i)),v=Te(t),S=u.arbeidsforhold.sluttdato,h=S?E(m.min(m(v),m(S))):v,x=new Date(u.behovForTilretteleggingFom),_=he(l,u.arbeidsforhold.stillinger),D=be(l,_),A=Ge(v,l);return s.jsx(s.Fragment,{children:g.map((M,p)=>{const w=ke(D,l[p],_),P=Fe(l[p].fom,x),Z=W(P,h);return s.jsxs(R.Fragment,{children:[s.jsxs(I,{gap:"1",children:[s.jsx(me,{}),s.jsxs(z,{justify:"space-between",align:"center",children:[s.jsx(xe,{variant:"info-moderate",className:o.element("tag"),children:Ae(p,v,n,l)}),p!==0&&s.jsx($,{icon:s.jsx(Me,{"aria-hidden":!0}),type:"button",variant:"tertiary",onClick:()=>f(p),children:s.jsx(c,{id:"perioder.varierende.slett"})})]})]}),s.jsx(B,{name:`varierendePerioder.${p}.fom`,label:n.formatMessage({id:"perioder.varierende.fom.label"}),minDate:x,maxDate:h,validate:[O(n.formatMessage({id:"valideringsfeil.periode.fom.påkrevd"})),H(n.formatMessage({id:"valideringsfeil.periode.fom.gyldigDato"})),G(n.formatMessage({id:"valideringsfeil.periode.fom.førTilDato"}),l[p].tom),G(r?n.formatMessage({id:"valideringsfeil.periode.fom.etterTreUkerFørTermin"}):n.formatMessage({id:"valideringsfeil.periode.fom.etterFødsel"}),v),Ve(n,p,l,u.behovForTilretteleggingFom,v,u.arbeidsforhold.navn||"",S)],defaultMonth:W(x,h)}),s.jsxs(re,{name:`varierendePerioder.${p}.tomType`,label:s.jsx(c,{id:"perioder.varierende.tomType.label"}),validate:[O(r?n.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.termin"}):n.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.fødsel"})),we(n,v,u.arbeidsforhold.navn||"",S)],children:[s.jsx(C,{value:T.VALGFRI_DATO,children:s.jsx(c,{id:"perioder.varierende.tomType.valgfriDato"})}),s.jsx(C,{value:T.SISTE_DAG_MED_SVP,children:r?s.jsx(c,{id:"perioder.varierende.tomType.treUkerFørTermin"}):s.jsx(c,{id:"perioder.varierende.tomType.dagenFørFødsel"})})]}),l[p].tomType===T.VALGFRI_DATO&&s.jsx(B,{name:`varierendePerioder.${p}.tom`,label:n.formatMessage({id:"perioder.varierende.tom.label"}),validate:[O(n.formatMessage({id:"valideringsfeil.periode.tom.påkrevd"})),H(n.formatMessage({id:"valideringsfeil.periode.tom.gyldigDato"})),ue(n.formatMessage({id:"valideringsfeil.periode.tom.etterTilDato"}),l[p].fom),G(r?n.formatMessage({id:"valideringsfeil.periode.tom.etterTreUkerFørTermin"}):n.formatMessage({id:"valideringsfeil.periode.tom.etterFødsel"}),v),Le(n,u.arbeidsforhold.navn||"",S)],minDate:P,maxDate:h,defaultMonth:Z}),s.jsxs("div",{children:[s.jsx(ie,{name:`varierendePerioder.${p}.stillingsprosent`,label:n.formatMessage({id:"perioder.varierende.stillingsprosent.label"}),className:o.element("stillingsprosent"),description:n.formatMessage({id:"tilrettelegging.tilrettelagtArbeidType.description"}),validate:[Re(n,w,D,l,_)]}),s.jsx(je,{size:"medium",header:n.formatMessage({id:"tilrettelegging.varierendePerioderStillingsprosent.info.tittel"}),children:s.jsxs(I,{gap:"2",children:[s.jsx(b,{children:s.jsx(c,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del1"})}),s.jsx(b,{children:s.jsx(c,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del2"})})]})})]}),w&&s.jsx(le,{variant:"warning",children:s.jsxs(I,{gap:"4",children:[s.jsx(J,{size:"small",children:s.jsx(c,{id:"perioder.alert.nySøknad.title"})}),s.jsx("div",{children:s.jsx(c,{id:"perioder.alert.nySøknad.del1"})}),s.jsx(c,{id:"perioder.alert.nySøknad.del2"})]})}),l&&p===l.length-1&&s.jsx(z,{children:s.jsx($,{icon:s.jsx(De,{"aria-hidden":!0}),type:"button",variant:"secondary",onClick:()=>d(A),children:s.jsx(c,{id:"perioder.varierende.leggTil"})})})]},M.id)})})};Y.__docgenInfo={description:"",methods:[],displayName:"PerioderFieldArray"};const Ce=(e,t)=>{if(t===void 0&&e.length>0)return e[0].id;const i=e.findIndex(r=>r.id===t)+1;if(i!==e.length)return e[i].id},$e=({mellomlagreSøknadOgNaviger:e,avbrytSøknad:t,arbeidsforhold:i})=>{const r=X(),o=ce(i),n=ve(e,i),a=E(N(k.TILRETTELEGGINGER)),g=E(N(k.OM_BARNET)),d=E(N(k.VALGT_TILRETTELEGGING_ID)),[f]=R.useState(d),l=U(k.TILRETTELEGGINGER),u=U(k.VALGT_TILRETTELEGGING_ID),v=E(a.find(D=>D.id===f)),S=a.length>1,h=ye(g),x=D=>{const A=Ie(f,D,a);l(A);const M=Ce(a,f);return M&&u(M),n.goToNextStep(M?K.SKJEMA:K.OPPSUMMERING)},_=se({shouldUnregister:!0,defaultValues:{varierendePerioder:v.varierendePerioder&&v.varierendePerioder.length>0?v.varierendePerioder:[Be]}});return s.jsx(ge,{bannerTitle:r.formatMessage({id:"søknad.pageheading"}),onCancel:t,steps:o,onContinueLater:n.fortsettSøknadSenere,children:s.jsx(oe,{formMethods:_,onSubmit:x,children:s.jsxs(I,{gap:"10",children:[s.jsx(ne,{}),S&&s.jsx(Se,{arbeid:v.arbeidsforhold}),s.jsxs("div",{children:[s.jsx(J,{size:"small",children:s.jsx(c,{id:"perioder.varierende.heading"})}),s.jsx(b,{children:h?s.jsx(c,{id:"perioder.varierende.description.termin"}):s.jsx(c,{id:"perioder.varierende.description.fødsel"})})]}),s.jsx(Y,{valgtTilretteleggingId:f,barn:g,tilrettelegginger:a,kanHaSVPFremTilTreUkerFørTermin:h}),s.jsx(ae,{goToPreviousStep:n.goToPreviousDefaultStep})]})})})};$e.__docgenInfo={description:"",methods:[],displayName:"PerioderStep",props:{mellomlagreSøknadOgNaviger:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},avbrytSøknad:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},arbeidsforhold:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    arbeidsgiverNavn: string;
    arbeidsgiverId: string;
    arbeidsgiverIdType: string;
    fom: string;
    tom?: string;
    stillingsprosent: number;
}`,signature:{properties:[{key:"arbeidsgiverNavn",value:{name:"string",required:!0}},{key:"arbeidsgiverId",value:{name:"string",required:!0}},{key:"arbeidsgiverIdType",value:{name:"string",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!1}},{key:"stillingsprosent",value:{name:"number",required:!0}}]}}],raw:"Arbeidsforhold[]"},description:""}}};export{$e as P};
