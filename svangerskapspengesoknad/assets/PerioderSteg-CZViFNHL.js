import{j as i}from"./jsx-runtime-Cw0GR0a5.js";import{u as M,C as S,b as re,c as P,a as R}from"./routes-B3RFaVmR.js";import{c as y,T as W,k as Y,l as te,m as ie,n as se,u as ne,a as ae,e as oe,f as de,h as ge}from"./useSvpNavigator-CVot2Qjr.js";import{d as me,e as le,c as C,a as pe,b as $,g as ue,u as fe,R as ve,E as ce,S as ye}from"./ErrorSummaryHookForm-MXXFV1ni.js";import{f as d,k as Te,I as J,Q as E,u as Q,V as A,N as ke,a as H,B as U,J as Se,M as v,d as Ee,e as O,A as he,H as X,c as Me}from"./VeiviserPage-BrRWQLa2.js";import{g as je,b as z,a as be}from"./dateUtils-yF-O94TQ.js";import{r as De}from"./index-CTjT7uj6.js";import{n as F,i as G,a as K,j as L,e as Ie}from"./minMax-BE2vCSEM.js";import{B as Ae}from"./Bedriftsbanner-7soXr2-O.js";import{g as T}from"./numberUtils-DCxWcr3S.js";import{h as _,b as V}from"./validationUtils-BCsURH9b.js";import{T as Fe}from"./Tag-_cTpCey2.js";import{R as _e}from"./ReadMore-n3hpH8SA.js";import{S as xe}from"./Plus-CvEhlV_D.js";const qe=(e,r)=>d(e.fom).isBetween(r.fom,r.tom,"day","[]")||d(e.tom).isBetween(r.fom,r.tom,"day","[]")||d(r.fom).isBetween(e.fom,e.tom,"day","[]")||d(r.tom).isBetween(e.fom,e.tom,"day","[]"),Ne=(e,r,t)=>!!e&&_(r.fom)&&_(r.stillingsprosent)&&d(r.fom).isAfter(e.fom,"day")&&(t>0&&T(r.stillingsprosent)<t||t===0&&T(r.stillingsprosent)<100),Re=(e,r)=>e?e.find(t=>r>0?_(t.stillingsprosent)&&T(t.stillingsprosent)===r:_(t.stillingsprosent)&&T(t.stillingsprosent)===100):void 0,Ge=(e,r)=>e&&Te(e)?e:r,Le=(e,r,t,o,n)=>{var m;const g=n&&n[e].tomType===y.SISTE_DAG_MED_SVP;if((m=n==null?void 0:n[e])!=null&&m.fom&&(g||n[e].tom)){const s=n[e].fom,a=n[e].tomType===y.SISTE_DAG_MED_SVP?r:d(n[e].tom).format(J),l=d(a).diff(s,"days")+1,p=Math.floor(l/7),c=l-p*7;let k=E(a);return g&&(k=o?t.formatMessage({id:"PerioderStep.TreUkerFørTermin"}):t.formatMessage({id:"PerioderStep.Fødsel"})),`${E(s)} - ${k} (${t.formatMessage({id:"PerioderStep.tidsperiode"},{ukeAntall:p,dagAntall:c})})`}return t.formatMessage({id:"ny.periode"})},Oe=(e,r)=>{if(!r||r.length===0)return"";const t=r.filter(n=>n.tom||n.tomType===y.SISTE_DAG_MED_SVP).map(n=>n.tomType===y.SISTE_DAG_MED_SVP?d(e).add(1,"d"):d(n.tom)),o=t.length>0?d.max(t):void 0;return o?o.add(1,"d").format(J):""},Ve=(e,r)=>({fom:Oe(e,r),tom:"",stillingsprosent:"",tomType:void 0,type:W.DELVIS}),Be=(e,r)=>!r||r.trim()===""?e.formatMessage({id:"valideringsfeil.stillingsprosent.required"}):T(r)===void 0?e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreEtTall"}):void 0,we=(e,r,t,o,n)=>g=>{const m=Be(e,g);if(m)return m;const s=T(g);if(s&&n>0&&s>n)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLikOpprinneligStillingsprosent"},{prosent:n});if(s&&n===0&&s>100)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLik100Prosent"},{prosent:n});if(n>0&&(o!=null&&o.every(a=>a.stillingsprosent&&T(a.stillingsprosent)===n)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kunFullTilrettelegging"},{prosent:n});if(n===0&&(o!=null&&o.every(a=>a.stillingsprosent&&T(a.stillingsprosent)===100)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kun100Prosent"},{prosent:n});if(r&&t)return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.nySøknad"},{fom:E(t.fom)})},Pe=(e,r,t,o,n,g,m)=>s=>{const a=t&&t.length>0?t[r].tom:void 0,l=t&&t.length>0?t[r].tomType:void 0;if(s&&o&&d(s).isBefore(d(o),"d"))return e.formatMessage({id:"valideringsfeil.periode.fom.førBehovForTilretteleggingFom"});if(m&&d(s).isAfter(d(m),"d")){const c=V(m,e);return e.formatMessage({id:"valideringsfeil.periode.fom.etterSluttDatoArbeid"},{dato:E(m),navn:g,slutteTekst:c})}const p=He(s,a,l,t,r,e,n);return p||Ue(s,t,n,e)},Ce=(e,r,t)=>o=>{if(t&&d(o).isAfter(d(t),"d")){const n=V(t,e);return e.formatMessage({id:"valideringsfeil.periode.tom.etterSluttDatoArbeid"},{dato:E(t),navn:r,slutteTekst:n})}},$e=(e,r,t,o)=>n=>{if(o&&n===y.SISTE_DAG_MED_SVP&&d(r).isAfter(d(o),"d")){const g=V(o,e);return e.formatMessage({id:"valideringsfeil.periode.tomType.etterSluttDatoArbeid"},{navn:t,slutteTekst:g})}},He=(e,r,t,o,n,g,m)=>{if((r||t)&&e&&o&&o.length>0){const a=o.filter((l,p)=>p>n).filter(l=>{let p;return l.tomType&&l.tomType===y.SISTE_DAG_MED_SVP&&(p=m),l.tom&&(p=l.tom),p?qe({fom:e,tom:r||m},{fom:l.fom,tom:p}):!1});if(a.length>0){const l=a[0].tom?a[0].tom:m;return g.formatMessage({id:"valideringsfeil.periode.overlapper"},{fom:E(a[0].fom),tom:E(l)})}}},Ue=(e,r,t,o)=>{const n=r?r.filter(a=>a.fom).map(a=>d(a.fom)):void 0,g=n?d.min(n):void 0;if(g&&d(e).isSameOrBefore(g,"day"))return;const m=r?r.filter(a=>a.tom||a.tomType===y.SISTE_DAG_MED_SVP).map(a=>a.tomType===y.SISTE_DAG_MED_SVP?d(t):d(a.tom)):void 0;if(!(m?m.find(a=>d(e).subtract(1,"d").isSame(d(a),"day")):void 0))return o.formatMessage({id:"valideringsfeil.periode.ikkeSammenhengende"})},ze={type:W.DELVIS,fom:"",tom:"",stillingsprosent:"",tomType:void 0},Z=({barn:e,valgtTilretteleggingId:r,kanHaSVPFremTilTreUkerFørTermin:t,behovForTilretteleggingFom:o,arbeidsforhold:n,egenNæring:g,frilans:m})=>{const s=Q(),a=je(e),l=Y(s,r,n),p=te(e.termindato,r,n,g,m),c=ie(e.termindato,r,n,g,m),k=me(),{fields:j,append:x,remove:D}=le({name:"varierendePerioder",control:k.control}),u=k.watch("varierendePerioder"),h=c.tom?F(d.min(d(a),d(c.tom))):a,b=se(u,p),I=Re(u,b),q=Ve(a,u);return i.jsx(i.Fragment,{children:j.map((N,f)=>{const B=Ne(I,u[f],b),w=Ge(u[f].fom,o),ee=z(w,h);return i.jsxs(De.Fragment,{children:[i.jsxs(A,{gap:"1",children:[i.jsx(ke,{}),i.jsxs(H,{justify:"space-between",align:"center",children:[i.jsx(Fe,{variant:"info-moderate",children:Le(f,a,s,t,u)}),f!==0&&i.jsx(U,{icon:i.jsx(Se,{"aria-hidden":!0}),type:"button",variant:"tertiary",onClick:()=>D(f),children:i.jsx(v,{id:"perioder.varierende.slett"})})]})]}),i.jsx(C,{name:`varierendePerioder.${f}.fom`,label:s.formatMessage({id:"perioder.varierende.fom.label"}),minDate:o,maxDate:h,validate:[G(s.formatMessage({id:"valideringsfeil.periode.fom.påkrevd"})),K(s.formatMessage({id:"valideringsfeil.periode.fom.gyldigDato"})),L(s.formatMessage({id:"valideringsfeil.periode.fom.førTilDato"}),u[f].tom),L(t?s.formatMessage({id:"valideringsfeil.periode.fom.etterTreUkerFørTermin"}):s.formatMessage({id:"valideringsfeil.periode.fom.etterFødsel"}),a),Pe(s,f,u,o,a,l||"",c.tom)],defaultMonth:z(o,h)}),i.jsxs(pe,{name:`varierendePerioder.${f}.tomType`,label:i.jsx(v,{id:"perioder.varierende.tomType.label"}),validate:[G(t?s.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.termin"}):s.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.fødsel"})),$e(s,a,l||"",c.tom)],children:[i.jsx($,{value:y.VALGFRI_DATO,children:i.jsx(v,{id:"perioder.varierende.tomType.valgfriDato"})}),i.jsx($,{value:y.SISTE_DAG_MED_SVP,children:t?i.jsx(v,{id:"perioder.varierende.tomType.treUkerFørTermin"}):i.jsx(v,{id:"perioder.varierende.tomType.dagenFørFødsel"})})]}),u[f].tomType===y.VALGFRI_DATO&&i.jsx(C,{name:`varierendePerioder.${f}.tom`,label:s.formatMessage({id:"perioder.varierende.tom.label"}),validate:[G(s.formatMessage({id:"valideringsfeil.periode.tom.påkrevd"})),K(s.formatMessage({id:"valideringsfeil.periode.tom.gyldigDato"})),Ie(s.formatMessage({id:"valideringsfeil.periode.tom.etterTilDato"}),u[f].fom),L(t?s.formatMessage({id:"valideringsfeil.periode.tom.etterTreUkerFørTermin"}):s.formatMessage({id:"valideringsfeil.periode.tom.etterFødsel"}),a),Ce(s,l||"",c.tom)],minDate:w,maxDate:h,defaultMonth:ee}),i.jsxs("div",{children:[i.jsx(ue,{name:`varierendePerioder.${f}.stillingsprosent`,label:s.formatMessage({id:"perioder.varierende.stillingsprosent.label"}),style:{maxWidth:"450px"},description:s.formatMessage({id:"tilrettelegging.tilrettelagtArbeidType.description"}),validate:[we(s,B,I,u,b)]}),i.jsx(_e,{onOpenChange:Ee("Svangerskapspenger","Ikke_har_100%_stilling"),size:"medium",header:s.formatMessage({id:"tilrettelegging.varierendePerioderStillingsprosent.info.tittel"}),children:i.jsxs(A,{gap:"2",children:[i.jsx(O,{children:i.jsx(v,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del1"})}),i.jsx(O,{children:i.jsx(v,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del2"})})]})})]}),B&&i.jsx(he,{variant:"warning",children:i.jsxs(A,{gap:"4",children:[i.jsx(X,{size:"small",children:i.jsx(v,{id:"perioder.alert.nySøknad.title"})}),i.jsx("div",{children:i.jsx(v,{id:"perioder.alert.nySøknad.del1"})}),i.jsx(v,{id:"perioder.alert.nySøknad.del2"})]})}),u&&f===u.length-1&&i.jsx(H,{children:i.jsx(U,{icon:i.jsx(xe,{"aria-hidden":!0}),type:"button",variant:"secondary",onClick:()=>x(q),children:i.jsx(v,{id:"perioder.varierende.leggTil"})})})]},N.id)})})};Z.__docgenInfo={description:"",methods:[],displayName:"PerioderFieldArray",props:{barn:{required:!0,tsType:{name:"Barn"},description:""},valgtTilretteleggingId:{required:!0,tsType:{name:"string"},description:""},kanHaSVPFremTilTreUkerFørTermin:{required:!0,tsType:{name:"boolean"},description:""},behovForTilretteleggingFom:{required:!0,tsType:{name:"string"},description:""},arbeidsforhold:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    arbeidsgiverNavn: string;
    arbeidsgiverId: string;
    arbeidsgiverIdType: string;
    fom: string;
    tom?: string;
    stillingsprosent: number;
}`,signature:{properties:[{key:"arbeidsgiverNavn",value:{name:"string",required:!0}},{key:"arbeidsgiverId",value:{name:"string",required:!0}},{key:"arbeidsgiverIdType",value:{name:"string",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!1}},{key:"stillingsprosent",value:{name:"number",required:!0}}]}}],raw:"Arbeidsforhold[]"},description:""},egenNæring:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    næringstype: Næringstype;
    fom: string;
    tom: string;
    næringsinntekt?: number;
    pågående: boolean; // Brukes ikke backend
    navnPåNæringen?: string;
    organisasjonsnummer?: string;
    registrertINorge: boolean;
    registrertILand?: string;
    harBlittYrkesaktivILøpetAvDeTreSisteFerdigliknedeÅrene?: boolean;
    oppstartsdato?: string;
    hattVarigEndringAvNæringsinntektSiste4Kalenderår?: boolean;
    varigEndringDato?: string;
    varigEndringInntektEtterEndring?: string;
    varigEndringBeskrivelse?: string;
}`,signature:{properties:[{key:"næringstype",value:{name:"Næringstype",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!0}},{key:"næringsinntekt",value:{name:"number",required:!1}},{key:"pågående",value:{name:"boolean",required:!0}},{key:"navnPåNæringen",value:{name:"string",required:!1}},{key:"organisasjonsnummer",value:{name:"string",required:!1}},{key:"registrertINorge",value:{name:"boolean",required:!0}},{key:"registrertILand",value:{name:"string",required:!1}},{key:"harBlittYrkesaktivILøpetAvDeTreSisteFerdigliknedeÅrene",value:{name:"boolean",required:!1}},{key:"oppstartsdato",value:{name:"string",required:!1}},{key:"hattVarigEndringAvNæringsinntektSiste4Kalenderår",value:{name:"boolean",required:!1}},{key:"varigEndringDato",value:{name:"string",required:!1}},{key:"varigEndringInntektEtterEndring",value:{name:"string",required:!1}},{key:"varigEndringBeskrivelse",value:{name:"string",required:!1}}]}},description:""},frilans:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    jobberFremdelesSomFrilans: boolean;
    oppstart: string;
}`,signature:{properties:[{key:"jobberFremdelesSomFrilans",value:{name:"boolean",required:!0}},{key:"oppstart",value:{name:"string",required:!0}}]}},description:""}}};const Ke=({mellomlagreSøknadOgNaviger:e,avbrytSøknad:r,arbeidsforhold:t})=>{const o=Q(),n=ne(t),g=ae(e,t),m=oe(),s=F(m.tilretteleggingId),a=M(S.TILRETTELEGGINGER_PERIODER),l=F(M(S.TILRETTELEGGINGER)),p=F(M(S.OM_BARNET)),c=M(S.EGEN_NÆRING),k=M(S.FRILANS),j=M(S.VALGTE_ARBEIDSFORHOLD),x=re(S.TILRETTELEGGINGER_PERIODER),D=be(p),u=de(s,t),h=Y(o,s,t),b=l[s],I=N=>{if(x({...a,[s]:N.varierendePerioder}),u==="virksomhet"||u==="privat")return g.goToStep(P(R.FERIE,s));const f=ge(s,j);return g.goToStep(f?P(R.SKJEMA,f):R.OPPSUMMERING)},q=fe({shouldUnregister:!0,defaultValues:{varierendePerioder:(a==null?void 0:a[s])??[ze]}});return i.jsx(Me,{bannerTitle:o.formatMessage({id:"søknad.pageheading"}),onCancel:r,steps:n,onContinueLater:g.fortsettSøknadSenere,onStepChange:g.goToStep,children:i.jsx(ve,{formMethods:q,onSubmit:I,children:i.jsxs(A,{gap:"10",children:[i.jsx(ce,{}),!!j&&j.length>1&&i.jsx(Ae,{arbeidsforholdType:u,arbeidsforholdNavn:h}),i.jsxs("div",{children:[i.jsx(X,{size:"small",children:i.jsx(v,{id:"perioder.varierende.heading"})}),i.jsx(O,{children:D?i.jsx(v,{id:"perioder.varierende.description.termin"}):i.jsx(v,{id:"perioder.varierende.description.fødsel"})})]}),i.jsx(Z,{valgtTilretteleggingId:s,barn:p,kanHaSVPFremTilTreUkerFørTermin:D,arbeidsforhold:t,egenNæring:c,frilans:k,behovForTilretteleggingFom:b.behovForTilretteleggingFom}),i.jsx(ye,{goToPreviousStep:g.goToPreviousDefaultStep})]})})})};Ke.__docgenInfo={description:"",methods:[],displayName:"PerioderSteg",props:{mellomlagreSøknadOgNaviger:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},avbrytSøknad:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},arbeidsforhold:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    arbeidsgiverNavn: string;
    arbeidsgiverId: string;
    arbeidsgiverIdType: string;
    fom: string;
    tom?: string;
    stillingsprosent: number;
}`,signature:{properties:[{key:"arbeidsgiverNavn",value:{name:"string",required:!0}},{key:"arbeidsgiverId",value:{name:"string",required:!0}},{key:"arbeidsgiverIdType",value:{name:"string",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!1}},{key:"stillingsprosent",value:{name:"number",required:!0}}]}}],raw:"Arbeidsforhold[]"},description:""}}};export{Ke as P};
