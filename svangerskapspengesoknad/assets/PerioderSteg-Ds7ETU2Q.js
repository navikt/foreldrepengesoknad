import{j as i}from"./jsx-runtime-Cw0GR0a5.js";import{u as D,C as M,b as re,c as q,a as O}from"./routes-B3RFaVmR.js";import{c as u,T as W,k as X,l as se,m as ie,n as oe,u as ne,a as ae,e as de,f as me,h as le}from"./useSvpNavigator-DKnyX4rK.js";import{d as ge,e as fe,c as $,a as pe,b as U,h as ve,u as ce,R as ue,E as Te,S as Se}from"./ErrorSummaryHookForm-COxLyZNO.js";import{f as a,k as ye,I as Q,R as E,u as Y,V as F,O as Me,a as z,B as H,J as Ee,M as c,d as he,e as B,A as je,H as Z,F as De,c as ke}from"./VeiviserPage-CLXcsmfi.js";import{g as _e,b as K,a as Ie}from"./dateUtils-BTFEcRKn.js";import{r as xe}from"./index-CTjT7uj6.js";import{n as R,i as V,a as J,f as L,e as Ae}from"./minMax-Bz1hsF8W.js";import{B as Fe}from"./Bedriftsbanner-CI4FtMfz.js";import{g as S}from"./numberUtils-DCxWcr3S.js";import{h as b,b as w}from"./validationUtils-dtagQCb7.js";import{T as Re}from"./Tag-ElPZw9Uc.js";import{R as be}from"./ReadMore-DmqDY5Nu.js";import{S as Ge}from"./Plus-CIKOYxhl.js";const Ne=(e,r)=>a(e.fom).isBetween(r.fom,r.tom,"day","[]")||a(e.tom).isBetween(r.fom,r.tom,"day","[]")||a(r.fom).isBetween(e.fom,e.tom,"day","[]")||a(r.tom).isBetween(e.fom,e.tom,"day","[]"),Oe=(e,r,s)=>!!e&&b(r.fom)&&b(r.stillingsprosent)&&a(r.fom).isAfter(e.fom,"day")&&(s>0&&S(r.stillingsprosent)<s||s===0&&S(r.stillingsprosent)<100),Ve=(e,r)=>e?e.find(s=>r>0?b(s.stillingsprosent)&&S(s.stillingsprosent)===r:b(s.stillingsprosent)&&S(s.stillingsprosent)===100):void 0,Le=(e,r)=>e&&ye(e)?e:r,Be=(e,r,s,n,o)=>{var g;const l=o&&o[e].tomType===u.SISTE_DAG_MED_SVP;if((g=o==null?void 0:o[e])!=null&&g.fom&&(l||o[e].tom)){const d=o[e].fom,t=o[e].tomType===u.SISTE_DAG_MED_SVP?r:a(o[e].tom).format(Q),m=a(t).diff(d,"days")+1,f=Math.floor(m/7),y=m-f*7;let T=E(t);return l&&(T=n?s.formatMessage({id:"PerioderStep.TreUkerFørTermin"}):s.formatMessage({id:"PerioderStep.Fødsel"})),`${E(d)} - ${T} (${s.formatMessage({id:"PerioderStep.tidsperiode"},{ukeAntall:f,dagAntall:y})})`}return s.formatMessage({id:"ny.periode"})},we=(e,r)=>{if(!r||r.length===0)return"";const s=r.filter(o=>o.tom||o.tomType===u.SISTE_DAG_MED_SVP).map(o=>o.tomType===u.SISTE_DAG_MED_SVP?a(e).add(1,"d"):a(o.tom)),n=s.length>0?a.max(s):void 0;return n?n.add(1,"d").format(Q):""},Ce=(e,r)=>({fom:we(e,r),tom:"",stillingsprosent:"",tomType:void 0,type:W.DELVIS}),Pe=(e,r)=>!r||r.trim()===""?e.formatMessage({id:"valideringsfeil.stillingsprosent.required"}):S(r)===void 0?e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreEtTall"}):void 0,qe=(e,r,s,n,o)=>l=>{const g=Pe(e,l);if(g)return g;const d=S(l);if(d&&o>0&&d>o)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLikOpprinneligStillingsprosent"},{prosent:o});if(d&&o===0&&d>100)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLik100Prosent"},{prosent:o});if(o>0&&(n!=null&&n.every(t=>t.stillingsprosent&&S(t.stillingsprosent)===o)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kunFullTilrettelegging"},{prosent:o});if(o===0&&(n!=null&&n.every(t=>t.stillingsprosent&&S(t.stillingsprosent)===100)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kun100Prosent"},{prosent:o});if(r&&s)return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.nySøknad"},{fom:E(s.fom)})},$e=(e,r,s,n,o,l,g)=>d=>{const t=s&&s.length>0?s[r].tom:void 0,m=s&&s.length>0?s[r].tomType:void 0;if(d&&n&&a(d).isBefore(a(n),"d"))return e.formatMessage({id:"valideringsfeil.periode.fom.førBehovForTilretteleggingFom"});if(g&&a(d).isAfter(a(g),"d")){const y=w(g,e);return e.formatMessage({id:"valideringsfeil.periode.fom.etterSluttDatoArbeid"},{dato:E(g),navn:l,slutteTekst:y})}const f=He(d,t,m,s,r,e,o);return f||Ke(d,s,o,e)},Ue=(e,r,s)=>n=>{if(s&&a(n).isAfter(a(s),"d")){const o=w(s,e);return e.formatMessage({id:"valideringsfeil.periode.tom.etterSluttDatoArbeid"},{dato:E(s),navn:r,slutteTekst:o})}},ze=(e,r,s,n)=>o=>{if(n&&o===u.SISTE_DAG_MED_SVP&&a(r).isAfter(a(n),"d")){const l=w(n,e);return e.formatMessage({id:"valideringsfeil.periode.tomType.etterSluttDatoArbeid"},{navn:s,slutteTekst:l})}},He=(e,r,s,n,o,l,g)=>{if((r||s)&&e&&n&&n.length>0){const t=n.filter((m,f)=>f>o).filter(m=>{let f;return m.tomType&&m.tomType===u.SISTE_DAG_MED_SVP&&(f=g),m.tom&&(f=m.tom),f?Ne({fom:e,tom:r||g},{fom:m.fom,tom:f}):!1});if(t.length>0){const m=t[0].tom?t[0].tom:g;return l.formatMessage({id:"valideringsfeil.periode.overlapper"},{fom:E(t[0].fom),tom:E(m)})}}},Ke=(e,r,s,n)=>{const o=r?r.filter(t=>t.fom).map(t=>a(t.fom)):void 0,l=o?a.min(o):void 0;if(l&&a(e).isSameOrBefore(l,"day"))return;const g=r?r.filter(t=>t.tom||t.tomType===u.SISTE_DAG_MED_SVP).map(t=>t.tomType===u.SISTE_DAG_MED_SVP?a(s):a(t.tom)):void 0;if(!(g?g.find(t=>a(e).subtract(1,"d").isSame(a(t),"day")):void 0))return n.formatMessage({id:"valideringsfeil.periode.ikkeSammenhengende"})},Je={type:W.DELVIS,fom:"",tom:"",stillingsprosent:"",tomType:void 0},ee=({barn:e,valgtTilretteleggingId:r,kanHaSVPFremTilTreUkerFørTermin:s,behovForTilretteleggingFom:n,arbeidsforhold:o,egenNæring:l,frilans:g})=>{const d=De("perioderStep"),t=Y(),m=_e(e),f=X(t,r,o),y=se(e.termindato,r,o,l,g),T=ie(e.termindato,r,o,l,g),h=ge(),{fields:G,append:I,remove:k}=fe({name:"varierendePerioder",control:h.control}),p=h.watch("varierendePerioder"),j=T.tom?R(a.min(a(m),a(T.tom))):m,_=oe(p,y),x=Ve(p,_),N=Ce(m,p);return i.jsx(i.Fragment,{children:G.map((A,v)=>{const C=Oe(x,p[v],_),P=Le(p[v].fom,n),te=K(P,j);return i.jsxs(xe.Fragment,{children:[i.jsxs(F,{gap:"1",children:[i.jsx(Me,{}),i.jsxs(z,{justify:"space-between",align:"center",children:[i.jsx(Re,{variant:"info-moderate",className:d.element("tag"),children:Be(v,m,t,s,p)}),v!==0&&i.jsx(H,{icon:i.jsx(Ee,{"aria-hidden":!0}),type:"button",variant:"tertiary",onClick:()=>k(v),children:i.jsx(c,{id:"perioder.varierende.slett"})})]})]}),i.jsx($,{name:`varierendePerioder.${v}.fom`,label:t.formatMessage({id:"perioder.varierende.fom.label"}),minDate:n,maxDate:j,validate:[V(t.formatMessage({id:"valideringsfeil.periode.fom.påkrevd"})),J(t.formatMessage({id:"valideringsfeil.periode.fom.gyldigDato"})),L(t.formatMessage({id:"valideringsfeil.periode.fom.førTilDato"}),p[v].tom),L(s?t.formatMessage({id:"valideringsfeil.periode.fom.etterTreUkerFørTermin"}):t.formatMessage({id:"valideringsfeil.periode.fom.etterFødsel"}),m),$e(t,v,p,n,m,f||"",T.tom)],defaultMonth:K(n,j)}),i.jsxs(pe,{name:`varierendePerioder.${v}.tomType`,label:i.jsx(c,{id:"perioder.varierende.tomType.label"}),validate:[V(s?t.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.termin"}):t.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.fødsel"})),ze(t,m,f||"",T.tom)],children:[i.jsx(U,{value:u.VALGFRI_DATO,children:i.jsx(c,{id:"perioder.varierende.tomType.valgfriDato"})}),i.jsx(U,{value:u.SISTE_DAG_MED_SVP,children:s?i.jsx(c,{id:"perioder.varierende.tomType.treUkerFørTermin"}):i.jsx(c,{id:"perioder.varierende.tomType.dagenFørFødsel"})})]}),p[v].tomType===u.VALGFRI_DATO&&i.jsx($,{name:`varierendePerioder.${v}.tom`,label:t.formatMessage({id:"perioder.varierende.tom.label"}),validate:[V(t.formatMessage({id:"valideringsfeil.periode.tom.påkrevd"})),J(t.formatMessage({id:"valideringsfeil.periode.tom.gyldigDato"})),Ae(t.formatMessage({id:"valideringsfeil.periode.tom.etterTilDato"}),p[v].fom),L(s?t.formatMessage({id:"valideringsfeil.periode.tom.etterTreUkerFørTermin"}):t.formatMessage({id:"valideringsfeil.periode.tom.etterFødsel"}),m),Ue(t,f||"",T.tom)],minDate:P,maxDate:j,defaultMonth:te}),i.jsxs("div",{children:[i.jsx(ve,{name:`varierendePerioder.${v}.stillingsprosent`,label:t.formatMessage({id:"perioder.varierende.stillingsprosent.label"}),className:d.element("stillingsprosent"),description:t.formatMessage({id:"tilrettelegging.tilrettelagtArbeidType.description"}),validate:[qe(t,C,x,p,_)]}),i.jsx(be,{onOpenChange:he("Svangerskapspenger","Ikke_har_100%_stilling"),size:"medium",header:t.formatMessage({id:"tilrettelegging.varierendePerioderStillingsprosent.info.tittel"}),children:i.jsxs(F,{gap:"2",children:[i.jsx(B,{children:i.jsx(c,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del1"})}),i.jsx(B,{children:i.jsx(c,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del2"})})]})})]}),C&&i.jsx(je,{variant:"warning",children:i.jsxs(F,{gap:"4",children:[i.jsx(Z,{size:"small",children:i.jsx(c,{id:"perioder.alert.nySøknad.title"})}),i.jsx("div",{children:i.jsx(c,{id:"perioder.alert.nySøknad.del1"})}),i.jsx(c,{id:"perioder.alert.nySøknad.del2"})]})}),p&&v===p.length-1&&i.jsx(z,{children:i.jsx(H,{icon:i.jsx(Ge,{"aria-hidden":!0}),type:"button",variant:"secondary",onClick:()=>I(N),children:i.jsx(c,{id:"perioder.varierende.leggTil"})})})]},A.id)})})};ee.__docgenInfo={description:"",methods:[],displayName:"PerioderFieldArray"};const We=({mellomlagreSøknadOgNaviger:e,avbrytSøknad:r,arbeidsforhold:s})=>{const n=Y(),o=ne(s),l=ae(e,s),g=de(),d=R(g.tilretteleggingId),t=D(M.TILRETTELEGGINGER_PERIODER),m=R(D(M.TILRETTELEGGINGER)),f=R(D(M.OM_BARNET)),y=D(M.EGEN_NÆRING),T=D(M.FRILANS),h=D(M.VALGTE_ARBEIDSFORHOLD),G=re(M.TILRETTELEGGINGER_PERIODER),I=Ie(f),k=me(d,s),p=X(n,d,s),j=m[d],_=N=>{if(G({...t,[d]:N.varierendePerioder}),k==="virksomhet"||k==="privat")return l.goToStep(q(O.FERIE,d));const A=le(d,h);return l.goToStep(A?q(O.SKJEMA,A):O.OPPSUMMERING)},x=ce({shouldUnregister:!0,defaultValues:{varierendePerioder:(t==null?void 0:t[d])??[Je]}});return i.jsx(ke,{bannerTitle:n.formatMessage({id:"søknad.pageheading"}),onCancel:r,steps:o,onContinueLater:l.fortsettSøknadSenere,onStepChange:l.goToStep,children:i.jsx(ue,{formMethods:x,onSubmit:_,children:i.jsxs(F,{gap:"10",children:[i.jsx(Te,{}),!!h&&h.length>1&&i.jsx(Fe,{arbeidsforholdType:k,arbeidsforholdNavn:p}),i.jsxs("div",{children:[i.jsx(Z,{size:"small",children:i.jsx(c,{id:"perioder.varierende.heading"})}),i.jsx(B,{children:I?i.jsx(c,{id:"perioder.varierende.description.termin"}):i.jsx(c,{id:"perioder.varierende.description.fødsel"})})]}),i.jsx(ee,{valgtTilretteleggingId:d,barn:f,kanHaSVPFremTilTreUkerFørTermin:I,arbeidsforhold:s,egenNæring:y,frilans:T,behovForTilretteleggingFom:j.behovForTilretteleggingFom}),i.jsx(Se,{goToPreviousStep:l.goToPreviousDefaultStep})]})})})};We.__docgenInfo={description:"",methods:[],displayName:"PerioderSteg",props:{mellomlagreSøknadOgNaviger:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},avbrytSøknad:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},arbeidsforhold:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    arbeidsgiverNavn: string;
    arbeidsgiverId: string;
    arbeidsgiverIdType: string;
    fom: string;
    tom?: string;
    stillingsprosent: number;
}`,signature:{properties:[{key:"arbeidsgiverNavn",value:{name:"string",required:!0}},{key:"arbeidsgiverId",value:{name:"string",required:!0}},{key:"arbeidsgiverIdType",value:{name:"string",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!1}},{key:"stillingsprosent",value:{name:"number",required:!0}}]}}],raw:"Arbeidsforhold[]"},description:""}}};export{We as P};
