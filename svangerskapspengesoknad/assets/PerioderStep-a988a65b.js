import{u as Q,j as s}from"./index-f7e8eec7.js";import{r as R,R as C}from"./index-f1f2c4b1.js";import{b as te,c as re,D as q,R as ie,a as $,T as se,u as oe,F as ae,E as ne,S as de}from"./ErrorSummaryHookForm-b3689071.js";import{A as le,u as V,C as x,b as H,c as me,a as U}from"./routes-999d7714.js";import{d as l,b as ge,I as Y,q as M,V as I,H as z,j as fe}from"./VStack-1b7d0c8f.js";import{j as T,T as L,n as _,i as O,b as K,w as G,f as pe,u as ce,a as ue}from"./useSvpNavigator-7f6afa8c.js";import{g as ve,b as X,a as Te}from"./dateUtils-596e9d2c.js";import{B as ye}from"./Bedriftsbanner-2bf3cbcf.js";import{H as Se,P as he}from"./HorizontalLine-a53a7446.js";import{g as je}from"./tilretteleggingUtils-3df42593.js";import{g as y}from"./numberUtils-1f932ffe.js";import{h as k,b as P}from"./validationUtils-9ec7b8ab.js";import{B as b,c as Me,a as W,F as c,H as Z}from"./Button-07c65ca4.js";import{X as Ee}from"./Modal-d372bfb0.js";import{R as _e}from"./ReadMore-c884ad2a.js";const De=(e,t)=>l(e.fom).isBetween(t.fom,t.tom,"day","[]")||l(e.tom).isBetween(t.fom,t.tom,"day","[]")||l(t.fom).isBetween(e.fom,e.tom,"day","[]")||l(t.tom).isBetween(e.fom,e.tom,"day","[]");var Fe=globalThis&&globalThis.__rest||function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(i[r[o]]=e[r[o]]);return i};const xe=R.forwardRef((e,t)=>{var{children:i,className:r,variant:o,size:a="medium",icon:n}=e,g=Fe(e,["children","className","variant","size","icon"]);return C.createElement(b,Object.assign({},g,{ref:t,as:"span",size:a==="medium"?"medium":"small",className:Me("navds-tag",r,`navds-tag--${o}`,`navds-tag--${a}`)}),n&&C.createElement("span",{className:"navds-tag__icon--left"},n),i)}),Ie=xe;const ke=(e,t,i)=>!!e&&k(t.fom)&&k(t.stillingsprosent)&&l(t.fom).isAfter(e.fom,"day")&&(i>0&&y(t.stillingsprosent)<i||i===0&&y(t.stillingsprosent)<100),be=(e,t,i)=>{const o={...i.find(n=>n.id===e),varierendePerioder:t.varierendePerioder.map(n=>({...n,type:L.DELVIS}))};return i.map(n=>n.id===e?o:n)},Ae=(e,t)=>e?e.find(i=>t>0?k(i.stillingsprosent)&&y(i.stillingsprosent)===t:k(i.stillingsprosent)&&y(i.stillingsprosent)===100):void 0,Ve=(e,t)=>e&&ge(e)?l(e).toDate():t,Oe=(e,t,i,r)=>{var o;if(r&&((o=r[e])!=null&&o.fom)&&(r[e].tomType===T.SISTE_DAG_MED_SVP||r[e].tom)){const a=r[e].tomType===T.SISTE_DAG_MED_SVP?t:l(r[e].tom).format(Y);return`${M(r[e].fom)} - ${M(a)}`}return i.formatMessage({id:"ny.periode"})},Ge=(e,t)=>{if(!t||t.length===0)return"";const i=t.filter(o=>o.tom||o.tomType===T.SISTE_DAG_MED_SVP).map(o=>o.tomType===T.SISTE_DAG_MED_SVP?l(e).add(1,"d"):l(o.tom)),r=i.length>0?l.max(i):void 0;return r?r.add(1,"d").format(Y):""},Ne=(e,t)=>({fom:Ge(e,t),tom:"",stillingsprosent:"",tomType:void 0,type:L.DELVIS}),Re=(e,t)=>!t||t.trim()===""?e.formatMessage({id:"valideringsfeil.stillingsprosent.required"}):y(t)===void 0?e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreEtTall"}):void 0,Le=(e,t,i,r,o)=>a=>{const n=Re(e,a);if(n)return n;const g=y(a);if(g&&o>0&&g>o)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLikOpprinneligStillingsprosent"},{prosent:o});if(g&&o===0&&g>100)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLik100Prosent"},{prosent:o});if(o>0&&r&&(r!=null&&r.every(d=>d.stillingsprosent&&y(d.stillingsprosent)===o)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kunFullTilrettelegging"},{prosent:o});if(o===0&&r&&(r!=null&&r.every(d=>d.stillingsprosent&&y(d.stillingsprosent)===100)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kun100Prosent"},{prosent:o});if(t&&i)return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.nySøknad"},{fom:M(i.fom)})},Pe=(e,t,i,r,o,a,n)=>g=>{const d=i&&i.length>0?i[t].tom:void 0,f=i&&i.length>0?i[t].tomType:void 0;if(g&&r&&l(g).isBefore(l(r),"d"))return e.formatMessage({id:"valideringsfeil.periode.fom.førBehovForTilretteleggingFom"});if(n&&l(g).isAfter(l(n),"d")){const v=P(n,e);return e.formatMessage({id:"valideringsfeil.periode.fom.etterSluttDatoArbeid"},{dato:M(n),navn:a,slutteTekst:v})}const m=Ce(g,d,f,i,t,e,o);return m||qe(g,i,o,e)},we=(e,t,i)=>r=>{if(i&&l(r).isAfter(l(i),"d")){const o=P(i,e);return e.formatMessage({id:"valideringsfeil.periode.tom.etterSluttDatoArbeid"},{dato:M(i),navn:t,slutteTekst:o})}},Be=(e,t,i,r)=>o=>{if(r&&o===T.SISTE_DAG_MED_SVP&&l(t).isAfter(l(r),"d")){const a=P(r,e);return e.formatMessage({id:"valideringsfeil.periode.tomType.etterSluttDatoArbeid"},{navn:i,slutteTekst:a})}},Ce=(e,t,i,r,o,a,n)=>{if((t||i)&&e&&r&&r.length>0){const d=r.filter((f,m)=>m>o).filter(f=>{let m;return f.tomType&&f.tomType===T.SISTE_DAG_MED_SVP&&(m=n),f.tom&&(m=f.tom),m?De({fom:e,tom:t||n},{fom:f.fom,tom:m}):!1});if(d.length>0){const f=d[0].tom?d[0].tom:n;return a.formatMessage({id:"valideringsfeil.periode.overlapper"},{fom:M(d[0].fom),tom:M(f)})}}},qe=(e,t,i,r)=>{const o=t?t.filter(d=>d.fom).map(d=>l(d.fom)):void 0,a=o?l.min(o):void 0;if(a&&l(e).isSameOrBefore(a,"day"))return;const n=t?t.filter(d=>d.tom||d.tomType===T.SISTE_DAG_MED_SVP).map(d=>d.tomType===T.SISTE_DAG_MED_SVP?l(i):l(d.tom)):void 0;if(!(n?n.find(d=>l(e).subtract(1,"d").isSame(l(d),"day")):void 0))return r.formatMessage({id:"valideringsfeil.periode.ikkeSammenhengende"})},$e={type:L.DELVIS,fom:"",tom:"",stillingsprosent:"",tomType:void 0},N=({tilrettelegginger:e,barn:t,valgtTilretteleggingId:i,kanHaSVPFremTilTreUkerFørTermin:r})=>{const o=fe("perioderStep"),a=Q(),n=te(),{fields:g,append:d,remove:f}=re({name:"varierendePerioder",control:n.control}),m=n.watch("varierendePerioder"),v=_(e.find(j=>j.id===i)),u=ve(t),S=v.arbeidsforhold.sluttdato,h=S?_(l.min(l(u),l(S))):u,D=new Date(v.behovForTilretteleggingFom),F=je(m,v.arbeidsforhold.stillinger),E=Ae(m,F),A=Ne(u,m);return s.jsx(s.Fragment,{children:g.map((j,p)=>{const w=ke(E,m[p],F),B=Ve(m[p].fom,D),ee=X(B,h);return s.jsxs(R.Fragment,{children:[s.jsxs(I,{gap:"1",children:[s.jsx(Se,{}),s.jsxs(z,{justify:"space-between",align:"center",children:[s.jsx(Ie,{variant:"info",className:o.element("tag"),children:Oe(p,u,a,m)}),p!==0&&s.jsx(W,{icon:s.jsx(Ee,{"aria-hidden":!0}),type:"button",variant:"tertiary",onClick:()=>f(p),children:s.jsx(c,{id:"perioder.varierende.slett"})})]})]}),s.jsx(q,{name:`varierendePerioder.${p}.fom`,label:a.formatMessage({id:"perioder.varierende.fom.label"}),minDate:D,maxDate:h,validate:[O(a.formatMessage({id:"valideringsfeil.periode.fom.påkrevd"})),K(a.formatMessage({id:"valideringsfeil.periode.fom.gyldigDato"})),G(a.formatMessage({id:"valideringsfeil.periode.fom.førTilDato"}),m[p].tom),G(r?a.formatMessage({id:"valideringsfeil.periode.fom.etterTreUkerFørTermin"}):a.formatMessage({id:"valideringsfeil.periode.fom.etterFødsel"}),u),Pe(a,p,m,v.behovForTilretteleggingFom,u,v.arbeidsforhold.navn||"",S)],defaultMonth:X(D,h)}),s.jsxs(ie,{name:`varierendePerioder.${p}.tomType`,label:s.jsx(c,{id:"perioder.varierende.tomType.label"}),validate:[O(r?a.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.termin"}):a.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.fødsel"})),Be(a,u,v.arbeidsforhold.navn||"",S)],children:[s.jsx($,{value:T.VALGFRI_DATO,children:s.jsx(c,{id:"perioder.varierende.tomType.valgfriDato"})}),s.jsx($,{value:T.SISTE_DAG_MED_SVP,children:r?s.jsx(c,{id:"perioder.varierende.tomType.treUkerFørTermin"}):s.jsx(c,{id:"perioder.varierende.tomType.dagenFørFødsel"})})]}),m[p].tomType===T.VALGFRI_DATO&&s.jsx(q,{name:`varierendePerioder.${p}.tom`,label:a.formatMessage({id:"perioder.varierende.tom.label"}),validate:[O(a.formatMessage({id:"valideringsfeil.periode.tom.påkrevd"})),K(a.formatMessage({id:"valideringsfeil.periode.tom.gyldigDato"})),pe(a.formatMessage({id:"valideringsfeil.periode.tom.etterTilDato"}),m[p].fom),G(r?a.formatMessage({id:"valideringsfeil.periode.tom.etterTreUkerFørTermin"}):a.formatMessage({id:"valideringsfeil.periode.tom.etterFødsel"}),u),we(a,v.arbeidsforhold.navn||"",S)],minDate:B,maxDate:h,defaultMonth:ee}),s.jsxs("div",{children:[s.jsx(se,{name:`varierendePerioder.${p}.stillingsprosent`,label:a.formatMessage({id:"perioder.varierende.stillingsprosent.label"}),className:o.element("stillingsprosent"),description:a.formatMessage({id:"tilrettelegging.tilrettelagtArbeidType.description"}),validate:[Le(a,w,E,m,F)]}),s.jsx(_e,{size:"medium",header:a.formatMessage({id:"tilrettelegging.varierendePerioderStillingsprosent.info.tittel"}),children:s.jsxs(I,{gap:"2",children:[s.jsx(b,{children:s.jsx(c,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del1"})}),s.jsx(b,{children:s.jsx(c,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del2"})})]})})]}),w&&s.jsx(le,{variant:"warning",children:s.jsxs(I,{gap:"4",children:[s.jsx(Z,{size:"small",children:s.jsx(c,{id:"perioder.alert.nySøknad.title"})}),s.jsx("div",{children:s.jsx(c,{id:"perioder.alert.nySøknad.del1"})}),s.jsx(c,{id:"perioder.alert.nySøknad.del2"})]})}),m&&p===m.length-1&&s.jsx(z,{children:s.jsx(W,{icon:s.jsx(he,{"aria-hidden":!0}),type:"button",variant:"secondary",onClick:()=>d(A),children:s.jsx(c,{id:"perioder.varierende.leggTil"})})})]},j.id)})})};try{N.displayName="PerioderFieldArray",N.__docgenInfo={description:"",displayName:"PerioderFieldArray",props:{tilrettelegginger:{defaultValue:null,description:"",name:"tilrettelegginger",required:!0,type:{name:"Tilrettelegging[]"}},barn:{defaultValue:null,description:"",name:"barn",required:!0,type:{name:"Barn"}},valgtTilretteleggingId:{defaultValue:null,description:"",name:"valgtTilretteleggingId",required:!0,type:{name:"string"}},kanHaSVPFremTilTreUkerFørTermin:{defaultValue:null,description:"",name:"kanHaSVPFremTilTreUkerFørTermin",required:!0,type:{name:"boolean"}}}}}catch{}const He=(e,t)=>{if(t===void 0&&e.length>0)return e[0].id;const i=e.findIndex(r=>r.id===t)+1;if(i!==e.length)return e[i].id},J=({mellomlagreSøknadOgNaviger:e,avbrytSøknad:t,arbeidsforhold:i})=>{const r=Q(),o=ce(i),a=ue(e,i),n=_(V(x.TILRETTELEGGINGER)),g=_(V(x.OM_BARNET)),d=_(V(x.VALGT_TILRETTELEGGING_ID)),[f]=R.useState(d),m=H(x.TILRETTELEGGINGER),v=H(x.VALGT_TILRETTELEGGING_ID),u=_(n.find(E=>E.id===f)),S=n.length>1,h=Te(g),D=E=>{const A=be(f,E,n);m(A);const j=He(n,f);return j&&v(j),a.goToNextStep(j?U.SKJEMA:U.OPPSUMMERING)},F=oe({shouldUnregister:!0,defaultValues:{varierendePerioder:u.varierendePerioder&&u.varierendePerioder.length>0?u.varierendePerioder:[$e]}});return s.jsx(me,{bannerTitle:r.formatMessage({id:"søknad.pageheading"}),onCancel:t,steps:o,onContinueLater:a.fortsettSøknadSenere,children:s.jsx(ae,{formMethods:F,onSubmit:D,children:s.jsxs(I,{gap:"10",children:[s.jsx(ne,{}),S&&s.jsx(ye,{arbeid:u.arbeidsforhold}),s.jsxs("div",{children:[s.jsx(Z,{size:"small",children:s.jsx(c,{id:"perioder.varierende.heading"})}),s.jsx(b,{children:h?s.jsx(c,{id:"perioder.varierende.description.termin"}):s.jsx(c,{id:"perioder.varierende.description.fødsel"})})]}),s.jsx(N,{valgtTilretteleggingId:f,barn:g,tilrettelegginger:n,kanHaSVPFremTilTreUkerFørTermin:h}),s.jsx(de,{goToPreviousStep:a.goToPreviousDefaultStep})]})})})};try{J.displayName="PerioderStep",J.__docgenInfo={description:"",displayName:"PerioderStep",props:{mellomlagreSøknadOgNaviger:{defaultValue:null,description:"",name:"mellomlagreSøknadOgNaviger",required:!0,type:{name:"() => Promise<void>"}},avbrytSøknad:{defaultValue:null,description:"",name:"avbrytSøknad",required:!0,type:{name:"() => Promise<void>"}},arbeidsforhold:{defaultValue:null,description:"",name:"arbeidsforhold",required:!0,type:{name:"Arbeidsforhold[]"}}}}}catch{}export{J as P};
