import{j as s}from"./jsx-runtime-Cw0GR0a5.js";import{u as j,C as S,b as te,c as C,a as G}from"./routes-B3RFaVmR.js";import{c,T as J,k as W,l as ie,m as se,n as ne,u as ae,a as oe,e as de,f as ge,h as me}from"./useSvpNavigator-B7tYbs4s.js";import{d as le,e as pe,c as $,a as ue,b as U,h as fe,u as ve,R as ce,E as ye,S as Te}from"./ErrorSummaryHookForm-t-_kRCRy.js";import{f as o,k as ke,I as X,R as E,u as Q,V as _,O as Se,a as H,B as z,J as Ee,M as v,d as he,e as V,A as Me,H as Z,F as je,c as be}from"./VeiviserPage-D7WQ0IyW.js";import{g as De,b as K,a as Ie}from"./dateUtils-BBU3Zcuz.js";import{r as Ae}from"./index-CTjT7uj6.js";import{n as x,i as O,a as Y,f as L,e as Fe}from"./minMax-B2WQ6Edu.js";import{B as _e}from"./Bedriftsbanner-DC8Wvaz7.js";import{g as T}from"./numberUtils-DCxWcr3S.js";import{h as q,b as B}from"./validationUtils-BITao2Py.js";import{T as xe}from"./Tag-CKjvAG2s.js";import{R as qe}from"./ReadMore-CvOMhRwt.js";import{S as Ne}from"./Plus-Bs8062gI.js";const Re=(e,t)=>o(e.fom).isBetween(t.fom,t.tom,"day","[]")||o(e.tom).isBetween(t.fom,t.tom,"day","[]")||o(t.fom).isBetween(e.fom,e.tom,"day","[]")||o(t.tom).isBetween(e.fom,e.tom,"day","[]"),Ge=(e,t,i)=>!!e&&q(t.fom)&&q(t.stillingsprosent)&&o(t.fom).isAfter(e.fom,"day")&&(i>0&&T(t.stillingsprosent)<i||i===0&&T(t.stillingsprosent)<100),Oe=(e,t)=>e?e.find(i=>t>0?q(i.stillingsprosent)&&T(i.stillingsprosent)===t:q(i.stillingsprosent)&&T(i.stillingsprosent)===100):void 0,Le=(e,t)=>e&&ke(e)?e:t,Ve=(e,t,i,a,n)=>{var l;const m=n&&n[e].tomType===c.SISTE_DAG_MED_SVP;if((l=n==null?void 0:n[e])!=null&&l.fom&&(m||n[e].tom)){const d=n[e].fom,r=n[e].tomType===c.SISTE_DAG_MED_SVP?t:o(n[e].tom).format(X),g=o(r).diff(d,"days")+1,p=Math.floor(g/7),k=g-p*7;let y=E(r);return m&&(y=a?i.formatMessage({id:"PerioderStep.TreUkerFørTermin"}):i.formatMessage({id:"PerioderStep.Fødsel"})),`${E(d)} - ${y} (${i.formatMessage({id:"PerioderStep.tidsperiode"},{ukeAntall:p,dagAntall:k})})`}return i.formatMessage({id:"ny.periode"})},Be=(e,t)=>{if(!t||t.length===0)return"";const i=t.filter(n=>n.tom||n.tomType===c.SISTE_DAG_MED_SVP).map(n=>n.tomType===c.SISTE_DAG_MED_SVP?o(e).add(1,"d"):o(n.tom)),a=i.length>0?o.max(i):void 0;return a?a.add(1,"d").format(X):""},we=(e,t)=>({fom:Be(e,t),tom:"",stillingsprosent:"",tomType:void 0,type:J.DELVIS}),Pe=(e,t)=>!t||t.trim()===""?e.formatMessage({id:"valideringsfeil.stillingsprosent.required"}):T(t)===void 0?e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreEtTall"}):void 0,Ce=(e,t,i,a,n)=>m=>{const l=Pe(e,m);if(l)return l;const d=T(m);if(d&&n>0&&d>n)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLikOpprinneligStillingsprosent"},{prosent:n});if(d&&n===0&&d>100)return e.formatMessage({id:"valideringsfeil.stillingsprosent.måVæreMindreEllerLik100Prosent"},{prosent:n});if(n>0&&(a!=null&&a.every(r=>r.stillingsprosent&&T(r.stillingsprosent)===n)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kunFullTilrettelegging"},{prosent:n});if(n===0&&(a!=null&&a.every(r=>r.stillingsprosent&&T(r.stillingsprosent)===100)))return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.kun100Prosent"},{prosent:n});if(t&&i)return e.formatMessage({id:"valideringsfeil.periode.stillingsprosent.nySøknad"},{fom:E(i.fom)})},$e=(e,t,i,a,n,m,l)=>d=>{const r=i&&i.length>0?i[t].tom:void 0,g=i&&i.length>0?i[t].tomType:void 0;if(d&&a&&o(d).isBefore(o(a),"d"))return e.formatMessage({id:"valideringsfeil.periode.fom.førBehovForTilretteleggingFom"});if(l&&o(d).isAfter(o(l),"d")){const k=B(l,e);return e.formatMessage({id:"valideringsfeil.periode.fom.etterSluttDatoArbeid"},{dato:E(l),navn:m,slutteTekst:k})}const p=ze(d,r,g,i,t,e,n);return p||Ke(d,i,n,e)},Ue=(e,t,i)=>a=>{if(i&&o(a).isAfter(o(i),"d")){const n=B(i,e);return e.formatMessage({id:"valideringsfeil.periode.tom.etterSluttDatoArbeid"},{dato:E(i),navn:t,slutteTekst:n})}},He=(e,t,i,a)=>n=>{if(a&&n===c.SISTE_DAG_MED_SVP&&o(t).isAfter(o(a),"d")){const m=B(a,e);return e.formatMessage({id:"valideringsfeil.periode.tomType.etterSluttDatoArbeid"},{navn:i,slutteTekst:m})}},ze=(e,t,i,a,n,m,l)=>{if((t||i)&&e&&a&&a.length>0){const r=a.filter((g,p)=>p>n).filter(g=>{let p;return g.tomType&&g.tomType===c.SISTE_DAG_MED_SVP&&(p=l),g.tom&&(p=g.tom),p?Re({fom:e,tom:t||l},{fom:g.fom,tom:p}):!1});if(r.length>0){const g=r[0].tom?r[0].tom:l;return m.formatMessage({id:"valideringsfeil.periode.overlapper"},{fom:E(r[0].fom),tom:E(g)})}}},Ke=(e,t,i,a)=>{const n=t?t.filter(r=>r.fom).map(r=>o(r.fom)):void 0,m=n?o.min(n):void 0;if(m&&o(e).isSameOrBefore(m,"day"))return;const l=t?t.filter(r=>r.tom||r.tomType===c.SISTE_DAG_MED_SVP).map(r=>r.tomType===c.SISTE_DAG_MED_SVP?o(i):o(r.tom)):void 0;if(!(l?l.find(r=>o(e).subtract(1,"d").isSame(o(r),"day")):void 0))return a.formatMessage({id:"valideringsfeil.periode.ikkeSammenhengende"})},Ye={type:J.DELVIS,fom:"",tom:"",stillingsprosent:"",tomType:void 0},ee=({barn:e,valgtTilretteleggingId:t,kanHaSVPFremTilTreUkerFørTermin:i,behovForTilretteleggingFom:a,arbeidsforhold:n,egenNæring:m,frilans:l})=>{const d=je("perioderStep"),r=Q(),g=De(e),p=W(r,t,n),k=ie(e.termindato,t,n,m,l),y=se(e.termindato,t,n,m,l),h=le(),{fields:N,append:I,remove:b}=pe({name:"varierendePerioder",control:h.control}),u=h.watch("varierendePerioder"),M=y.tom?x(o.min(o(g),o(y.tom))):g,D=ne(u,k),A=Oe(u,D),R=we(g,u);return s.jsx(s.Fragment,{children:N.map((F,f)=>{const w=Ge(A,u[f],D),P=Le(u[f].fom,a),re=K(P,M);return s.jsxs(Ae.Fragment,{children:[s.jsxs(_,{gap:"1",children:[s.jsx(Se,{}),s.jsxs(H,{justify:"space-between",align:"center",children:[s.jsx(xe,{variant:"info-moderate",className:d.element("tag"),children:Ve(f,g,r,i,u)}),f!==0&&s.jsx(z,{icon:s.jsx(Ee,{"aria-hidden":!0}),type:"button",variant:"tertiary",onClick:()=>b(f),children:s.jsx(v,{id:"perioder.varierende.slett"})})]})]}),s.jsx($,{name:`varierendePerioder.${f}.fom`,label:r.formatMessage({id:"perioder.varierende.fom.label"}),minDate:a,maxDate:M,validate:[O(r.formatMessage({id:"valideringsfeil.periode.fom.påkrevd"})),Y(r.formatMessage({id:"valideringsfeil.periode.fom.gyldigDato"})),L(r.formatMessage({id:"valideringsfeil.periode.fom.førTilDato"}),u[f].tom),L(i?r.formatMessage({id:"valideringsfeil.periode.fom.etterTreUkerFørTermin"}):r.formatMessage({id:"valideringsfeil.periode.fom.etterFødsel"}),g),$e(r,f,u,a,g,p||"",y.tom)],defaultMonth:K(a,M)}),s.jsxs(ue,{name:`varierendePerioder.${f}.tomType`,label:s.jsx(v,{id:"perioder.varierende.tomType.label"}),validate:[O(i?r.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.termin"}):r.formatMessage({id:"valideringsfeil.periode.tomType.påkrevd.fødsel"})),He(r,g,p||"",y.tom)],children:[s.jsx(U,{value:c.VALGFRI_DATO,children:s.jsx(v,{id:"perioder.varierende.tomType.valgfriDato"})}),s.jsx(U,{value:c.SISTE_DAG_MED_SVP,children:i?s.jsx(v,{id:"perioder.varierende.tomType.treUkerFørTermin"}):s.jsx(v,{id:"perioder.varierende.tomType.dagenFørFødsel"})})]}),u[f].tomType===c.VALGFRI_DATO&&s.jsx($,{name:`varierendePerioder.${f}.tom`,label:r.formatMessage({id:"perioder.varierende.tom.label"}),validate:[O(r.formatMessage({id:"valideringsfeil.periode.tom.påkrevd"})),Y(r.formatMessage({id:"valideringsfeil.periode.tom.gyldigDato"})),Fe(r.formatMessage({id:"valideringsfeil.periode.tom.etterTilDato"}),u[f].fom),L(i?r.formatMessage({id:"valideringsfeil.periode.tom.etterTreUkerFørTermin"}):r.formatMessage({id:"valideringsfeil.periode.tom.etterFødsel"}),g),Ue(r,p||"",y.tom)],minDate:P,maxDate:M,defaultMonth:re}),s.jsxs("div",{children:[s.jsx(fe,{name:`varierendePerioder.${f}.stillingsprosent`,label:r.formatMessage({id:"perioder.varierende.stillingsprosent.label"}),className:d.element("stillingsprosent"),description:r.formatMessage({id:"tilrettelegging.tilrettelagtArbeidType.description"}),validate:[Ce(r,w,A,u,D)]}),s.jsx(qe,{onOpenChange:he("Svangerskapspenger","Ikke_har_100%_stilling"),size:"medium",header:r.formatMessage({id:"tilrettelegging.varierendePerioderStillingsprosent.info.tittel"}),children:s.jsxs(_,{gap:"2",children:[s.jsx(V,{children:s.jsx(v,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del1"})}),s.jsx(V,{children:s.jsx(v,{id:"tilrettelegging.varierendePerioderStillingsprosent.info.tekst.del2"})})]})})]}),w&&s.jsx(Me,{variant:"warning",children:s.jsxs(_,{gap:"4",children:[s.jsx(Z,{size:"small",children:s.jsx(v,{id:"perioder.alert.nySøknad.title"})}),s.jsx("div",{children:s.jsx(v,{id:"perioder.alert.nySøknad.del1"})}),s.jsx(v,{id:"perioder.alert.nySøknad.del2"})]})}),u&&f===u.length-1&&s.jsx(H,{children:s.jsx(z,{icon:s.jsx(Ne,{"aria-hidden":!0}),type:"button",variant:"secondary",onClick:()=>I(R),children:s.jsx(v,{id:"perioder.varierende.leggTil"})})})]},F.id)})})};ee.__docgenInfo={description:"",methods:[],displayName:"PerioderFieldArray",props:{barn:{required:!0,tsType:{name:"Barn"},description:""},valgtTilretteleggingId:{required:!0,tsType:{name:"string"},description:""},kanHaSVPFremTilTreUkerFørTermin:{required:!0,tsType:{name:"boolean"},description:""},behovForTilretteleggingFom:{required:!0,tsType:{name:"string"},description:""},arbeidsforhold:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    arbeidsgiverNavn: string;
    arbeidsgiverId: string;
    arbeidsgiverIdType: string;
    fom: string;
    tom?: string;
    stillingsprosent: number;
}`,signature:{properties:[{key:"arbeidsgiverNavn",value:{name:"string",required:!0}},{key:"arbeidsgiverId",value:{name:"string",required:!0}},{key:"arbeidsgiverIdType",value:{name:"string",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!1}},{key:"stillingsprosent",value:{name:"number",required:!0}}]}}],raw:"Arbeidsforhold[]"},description:""},egenNæring:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    næringstype: Næringstype;
    fom: string;
    tom: string;
    næringsinntekt?: number;
    pågående: boolean; // Brukes ikke backend
    navnPåNæringen?: string;
    organisasjonsnummer?: string;
    registrertINorge: boolean;
    registrertILand?: string;
    harBlittYrkesaktivILøpetAvDeTreSisteFerdigliknedeÅrene?: boolean;
    oppstartsdato?: string;
    hattVarigEndringAvNæringsinntektSiste4Kalenderår?: boolean;
    varigEndringDato?: string;
    varigEndringInntektEtterEndring?: string;
    varigEndringBeskrivelse?: string;
}`,signature:{properties:[{key:"næringstype",value:{name:"Næringstype",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!0}},{key:"næringsinntekt",value:{name:"number",required:!1}},{key:"pågående",value:{name:"boolean",required:!0}},{key:"navnPåNæringen",value:{name:"string",required:!1}},{key:"organisasjonsnummer",value:{name:"string",required:!1}},{key:"registrertINorge",value:{name:"boolean",required:!0}},{key:"registrertILand",value:{name:"string",required:!1}},{key:"harBlittYrkesaktivILøpetAvDeTreSisteFerdigliknedeÅrene",value:{name:"boolean",required:!1}},{key:"oppstartsdato",value:{name:"string",required:!1}},{key:"hattVarigEndringAvNæringsinntektSiste4Kalenderår",value:{name:"boolean",required:!1}},{key:"varigEndringDato",value:{name:"string",required:!1}},{key:"varigEndringInntektEtterEndring",value:{name:"string",required:!1}},{key:"varigEndringBeskrivelse",value:{name:"string",required:!1}}]}},description:""},frilans:{required:!1,tsType:{name:"signature",type:"object",raw:`{
    jobberFremdelesSomFrilans: boolean;
    oppstart: string;
}`,signature:{properties:[{key:"jobberFremdelesSomFrilans",value:{name:"boolean",required:!0}},{key:"oppstart",value:{name:"string",required:!0}}]}},description:""}}};const Je=({mellomlagreSøknadOgNaviger:e,avbrytSøknad:t,arbeidsforhold:i})=>{const a=Q(),n=ae(i),m=oe(e,i),l=de(),d=x(l.tilretteleggingId),r=j(S.TILRETTELEGGINGER_PERIODER),g=x(j(S.TILRETTELEGGINGER)),p=x(j(S.OM_BARNET)),k=j(S.EGEN_NÆRING),y=j(S.FRILANS),h=j(S.VALGTE_ARBEIDSFORHOLD),N=te(S.TILRETTELEGGINGER_PERIODER),I=Ie(p),b=ge(d,i),u=W(a,d,i),M=g[d],D=R=>{if(N({...r,[d]:R.varierendePerioder}),b==="virksomhet"||b==="privat")return m.goToStep(C(G.FERIE,d));const F=me(d,h);return m.goToStep(F?C(G.SKJEMA,F):G.OPPSUMMERING)},A=ve({shouldUnregister:!0,defaultValues:{varierendePerioder:(r==null?void 0:r[d])??[Ye]}});return s.jsx(be,{bannerTitle:a.formatMessage({id:"søknad.pageheading"}),onCancel:t,steps:n,onContinueLater:m.fortsettSøknadSenere,onStepChange:m.goToStep,children:s.jsx(ce,{formMethods:A,onSubmit:D,children:s.jsxs(_,{gap:"10",children:[s.jsx(ye,{}),!!h&&h.length>1&&s.jsx(_e,{arbeidsforholdType:b,arbeidsforholdNavn:u}),s.jsxs("div",{children:[s.jsx(Z,{size:"small",children:s.jsx(v,{id:"perioder.varierende.heading"})}),s.jsx(V,{children:I?s.jsx(v,{id:"perioder.varierende.description.termin"}):s.jsx(v,{id:"perioder.varierende.description.fødsel"})})]}),s.jsx(ee,{valgtTilretteleggingId:d,barn:p,kanHaSVPFremTilTreUkerFørTermin:I,arbeidsforhold:i,egenNæring:k,frilans:y,behovForTilretteleggingFom:M.behovForTilretteleggingFom}),s.jsx(Te,{goToPreviousStep:m.goToPreviousDefaultStep})]})})})};Je.__docgenInfo={description:"",methods:[],displayName:"PerioderSteg",props:{mellomlagreSøknadOgNaviger:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},avbrytSøknad:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},arbeidsforhold:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    arbeidsgiverNavn: string;
    arbeidsgiverId: string;
    arbeidsgiverIdType: string;
    fom: string;
    tom?: string;
    stillingsprosent: number;
}`,signature:{properties:[{key:"arbeidsgiverNavn",value:{name:"string",required:!0}},{key:"arbeidsgiverId",value:{name:"string",required:!0}},{key:"arbeidsgiverIdType",value:{name:"string",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!1}},{key:"stillingsprosent",value:{name:"number",required:!0}}]}}],raw:"Arbeidsforhold[]"},description:""}}};export{Je as P};
