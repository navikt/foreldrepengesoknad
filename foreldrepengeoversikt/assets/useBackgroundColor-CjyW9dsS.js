import{r as C,R as x}from"./index-CR__hKHy.js";let ee=0;function ne(e,u){const t=`atom${++ee}`,d={toString(){return t}};return typeof e=="function"?d.read=e:(d.init=e,d.read=te,d.write=se),d}function te(e){return e(this)}function se(e,u,t){return u(this,typeof t=="function"?t(e(this)):t)}const m=(e,u)=>e.unstable_is?e.unstable_is(u):u===e,G=e=>"init"in e,J=e=>!!e.write,D=new WeakMap,T=e=>{var u;return H(e)&&!((u=D.get(e))!=null&&u[1])},oe=(e,u)=>{const t=D.get(e);t&&(t[1]=!0,t[0].forEach(d=>d(u)))},re=e=>{if(D.has(e))return;const u=[new Set,!1];D.set(e,u);const t=()=>{u[1]=!0};e.then(t,t),e.onCancel=d=>{u[0].add(d)}},H=e=>typeof(e==null?void 0:e.then)=="function",K=e=>"v"in e||"e"in e,W=e=>{if("e"in e)throw e.e;return e.v},V=(e,u,t)=>{t.p.has(e)||(t.p.add(e),u.then(()=>{t.p.delete(e)},()=>{t.p.delete(e)}))},ce=(e,u,t,d)=>{var y;u.d.set(t,d.n),T(u.v)&&V(e,u.v,d),(y=d.m)==null||y.t.add(e)},le=Symbol.for("JOTAI.EXPERIMENTAL.FLUSHSTOREHOOK"),X=(...e)=>{const[u,t,d,y,k,p]=e,h=s=>{let n=u(s);return n||(n={d:new Map,p:new Set,n:0},t(s,n),k==null||k(s,R)),n},b=new WeakMap,i=new Map,A=new Set,P=new Set,M=()=>{var s;const n=[],o=r=>{try{r()}catch(l){n.push(l)}};do{(s=R[le])==null||s.call(R);const r=new Set,l=r.add.bind(r);i.forEach(c=>{var f;return(f=c.m)==null?void 0:f.l.forEach(l)}),i.clear(),A.forEach(l),A.clear(),P.forEach(l),P.clear(),r.forEach(o),i.size&&E()}while(i.size||A.size||P.size);if(n.length)throw n[0]},I=(s,n,o)=>{const r="v"in n,l=n.v,c=T(n.v)?n.v:null;if(H(o)){re(o);for(const f of n.d.keys())V(s,o,h(f));n.v=o}else n.v=o;delete n.e,(!r||!Object.is(l,n.v))&&(++n.n,c&&oe(c,o))},_=s=>{var n;const o=h(s);if(K(o)&&(o.m&&b.get(s)!==o.n||Array.from(o.d).every(([a,w])=>_(a).n===w)))return o;o.d.clear();let r=!0;const l=()=>{o.m&&(O(s,o),E(),M())},c=a=>{if(m(s,a)){const j=h(a);if(!K(j))if(G(a))I(a,j,a.init);else throw new Error("no atom init");return W(j)}const w=_(a);try{return W(w)}finally{ce(s,o,a,w),r||l()}};let f,g;const v={get signal(){return f||(f=new AbortController),f.signal},get setSelf(){return!g&&J(s)&&(g=(...a)=>{if(!r)return $(s,...a)}),g}};try{const a=d(s,c,v);return I(s,o,a),H(a)&&((n=a.onCancel)==null||n.call(a,()=>f==null?void 0:f.abort()),a.then(l,l)),o}catch(a){return delete o.v,o.e=a,++o.n,o}finally{r=!1}},Z=s=>W(_(s)),B=s=>{var n;const o=new Map;for(const r of((n=s.m)==null?void 0:n.t)||[]){const l=h(r);l.m&&o.set(r,l)}for(const r of s.p)o.set(r,h(r));return o},U=s=>{const n=[s];for(;n.length;){const o=n.pop();for(const[r,l]of B(o))b.has(r)||(b.set(r,l.n),n.push(l))}},E=()=>{var s;const n=[],o=new WeakSet,r=new WeakSet,l=Array.from(i);for(;l.length;){const[c,f]=l[l.length-1];if(r.has(c)){l.pop();continue}if(o.has(c)){b.get(c)===f.n?n.push([c,f,f.n]):(b.delete(c),i.set(c,f)),r.add(c),l.pop();continue}o.add(c);for(const[g,v]of B(f))o.has(g)||l.push([g,v])}for(let c=n.length-1;c>=0;--c){const[f,g,v]=n[c];let a=!1;for(const w of g.d.keys())if(w!==f&&i.has(w)){a=!0;break}a&&(_(f),O(f,g),v!==g.n&&(i.set(f,g),(s=g.u)==null||s.call(g))),b.delete(f)}},S=(s,...n)=>{let o=!0;const r=c=>W(_(c)),l=(c,...f)=>{var g;const v=h(c);try{if(m(s,c)){if(!G(c))throw new Error("atom not writable");const a=v.n,w=f[0];I(c,v,w),O(c,v),a!==v.n&&(i.set(c,v),(g=v.u)==null||g.call(v),U(v));return}else return S(c,...f)}finally{o||(E(),M())}};try{return y(s,r,l,...n)}finally{o=!1}},$=(s,...n)=>{try{return S(s,...n)}finally{E(),M()}},O=(s,n)=>{var o;if(n.m&&!T(n.v)){for(const[r,l]of n.d)if(!n.m.d.has(r)){const c=h(r);z(r,c).t.add(s),n.m.d.add(r),l!==c.n&&(i.set(r,c),(o=c.u)==null||o.call(c),U(c))}for(const r of n.m.d||[])if(!n.d.has(r)){n.m.d.delete(r);const l=F(r,h(r));l==null||l.t.delete(s)}}},z=(s,n)=>{var o;if(!n.m){_(s);for(const r of n.d.keys())z(r,h(r)).t.add(s);if(n.m={l:new Set,d:new Set(n.d.keys()),t:new Set},(o=n.h)==null||o.call(n),J(s)){const r=n.m,l=()=>{let c=!0;const f=(...g)=>{try{return S(s,...g)}finally{c||(E(),M())}};try{const g=p(s,f);g&&(r.u=()=>{c=!0;try{g()}finally{c=!1}})}finally{c=!1}};P.add(l)}}return n.m},F=(s,n)=>{var o;if(n.m&&!n.m.l.size&&!Array.from(n.m.t).some(r=>{var l;return(l=h(r).m)==null?void 0:l.d.has(s)})){const r=n.m.u;r&&A.add(r),delete n.m,(o=n.h)==null||o.call(n);for(const l of n.d.keys()){const c=F(l,h(l));c==null||c.t.delete(s)}return}return n.m},R={get:Z,set:$,sub:(s,n)=>{const o=h(s),l=z(s,o).l;return l.add(n),M(),()=>{l.delete(n),F(s,o),M()}},unstable_derive:s=>X(...s(...e))};return R},ue=()=>{const e=new WeakMap;return X(t=>e.get(t),(t,d)=>e.set(t,d).get(t),(t,...d)=>t.read(...d),(t,...d)=>t.write(...d),(t,...d)=>{var y;return(y=t.unstable_onInit)==null?void 0:y.call(t,...d)},(t,...d)=>{var y;return(y=t.onMount)==null?void 0:y.call(t,...d)})};let L;const ie=()=>(L||(L=ue()),L),de=C.createContext(void 0),q=e=>C.useContext(de)||ie(),Q=e=>typeof(e==null?void 0:e.then)=="function",fe=e=>{e.status="pending",e.then(u=>{e.status="fulfilled",e.value=u},u=>{e.status="rejected",e.reason=u})},ae=x.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(fe(e),e)}),N=new WeakMap,he=e=>{let u=N.get(e);return u||(u=new Promise((t,d)=>{let y=e;const k=b=>i=>{y===b&&t(i)},p=b=>i=>{y===b&&d(i)},h=b=>{"onCancel"in b&&typeof b.onCancel=="function"&&b.onCancel(i=>{Q(i)?(N.set(i,u),y=i,i.then(k(i),p(i)),h(i)):t(i)})};e.then(k(e),p(e)),h(e)}),N.set(e,u)),u};function ge(e,u){const t=q(),[[d,y,k],p]=C.useReducer(i=>{const A=t.get(e);return Object.is(i[0],A)&&i[1]===t&&i[2]===e?i:[A,t,e]},void 0,()=>[t.get(e),t,e]);let h=d;if((y!==t||k!==e)&&(p(),h=t.get(e)),C.useEffect(()=>{const i=t.sub(e,()=>{p()});return p(),i},[t,e,void 0]),C.useDebugValue(h),Q(h)){const i=he(h);return ae(i)}return h}function ye(e,u){const t=q();return C.useCallback((...y)=>t.set(e,...y),[t,e])}const Y=ne("blue"),pe=()=>ge(Y),ke=e=>{const u=ye(Y);C.useEffect(()=>{u(e)},[u,e])};export{pe as a,ne as b,ye as c,ge as d,ke as u};
