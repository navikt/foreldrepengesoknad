import{r as C,R as H}from"./index-CTjT7uj6.js";const O={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,STORYBOOK:"true"};let Q=0;function _n(n,r){const i=`atom${++Q}`,u={toString(){return(O?"production":void 0)!=="production"&&this.debugLabel?i+":"+this.debugLabel:i}};return typeof n=="function"?u.read=n:(u.init=n,u.read=X,u.write=Z),u}function X(n){return n(this)}function Z(n,r,i){return r(this,typeof i=="function"?i(n(this)):i)}const W=(n,r)=>n.unstable_is?n.unstable_is(r):r===n,U=n=>"init"in n,N=n=>!!n.write,V=Symbol((O?"production":void 0)!=="production"?"CONTINUE_PROMISE":""),z="pending",a="fulfilled",S="rejected",m=n=>typeof n=="object"&&n!==null&&V in n,L=new WeakMap,nn=(n,r,i)=>{if(!L.has(n)){let u;const h=new Promise((P,D)=>{let E=n;const T=b=>M=>{E===b&&(h.status=a,h.value=M,P(M),i())},p=b=>M=>{E===b&&(h.status=S,h.reason=M,D(M),i())};n.then(T(n),p(n)),u=(b,M)=>{b&&(L.set(b,h),E=b,b.then(T(b),p(b)),r(),r=M)}});h.status=z,h[V]=u,L.set(n,h)}return L.get(n)},en=n=>typeof(n==null?void 0:n.then)=="function",$=n=>"v"in n||"e"in n,j=n=>{if("e"in n)throw n.e;if((O?"production":void 0)!=="production"&&!("v"in n))throw new Error("[Bug] atom state is not initialized");return n.v},F=n=>{const r=n.v;return m(r)&&r.status===z?r:null},G=(n,r,i)=>{i.p.has(n)||(i.p.add(n),r.then(()=>{i.p.delete(n)},()=>{i.p.delete(n)}))},K=(n,r,i,u,h)=>{var P;if((O?"production":void 0)!=="production"&&u===r)throw new Error("[Bug] atom cannot depend on itself");i.d.set(u,h.n);const D=F(i);D&&G(r,D,h),(P=h.m)==null||P.t.add(r),n&&sn(n,u,r)},k=()=>[new Map,new Map,new Set],B=(n,r,i)=>{n[0].has(r)||n[0].set(r,new Set),n[1].set(r,i)},sn=(n,r,i)=>{const u=n[0].get(r);u&&u.add(i)},on=(n,r)=>n[0].get(r),Y=(n,r)=>{n[2].add(r)},R=n=>{for(;n[1].size||n[2].size;){n[0].clear();const r=new Set(n[1].values());n[1].clear();const i=new Set(n[2]);n[2].clear(),r.forEach(u=>{var h;return(h=u.m)==null?void 0:h.l.forEach(P=>P())}),i.forEach(u=>u())}},q=n=>{let r;(O?"production":void 0)!=="production"&&(r=new Set);const i=(t,s,e,o=()=>{},d=()=>{})=>{const l="v"in s,f=s.v,v=F(s);if(en(e))if(v)v!==e&&(v[V](e,o),++s.n);else{const _=nn(e,o,d);if(_.status===z)for(const c of s.d.keys())G(t,_,n(c,s));s.v=_,delete s.e}else v&&v[V](Promise.resolve(e),o),s.v=e,delete s.e;(!l||!Object.is(f,s.v))&&++s.n},u=(t,s,e,o)=>{if(!(o!=null&&o(s))&&$(e)&&(e.m||Array.from(e.d).every(([c,w])=>u(t,c,n(c,e),o).n===w)))return e;e.d.clear();let d=!0;const l=c=>{if(W(s,c)){const y=n(c,e);if(!$(y))if(U(c))i(c,y,c.init);else throw new Error("no atom init");return j(y)}const w=u(t,c,n(c,e),o);if(d)K(t,s,e,c,w);else{const y=k();K(y,s,e,c,w),p(y,s,e),R(y)}return j(w)};let f,v;const _={get signal(){return f||(f=new AbortController),f.signal},get setSelf(){return(O?"production":void 0)!=="production"&&!N(s)&&console.warn("setSelf function cannot be used with read-only atom"),!v&&N(s)&&(v=(...c)=>{if((O?"production":void 0)!=="production"&&d&&console.warn("setSelf function cannot be called in sync"),!d)return T(s,...c)}),v}};try{const c=s.read(l,_);return i(s,e,c,()=>f==null?void 0:f.abort(),()=>{if(e.m){const w=k();p(w,s,e),R(w)}}),e}catch(c){return delete e.v,e.e=c,++e.n,e}finally{d=!1}},h=t=>j(u(void 0,t,n(t))),P=(t,s,e)=>{var o,d;const l=new Map;for(const f of((o=e.m)==null?void 0:o.t)||[])l.set(f,n(f,e));for(const f of e.p)l.set(f,n(f,e));return(d=on(t,s))==null||d.forEach(f=>{l.set(f,n(f,e))}),l},D=(t,s,e)=>{const o=[],d=new Set,l=(_,c)=>{if(!d.has(_)){d.add(_);for(const[w,y]of P(t,_,c))_!==w&&l(w,y);o.push([_,c,c.n])}};l(s,e);const f=new Set([s]),v=_=>d.has(_);for(let _=o.length-1;_>=0;--_){const[c,w,y]=o[_];let g=!1;for(const I of w.d.keys())if(I!==c&&f.has(I)){g=!0;break}g&&(u(t,c,w,v),p(t,c,w),y!==w.n&&(B(t,c,w),f.add(c))),d.delete(c)}},E=(t,s,e,...o)=>{const d=v=>j(u(t,v,n(v,e))),l=(v,..._)=>{const c=n(v,e);let w;if(W(s,v)){if(!U(v))throw new Error("atom not writable");const y="v"in c,g=c.v,I=_[0];i(v,c,I),p(t,v,c),(!y||!Object.is(g,c.v))&&(B(t,v,c),D(t,v,c))}else w=E(t,v,c,..._);return R(t),w};return s.write(d,l,...o)},T=(t,...s)=>{const e=k(),o=E(e,t,n(t),...s);return R(e),o},p=(t,s,e)=>{if(e.m&&!F(e)){for(const o of e.d.keys())e.m.d.has(o)||(b(t,o,n(o,e)).t.add(s),e.m.d.add(o));for(const o of e.m.d||[])if(!e.d.has(o)){e.m.d.delete(o);const d=M(t,o,n(o,e));d==null||d.t.delete(s)}}},b=(t,s,e)=>{if(!e.m){u(t,s,e);for(const o of e.d.keys())b(t,o,n(o,e)).t.add(s);if(e.m={l:new Set,d:new Set(e.d.keys()),t:new Set},(O?"production":void 0)!=="production"&&r.add(s),N(s)&&s.onMount){const o=e.m,{onMount:d}=s;Y(t,()=>{const l=d((...f)=>E(t,s,e,...f));l&&(o.u=l)})}}return e.m},M=(t,s,e)=>{if(e.m&&!e.m.l.size&&!Array.from(e.m.t).some(o=>{var d;return(d=n(o,e).m)==null?void 0:d.d.has(s)})){const o=e.m.u;o&&Y(t,o),delete e.m,(O?"production":void 0)!=="production"&&r.delete(s);for(const l of e.d.keys()){const f=M(t,l,n(l,e));f==null||f.t.delete(s)}const d=F(e);d&&d[V](void 0,()=>{});return}return e.m},J={get:h,set:T,sub:(t,s)=>{const e=k(),o=n(t),d=b(e,t,o);R(e);const l=d.l;return l.add(s),()=>{l.delete(s);const f=k();M(f,t,o),R(f)}},unstable_derive:t=>q(...t(n))};return(O?"production":void 0)!=="production"&&Object.assign(J,{dev4_get_internal_weak_map:()=>({get:s=>{const e=n(s);if(e.n!==0)return e}}),dev4_get_mounted_atoms:()=>r,dev4_restore_atoms:s=>{const e=k();for(const[o,d]of s)if(U(o)){const l=n(o),f="v"in l,v=l.v;i(o,l,d),p(e,o,l),(!f||!Object.is(v,l.v))&&(B(e,o,l),D(e,o,l))}R(e)}}),J},rn=()=>{const n=new WeakMap;return q(i=>{let u=n.get(i);return u||(u={d:new Map,p:new Set,n:0},n.set(i,u)),u})};let A;const tn=()=>(A||(A=rn(),(O?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=A),globalThis.__JOTAI_DEFAULT_STORE__!==A&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),A),cn={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,STORYBOOK:"true"},un=C.createContext(void 0),x=n=>C.useContext(un)||tn(),dn=n=>typeof(n==null?void 0:n.then)=="function",ln=H.use||(n=>{if(n.status==="pending")throw n;if(n.status==="fulfilled")return n.value;throw n.status==="rejected"?n.reason:(n.status="pending",n.then(r=>{n.status="fulfilled",n.value=r},r=>{n.status="rejected",n.reason=r}),n)});function wn(n,r){const i=x(),[[u,h,P],D]=C.useReducer(p=>{const b=i.get(n);return Object.is(p[0],b)&&p[1]===i&&p[2]===n?p:[b,i,n]},void 0,()=>[i.get(n),i,n]);let E=u;return(h!==i||P!==n)&&(D(),E=i.get(n)),C.useEffect(()=>{const p=i.sub(n,()=>{D()});return D(),p},[i,n,void 0]),C.useDebugValue(E),dn(E)?ln(E):E}function bn(n,r){const i=x();return C.useCallback((...h)=>{if((cn?"production":void 0)!=="production"&&!("write"in n))throw new Error("not writable atom");return i.set(n,...h)},[i,n])}export{_n as a,wn as b,bn as u};
