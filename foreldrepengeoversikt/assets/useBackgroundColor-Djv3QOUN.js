import{r as P,R as Y}from"./index-BX3iQpgp.js";let Z=0;function O(e,t){const s=`atom${++Z}`,u={toString(){return s}};return typeof e=="function"?u.read=e:(u.init=e,u.read=S,u.write=m),u}function S(e){return e(this)}function m(e,t,s){return t(this,typeof s=="function"?s(e(this)):s)}const N=(e,t)=>e.unstable_is?e.unstable_is(t):t===e,U=e=>"init"in e,$=e=>!!e.write,L=new WeakMap,z=e=>{var t;return W(e)&&!((t=L.get(e))!=null&&t[1])},ee=(e,t)=>{const s=L.get(e);s&&(s[1]=!0,s[0].forEach(u=>u(t)))},ne=e=>{if(L.has(e))return;const t=[new Set,!1];L.set(e,t);const s=()=>{t[1]=!0};e.then(s,s),e.onCancel=u=>{t[0].add(u)}},W=e=>typeof(e==null?void 0:e.then)=="function",G=e=>"v"in e||"e"in e,b=e=>{if("e"in e)throw e.e;return e.v},q=(e,t,s)=>{s.p.has(e)||(s.p.add(e),t.then(()=>{s.p.delete(e)},()=>{s.p.delete(e)}))},T=(e,t,s,u,d)=>{var v;s.d.set(u,d.n),z(s.v)&&q(t,s.v,d),(v=d.m)==null||v.t.add(t),e&&te(e,u,t)},A=()=>({D:new Map,H:new Set,M:new Set,L:new Set}),_=(e,t,s)=>{e[t].add(s)},V=(e,t,s)=>{e.D.has(t)||(e.D.set(t,new Set),_(e,"M",()=>{var u;(u=s.m)==null||u.l.forEach(d=>_(e,"M",d))}))},te=(e,t,s)=>{const u=e.D.get(t);u&&u.add(s)},se=(e,t)=>e.D.get(t),D=e=>{let t,s=!1;const u=d=>{try{d()}catch(v){s||(t=v,s=!0)}};for(;e.H.size||e.M.size||e.L.size;)e.D.clear(),e.H.forEach(u),e.H.clear(),e.M.forEach(u),e.M.clear(),e.L.forEach(u),e.L.clear();if(s)throw t},J=(...[e,t,s,u])=>{const d=(i,r,o)=>{const n="v"in r,f=r.v,y=z(r.v)?r.v:null;if(W(o)){ne(o);for(const c of r.d.keys())q(i,o,e(c));r.v=o}else r.v=o;delete r.e,delete r.x,(!n||!Object.is(f,r.v))&&(++r.n,y&&ee(y,o))},v=(i,r)=>{var o;const n=e(r);if(G(n)&&(n.m&&!n.x||Array.from(n.d).every(([l,p])=>v(i,l).n===p)))return n;n.d.clear();let f=!0;const y=l=>{if(N(r,l)){const g=e(l);if(!G(g))if(U(l))d(l,g,l.init);else throw new Error("no atom init");return b(g)}const p=v(i,l);try{return b(p)}finally{if(f)T(i,r,n,l,p);else{const g=A();T(g,r,n,l,p),B(g,r,n),D(g)}}};let c,a;const h={get signal(){return c||(c=new AbortController),c.signal},get setSelf(){return!a&&$(r)&&(a=(...l)=>{if(!f)return E(r,...l)}),a}};try{const l=t(r,y,h);if(d(r,n,l),W(l)){(o=l.onCancel)==null||o.call(l,()=>c==null?void 0:c.abort());const p=()=>{if(n.m){const g=A();B(g,r,n),D(g)}};l.then(p,p)}return n}catch(l){return delete n.v,n.e=l,delete n.x,++n.n,n}finally{f=!1}},C=i=>b(v(void 0,i)),M=(i,r,o)=>{var n,f;const y=new Map;for(const c of((n=o.m)==null?void 0:n.t)||[]){const a=e(c);a.m&&y.set(c,a)}for(const c of o.p)y.set(c,e(c));return(f=se(i,r))==null||f.forEach(c=>{y.set(c,e(c))}),y},k=(i,r,o)=>{const n=[],f=new Set,y=new Set,c=[[r,o]];for(;c.length>0;){const[a,h]=c[c.length-1];if(y.has(a)){c.pop();continue}if(f.has(a)){n.push([a,h,h.n]),y.add(a),h.x=!0,c.pop();continue}f.add(a);for(const[l,p]of M(i,a,h))a!==l&&!f.has(l)&&c.push([l,p])}_(i,"H",()=>{const a=new Set([r]);for(let h=n.length-1;h>=0;--h){const[l,p,g]=n[h];let x=!1;for(const I of p.d.keys())if(I!==l&&a.has(I)){x=!0;break}x&&(v(i,l),B(i,l,p),g!==p.n&&(V(i,l,p),a.add(l))),delete p.x}})},w=(i,r,...o)=>{let n=!0;const f=c=>b(v(i,c)),y=(c,...a)=>{const h=e(c);try{if(N(r,c)){if(!U(c))throw new Error("atom not writable");const l=h.n,p=a[0];d(c,h,p),B(i,c,h),l!==h.n&&(V(i,c,h),k(i,c,h));return}else return w(i,c,...a)}finally{n||D(i)}};try{return s(r,f,y,...o)}finally{n=!1}},E=(i,...r)=>{const o=A();try{return w(o,i,...r)}finally{D(o)}},B=(i,r,o)=>{if(o.m&&!z(o.v)){for(const n of o.d.keys())o.m.d.has(n)||(R(i,n,e(n)).t.add(r),o.m.d.add(n));for(const n of o.m.d||[])if(!o.d.has(n)){o.m.d.delete(n);const f=F(i,n,e(n));f==null||f.t.delete(r)}}},R=(i,r,o)=>{if(!o.m){v(i,r);for(const n of o.d.keys())R(i,n,e(n)).t.add(r);if(o.m={l:new Set,d:new Set(o.d.keys()),t:new Set},$(r)){const n=o.m;let f;const y=(c,a)=>{let h=!0;f=(...l)=>{try{return w(c,r,...l)}finally{h||D(c)}};try{return a()}finally{h=!1}};_(i,"L",()=>{const c=y(i,()=>u(r,(...a)=>f(...a)));c&&(n.u=a=>y(a,c))})}}return o.m},F=(i,r,o)=>{if(o.m&&!o.m.l.size&&!Array.from(o.m.t).some(n=>{var f;return(f=e(n).m)==null?void 0:f.d.has(r)})){const n=o.m.u;n&&_(i,"L",()=>n(i)),delete o.m;for(const f of o.d.keys()){const y=F(i,f,e(f));y==null||y.t.delete(r)}return}return o.m};return{get:C,set:E,sub:(i,r)=>{const o=A(),n=e(i),y=R(o,i,n).l;return y.add(r),D(o),()=>{y.delete(r);const c=A();F(c,i,n),D(c)}},unstable_derive:i=>J(...i(e,t,s,u))}},re=()=>{const e=new WeakMap;return J(u=>{let d=e.get(u);return d||(d={d:new Map,p:new Set,n:0},e.set(u,d)),d},(u,...d)=>u.read(...d),(u,...d)=>u.write(...d),(u,...d)=>{var v;return(v=u.onMount)==null?void 0:v.call(u,...d)})};let H;const oe=()=>(H||(H=re()),H),ce=P.createContext(void 0),K=e=>P.useContext(ce)||oe(),Q=e=>typeof(e==null?void 0:e.then)=="function",ie=e=>{e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t})},ue=Y.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(ie(e),e)}),j=new WeakMap,le=e=>{let t=j.get(e);return t||(t=new Promise((s,u)=>{let d=e;const v=k=>w=>{d===k&&s(w)},C=k=>w=>{d===k&&u(w)},M=k=>{"onCancel"in k&&typeof k.onCancel=="function"&&k.onCancel(w=>{Q(w)?(j.set(w,t),d=w,w.then(v(w),C(w)),M(w)):s(w)})};e.then(v(e),C(e)),M(e)}),j.set(e,t)),t};function de(e,t){const s=K(),[[u,d,v],C]=P.useReducer(w=>{const E=s.get(e);return Object.is(w[0],E)&&w[1]===s&&w[2]===e?w:[E,s,e]},void 0,()=>[s.get(e),s,e]);let M=u;if((d!==s||v!==e)&&(C(),M=s.get(e)),P.useEffect(()=>{const w=s.sub(e,()=>{C()});return C(),w},[s,e,void 0]),P.useDebugValue(M),Q(M)){const w=le(M);return ue(w)}return M}function fe(e,t){const s=K();return P.useCallback((...d)=>s.set(e,...d),[s,e])}const X=O("blue"),ve=()=>de(X),pe=e=>{const t=fe(X);P.useEffect(()=>{t(e)},[t,e])};export{ve as a,O as b,fe as c,de as d,pe as u};
