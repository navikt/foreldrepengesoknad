import{r as R,R as Q}from"./index-CTjT7uj6.js";const M={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,STORYBOOK:"true"};let X=0;function Z(n,r){const t=`atom${++X}`,u={toString(){return(M?"production":void 0)!=="production"&&this.debugLabel?t+":"+this.debugLabel:t}};return typeof n=="function"?u.read=n:(u.init=n,u.read=a,u.write=S),u}function a(n){return n(this)}function S(n,r,t){return r(this,typeof t=="function"?t(n(this)):t)}const W=(n,r)=>n.unstable_is?n.unstable_is(r):r===n,U=n=>"init"in n,B=n=>!!n.write,A=Symbol((M?"production":void 0)!=="production"?"CONTINUE_PROMISE":""),z="pending",m="fulfilled",nn="rejected",en=n=>typeof n=="object"&&n!==null&&A in n,L=new WeakMap,sn=(n,r,t)=>{if(!L.has(n)){let u;const h=new Promise((O,k)=>{let E=n;const C=w=>D=>{E===w&&(h.status=m,h.value=D,O(D),t())},p=w=>D=>{E===w&&(h.status=nn,h.reason=D,k(D),t())};n.then(C(n),p(n)),u=(w,D)=>{w&&(L.set(w,h),E=w,w.then(C(w),p(w)),r(),r=D)}});h.status=z,h[A]=u,L.set(n,h)}return L.get(n)},on=n=>typeof(n==null?void 0:n.then)=="function",$=n=>"v"in n||"e"in n,j=n=>{if("e"in n)throw n.e;if((M?"production":void 0)!=="production"&&!("v"in n))throw new Error("[Bug] atom state is not initialized");return n.v},F=n=>{const r=n.v;return en(r)&&r.status===z?r:null},Y=(n,r,t)=>{t.p.has(n)||(t.p.add(n),r.then(()=>{t.p.delete(n)},()=>{t.p.delete(n)}))},G=(n,r,t,u,h)=>{var O;if((M?"production":void 0)!=="production"&&u===r)throw new Error("[Bug] atom cannot depend on itself");t.d.set(u,h.n);const k=F(t);k&&Y(r,k,h),(O=h.m)==null||O.t.add(r),n&&rn(n,u,r)},g=()=>[new Map,new Map,new Set],N=(n,r,t)=>{n[0].has(r)||n[0].set(r,new Set),n[1].set(r,t)},rn=(n,r,t)=>{const u=n[0].get(r);u&&u.add(t)},tn=(n,r)=>n[0].get(r),K=(n,r)=>{n[2].add(r)},P=n=>{for(;n[1].size||n[2].size;){n[0].clear();const r=new Set(n[1].values());n[1].clear();const t=new Set(n[2]);n[2].clear(),r.forEach(u=>{var h;return(h=u.m)==null?void 0:h.l.forEach(O=>O())}),t.forEach(u=>u())}},q=n=>{let r;(M?"production":void 0)!=="production"&&(r=new Set);const t=(i,s,e,o=()=>{},d=()=>{})=>{const l="v"in s,f=s.v,v=F(s);if(on(e))if(v)v!==e&&(v[A](e,o),++s.n);else{const _=sn(e,o,d);if(_.status===z)for(const c of s.d.keys())Y(i,_,n(c,s));s.v=_,delete s.e}else v&&v[A](Promise.resolve(e),o),s.v=e,delete s.e;(!l||!Object.is(f,s.v))&&++s.n},u=(i,s,e,o)=>{if(!(o!=null&&o(s))&&$(e)&&(e.m||Array.from(e.d).every(([c,b])=>u(i,c,n(c,e),o).n===b)))return e;e.d.clear();let d=!0;const l=c=>{if(W(s,c)){const y=n(c,e);if(!$(y))if(U(c))t(c,y,c.init);else throw new Error("no atom init");return j(y)}const b=u(i,c,n(c,e),o);if(d)G(i,s,e,c,b);else{const y=g();G(y,s,e,c,b),p(y,s,e),P(y)}return j(b)};let f,v;const _={get signal(){return f||(f=new AbortController),f.signal},get setSelf(){return(M?"production":void 0)!=="production"&&!B(s)&&console.warn("setSelf function cannot be used with read-only atom"),!v&&B(s)&&(v=(...c)=>{if((M?"production":void 0)!=="production"&&d&&console.warn("setSelf function cannot be called in sync"),!d)return C(s,...c)}),v}};try{const c=s.read(l,_);return t(s,e,c,()=>f==null?void 0:f.abort(),()=>{if(e.m){const b=g();p(b,s,e),P(b)}}),e}catch(c){return delete e.v,e.e=c,++e.n,e}finally{d=!1}},h=i=>j(u(void 0,i,n(i))),O=(i,s,e)=>{var o,d;const l=new Map;for(const f of((o=e.m)==null?void 0:o.t)||[])l.set(f,n(f,e));for(const f of e.p)l.set(f,n(f,e));return(d=tn(i,s))==null||d.forEach(f=>{l.set(f,n(f,e))}),l},k=(i,s,e)=>{const o=[],d=new Set,l=(_,c)=>{if(!d.has(_)){d.add(_);for(const[b,y]of O(i,_,c))_!==b&&l(b,y);o.push([_,c,c.n])}};l(s,e);const f=new Set([s]),v=_=>d.has(_);for(let _=o.length-1;_>=0;--_){const[c,b,y]=o[_];let V=!1;for(const I of b.d.keys())if(I!==c&&f.has(I)){V=!0;break}V&&(u(i,c,b,v),p(i,c,b),y!==b.n&&(N(i,c,b),f.add(c))),d.delete(c)}},E=(i,s,e,...o)=>{const d=v=>j(u(i,v,n(v,e))),l=(v,..._)=>{const c=n(v,e);let b;if(W(s,v)){if(!U(v))throw new Error("atom not writable");const y="v"in c,V=c.v,I=_[0];t(v,c,I),p(i,v,c),(!y||!Object.is(V,c.v))&&(N(i,v,c),k(i,v,c))}else b=E(i,v,c,..._);return P(i),b};return s.write(d,l,...o)},C=(i,...s)=>{const e=g(),o=E(e,i,n(i),...s);return P(e),o},p=(i,s,e)=>{if(e.m&&!F(e)){for(const o of e.d.keys())e.m.d.has(o)||(w(i,o,n(o,e)).t.add(s),e.m.d.add(o));for(const o of e.m.d||[])if(!e.d.has(o)){e.m.d.delete(o);const d=D(i,o,n(o,e));d==null||d.t.delete(s)}}},w=(i,s,e)=>{if(!e.m){u(i,s,e);for(const o of e.d.keys())w(i,o,n(o,e)).t.add(s);if(e.m={l:new Set,d:new Set(e.d.keys()),t:new Set},(M?"production":void 0)!=="production"&&r.add(s),B(s)&&s.onMount){const o=e.m,{onMount:d}=s;K(i,()=>{const l=d((...f)=>E(i,s,e,...f));l&&(o.u=l)})}}return e.m},D=(i,s,e)=>{if(e.m&&!e.m.l.size&&!Array.from(e.m.t).some(o=>{var d;return(d=n(o,e).m)==null?void 0:d.d.has(s)})){const o=e.m.u;o&&K(i,o),delete e.m,(M?"production":void 0)!=="production"&&r.delete(s);for(const l of e.d.keys()){const f=D(i,l,n(l,e));f==null||f.t.delete(s)}const d=F(e);d&&d[A](void 0,()=>{});return}return e.m},J={get:h,set:C,sub:(i,s)=>{const e=g(),o=n(i),d=w(e,i,o);P(e);const l=d.l;return l.add(s),()=>{l.delete(s);const f=g();D(f,i,o),P(f)}},unstable_derive:i=>q(...i(n))};return(M?"production":void 0)!=="production"&&Object.assign(J,{dev4_get_internal_weak_map:()=>({get:s=>{const e=n(s);if(e.n!==0)return e}}),dev4_get_mounted_atoms:()=>r,dev4_restore_atoms:s=>{const e=g();for(const[o,d]of s)if(U(o)){const l=n(o),f="v"in l,v=l.v;t(o,l,d),p(e,o,l),(!f||!Object.is(v,l.v))&&(N(e,o,l),k(e,o,l))}P(e)}}),J},cn=()=>{const n=new WeakMap;return q(t=>{let u=n.get(t);return u||(u={d:new Map,p:new Set,n:0},n.set(t,u)),u})};let T;const un=()=>(T||(T=cn(),(M?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=T),globalThis.__JOTAI_DEFAULT_STORE__!==T&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),T),dn={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,STORYBOOK:"true"},ln=R.createContext(void 0),x=n=>R.useContext(ln)||un(),fn=n=>typeof(n==null?void 0:n.then)=="function",vn=Q.use||(n=>{if(n.status==="pending")throw n;if(n.status==="fulfilled")return n.value;throw n.status==="rejected"?n.reason:(n.status="pending",n.then(r=>{n.status="fulfilled",n.value=r},r=>{n.status="rejected",n.reason=r}),n)});function hn(n,r){const t=x(),[[u,h,O],k]=R.useReducer(p=>{const w=t.get(n);return Object.is(p[0],w)&&p[1]===t&&p[2]===n?p:[w,t,n]},void 0,()=>[t.get(n),t,n]);let E=u;return(h!==t||O!==n)&&(k(),E=t.get(n)),R.useEffect(()=>{const p=t.sub(n,()=>{k()});return k(),p},[t,n,void 0]),R.useDebugValue(E),fn(E)?vn(E):E}function _n(n,r){const t=x();return R.useCallback((...h)=>{if((dn?"production":void 0)!=="production"&&!("write"in n))throw new Error("not writable atom");return t.set(n,...h)},[t,n])}const H=Z("blue"),En=()=>hn(H),yn=n=>{const r=_n(H);R.useEffect(()=>{r(n)},[r,n])};export{En as a,Z as b,_n as c,hn as d,yn as u};
