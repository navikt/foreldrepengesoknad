import{r as R,ab as ne}from"./iframe-0_Pfn_Hg.js";const L={},X=(e,n)=>e.unstable_is?e.unstable_is(n):n===e,Y=e=>"init"in e,J=e=>!!e.write,Z=e=>"v"in e||"e"in e,x=e=>{if("e"in e)throw e.e;if((L?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},C=new WeakMap,H=e=>{var n;return j(e)&&!!((n=C.get(e))!=null&&n[0])},ue=e=>{const n=C.get(e);n!=null&&n[0]&&(n[0]=!1,n[1].forEach(r=>r()))},re=(e,n)=>{let r=C.get(e);if(!r){r=[!0,new Set],C.set(e,r);const o=()=>{r[0]=!1};e.then(o,o)}r[1].add(n)},j=e=>typeof(e==null?void 0:e.then)=="function",oe=(e,n,r)=>{r.p.has(e)||(r.p.add(e),n.then(()=>{r.p.delete(e)},()=>{r.p.delete(e)}))},$=(e,n,r)=>{const o=r(e),u="v"in o,a=o.v;if(j(n))for(const f of o.d.keys())oe(e,n,r(f));o.v=n,delete o.e,(!u||!Object.is(a,o.v))&&(++o.n,j(a)&&ue(a))},m=(e,n,r)=>{var o;const u=new Set;for(const a of((o=r.get(e))==null?void 0:o.t)||[])r.has(a)&&u.add(a);for(const a of n.p)u.add(a);return u},de=()=>{const e=new Set,n=()=>{e.forEach(r=>r())};return n.add=r=>(e.add(r),()=>{e.delete(r)}),n},G=()=>{const e={},n=new WeakMap,r=o=>{var u,a;(u=n.get(e))==null||u.forEach(f=>f(o)),(a=n.get(o))==null||a.forEach(f=>f())};return r.add=(o,u)=>{const a=o||e,f=(n.has(a)?n:n.set(a,new Set)).get(a);return f.add(u),()=>{f==null||f.delete(u),f.size||n.delete(a)}},r},ae=e=>(e.c||(e.c=G()),e.m||(e.m=G()),e.u||(e.u=G()),e.f||(e.f=de()),e),fe=Symbol(),ve=(e=new WeakMap,n=new WeakMap,r=new WeakMap,o=new Set,u=new Set,a=new Set,f={},w=(h,...b)=>h.read(...b),y=(h,...b)=>h.write(...b),v=(h,b)=>{var A;return(A=h.unstable_onInit)==null?void 0:A.call(h,b)},_=(h,b)=>{var A;return(A=h.onMount)==null?void 0:A.call(h,b)},...g)=>{const h=g[0]||(t=>{if((L?"production":void 0)!=="production"&&!t)throw new Error("Atom is undefined or null");let d=e.get(t);return d||(d={d:new Map,p:new Set,n:0},e.set(t,d),v==null||v(t,U)),d}),b=g[1]||(()=>{const t=[],d=l=>{try{l()}catch(i){t.push(i)}};do{f.f&&d(f.f);const l=new Set,i=l.add.bind(l);o.forEach(s=>{var c;return(c=n.get(s))==null?void 0:c.l.forEach(i)}),o.clear(),a.forEach(i),a.clear(),u.forEach(i),u.clear(),l.forEach(d),o.size&&A()}while(o.size||a.size||u.size);if(t.length)throw new AggregateError(t)}),A=g[2]||(()=>{const t=[],d=new WeakSet,l=new WeakSet,i=Array.from(o);for(;i.length;){const s=i[i.length-1],c=h(s);if(l.has(s)){i.pop();continue}if(d.has(s)){if(r.get(s)===c.n)t.push([s,c]);else if((L?"production":void 0)!=="production"&&r.has(s))throw new Error("[Bug] invalidated atom exists");l.add(s),i.pop();continue}d.add(s);for(const p of m(s,c,n))d.has(p)||i.push(p)}for(let s=t.length-1;s>=0;--s){const[c,p]=t[s];let E=!1;for(const T of p.d.keys())if(T!==c&&o.has(T)){E=!0;break}E&&(P(c),W(c)),r.delete(c)}}),P=g[3]||(t=>{var d;const l=h(t);if(Z(l)&&(n.has(t)&&r.get(t)!==l.n||Array.from(l.d).every(([S,V])=>P(S).n===V)))return l;l.d.clear();let i=!0;const s=()=>{n.has(t)&&(W(t),A(),b())},c=S=>{var V;if(X(t,S)){const Q=h(S);if(!Z(Q))if(Y(S))$(S,S.init,h);else throw new Error("no atom init");return x(Q)}const k=P(S);try{return x(k)}finally{l.d.set(S,k.n),H(l.v)&&oe(t,l.v,k),(V=n.get(S))==null||V.t.add(t),i||s()}};let p,E;const T={get signal(){return p||(p=new AbortController),p.signal},get setSelf(){return(L?"production":void 0)!=="production"&&!J(t)&&console.warn("setSelf function cannot be used with read-only atom"),!E&&J(t)&&(E=(...S)=>{if((L?"production":void 0)!=="production"&&i&&console.warn("setSelf function cannot be called in sync"),!i)try{return D(t,...S)}finally{A(),b()}}),E}},N=l.n;try{const S=w(t,c,T);return $(t,S,h),j(S)&&(re(S,()=>p==null?void 0:p.abort()),S.then(s,s)),l}catch(S){return delete l.v,l.e=S,++l.n,l}finally{i=!1,N!==l.n&&r.get(t)===N&&(r.set(t,l.n),o.add(t),(d=f.c)==null||d.call(f,t))}}),M=g[4]||(t=>{const d=[t];for(;d.length;){const l=d.pop(),i=h(l);for(const s of m(l,i,n)){const c=h(s);r.set(s,c.n),d.push(s)}}}),D=g[5]||((t,...d)=>{let l=!0;const i=c=>x(P(c)),s=(c,...p)=>{var E;const T=h(c);try{if(X(t,c)){if(!Y(c))throw new Error("atom not writable");const N=T.n,S=p[0];$(c,S,h),W(c),N!==T.n&&(o.add(c),(E=f.c)==null||E.call(f,c),M(c));return}else return D(c,...p)}finally{l||(A(),b())}};try{return y(t,i,s,...d)}finally{l=!1}}),W=g[6]||(t=>{var d;const l=h(t),i=n.get(t);if(i&&!H(l.v)){for(const[s,c]of l.d)if(!i.d.has(s)){const p=h(s);z(s).t.add(t),i.d.add(s),c!==p.n&&(o.add(s),(d=f.c)==null||d.call(f,s),M(s))}for(const s of i.d||[])if(!l.d.has(s)){i.d.delete(s);const c=O(s);c==null||c.t.delete(t)}}}),z=g[7]||(t=>{var d;const l=h(t);let i=n.get(t);if(!i){P(t);for(const s of l.d.keys())z(s).t.add(t);if(i={l:new Set,d:new Set(l.d.keys()),t:new Set},n.set(t,i),(d=f.m)==null||d.call(f,t),J(t)){const s=()=>{let c=!0;const p=(...E)=>{try{return D(t,...E)}finally{c||(A(),b())}};try{const E=_(t,p);E&&(i.u=()=>{c=!0;try{E()}finally{c=!1}})}finally{c=!1}};u.add(s)}}return i}),O=g[8]||(t=>{var d;const l=h(t);let i=n.get(t);if(i&&!i.l.size&&!Array.from(i.t).some(s=>{var c;return(c=n.get(s))==null?void 0:c.d.has(t)})){i.u&&a.add(i.u),i=void 0,n.delete(t),(d=f.u)==null||d.call(f,t);for(const s of l.d.keys()){const c=O(s);c==null||c.t.delete(t)}return}return i}),le=[e,n,r,o,u,a,f,w,y,v,_,h,b,A,P,M,D,W,z,O],U={get:t=>x(P(t)),set:(t,...d)=>{try{return D(t,...d)}finally{A(),b()}},sub:(t,d)=>{const i=z(t).l;return i.add(d),b(),()=>{i.delete(d),O(t),b()}}};return Object.defineProperty(U,fe,{value:le}),U},se=ve,he=ae,ee=re,F={};let _e=0;function Se(e,n){const r=`atom${++_e}`,o={toString(){return(F?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof e=="function"?o.read=e:(o.init=e,o.read=we,o.write=ge),o}function we(e){return e(this)}function ge(e,n,r){return n(this,typeof r=="function"?r(e(this)):r)}const ye=()=>{let e=0;const n=he({}),r=new WeakMap,o=new WeakMap,u=se(r,o,void 0,void 0,void 0,void 0,n,void 0,(w,y,v,..._)=>e?v(w,..._):w.write(y,v,..._)),a=new Set;return n.m.add(void 0,w=>{a.add(w);const y=r.get(w);y.m=o.get(w)}),n.u.add(void 0,w=>{a.delete(w);const y=r.get(w);delete y.m}),Object.assign(u,{dev4_get_internal_weak_map:()=>(console.log("Deprecated: Use devstore from the devtools library"),r),dev4_get_mounted_atoms:()=>a,dev4_restore_atoms:w=>{const y={read:()=>null,write:(v,_)=>{++e;try{for(const[g,h]of w)"init"in g&&_(g,h)}finally{--e}}};u.set(y)}})};function pe(){return(F?"production":void 0)!=="production"?ye():se()}let I;function be(){return I||(I=pe(),(F?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=I),globalThis.__JOTAI_DEFAULT_STORE__!==I&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),I}const Ee={},Ae=R.createContext(void 0);function ie(e){return R.useContext(Ae)||be()}const q=e=>typeof(e==null?void 0:e.then)=="function",B=e=>{e.status||(e.status="pending",e.then(n=>{e.status="fulfilled",e.value=n},n=>{e.status="rejected",e.reason=n}))},Pe=ne.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(B(e),e)}),K=new WeakMap,te=(e,n)=>{let r=K.get(e);return r||(r=new Promise((o,u)=>{let a=e;const f=v=>_=>{a===v&&o(_)},w=v=>_=>{a===v&&u(_)},y=()=>{try{const v=n();q(v)?(K.set(v,r),a=v,v.then(f(v),w(v)),ee(v,y)):o(v)}catch(v){u(v)}};e.then(f(e),w(e)),ee(e,y)}),K.set(e,r)),r};function Te(e,n){const{delay:r,unstable_promiseStatus:o=!ne.use}={},u=ie(),[[a,f,w],y]=R.useReducer(_=>{const g=u.get(e);return Object.is(_[0],g)&&_[1]===u&&_[2]===e?_:[g,u,e]},void 0,()=>[u.get(e),u,e]);let v=a;if((f!==u||w!==e)&&(y(),v=u.get(e)),R.useEffect(()=>{const _=u.sub(e,()=>{if(o)try{const g=u.get(e);q(g)&&B(te(g,()=>u.get(e)))}catch{}if(typeof r=="number"){setTimeout(y,r);return}y()});return y(),_},[u,e,r,o]),R.useDebugValue(v),q(v)){const _=te(v,()=>u.get(e));return o&&B(_),Pe(_)}return v}function Re(e,n){const r=ie();return R.useCallback((...u)=>{if((Ee?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return r.set(e,...u)},[r,e])}const ce=Se("blue"),Ie=()=>Te(ce),Le=e=>{const n=Re(ce);R.useEffect(()=>{n(e)},[n,e])};export{Se as a,Re as b,Te as c,Le as d,Ie as u};
