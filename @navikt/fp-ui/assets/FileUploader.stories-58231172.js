import{j as t,c as Z,g as Y,F as u,u as H,h as J,a as Q,i as W,k as ee,V as y,L as te,S as ne,X as ae,l as z,A as se,U as re,P as ie,f as le}from"./UiIntlProvider-a6672dc1.js";import{r as l}from"./_baseToString-0ec4c824.js";import"./_createSet-cf25111a.js";import"./tslib.es6-c380bd65.js";import"./index-9d475cdf.js";import"./_commonjsHelpers-de833af9.js";import"./index-05e4a7e3.js";import"./index-2ffc1685.js";import"./v4-a960c1f4.js";const x=({multiple:e,accept:n,onFilesSelect:s,hasUplodedAttachements:a})=>{const h=l.useCallback(m=>{if(m.target.files){const I=Array.from(m.target.files);s(I),m.target.value=""}},[s]),i=l.useRef(null),g=l.useCallback(()=>{i.current&&i.current.click()},[i.current]);return t.jsxs(t.Fragment,{children:[t.jsx("input",{ref:i,className:"fileInput",type:"file",accept:n,onChange:m=>h(m),multiple:e===!0,"data-testid":"file-upload"}),t.jsxs(Z,{className:"upload_button",variant:a?"secondary":"primary",type:"button",onClick:g,icon:t.jsx(Y,{}),iconPosition:"right",children:[a&&t.jsx(u,{id:"FileInput.Vedlegg.Lastoppknapp.Flere"}),!a&&t.jsx(u,{id:"FileInput.Vedlegg.Lastoppknapp"})]})]})};try{x.displayName="FileInput",x.__docgenInfo={description:"",displayName:"FileInput",props:{onFilesSelect:{defaultValue:null,description:"",name:"onFilesSelect",required:!0,type:{name:"(files: File[]) => void"}},multiple:{defaultValue:null,description:"",name:"multiple",required:!1,type:{name:"boolean"}},accept:{defaultValue:null,description:"",name:"accept",required:!0,type:{name:"string"}},hasUplodedAttachements:{defaultValue:null,description:"",name:"hasUplodedAttachements",required:!0,type:{name:"boolean"}}}}}catch{}const oe=()=>{const e=H();return{i18n:(n,s)=>e.formatMessage({id:n},s)}},d=()=>Math.floor((1+Math.random())*65536).toString().substring(1),ce=()=>`${d()}${d()}-${d()}-${d()}-${d()}-${d()}${d()}${d()}`,de=e=>J(e,{unitSeparator:" ",thousandsSeparator:" ",decimalPlaces:1,fixedDecimals:!1}),me=()=>"V".concat(ce().replace(/-/g,"")),pe=(e,n,s)=>({id:me(),file:e,filename:e.name,filesize:e.size,uploaded:!1,pending:!1,type:n,skjemanummer:s});const v=({attachment:e,showFileSize:n,onDelete:s})=>{const{i18n:a}=oe();return t.jsx("div",{className:"attachmentPanel",children:t.jsxs(Q,{gap:"4",children:[e.pending&&t.jsx(W,{type:"S"}),!e.pending&&t.jsx(ee,{width:24,height:24}),t.jsxs(y,{gap:"1",children:[e.url?t.jsx(te,{href:e.url,target:"_blank",children:e.filename}):t.jsx("span",{children:e.filename}),n&&t.jsx("div",{children:de(e.filesize)})]}),s&&t.jsxs(t.Fragment,{children:[t.jsx(ne,{}),t.jsx(ae,{onClick:()=>s(e),height:24,width:24,cursor:"pointer","aria-label":a("Attachment.Vedlegg.Slett",{navn:e.filename})})]})]})})};try{v.displayName="Attachment",v.__docgenInfo={description:"",displayName:"Attachment",props:{attachment:{defaultValue:null,description:"",name:"attachment",required:!0,type:{name:"Attachment"}},showFileSize:{defaultValue:null,description:"",name:"showFileSize",required:!1,type:{name:"boolean"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!1,type:{name:"((file: Attachment) => void)"}}}}}catch{}const T=e=>{const{attachments:n,showFileSize:s,onDelete:a}=e;return t.jsx(t.Fragment,{children:n.length>0&&t.jsx(y,{gap:"2",children:n.map(h=>t.jsx(l.Fragment,{children:t.jsx(v,{attachment:h,onDelete:a,showFileSize:s})},z()))})})};try{T.displayName="AttachmentList",T.__docgenInfo={description:"",displayName:"AttachmentList",props:{attachments:{defaultValue:null,description:"",name:"attachments",required:!0,type:{name:"Attachment[]"}},showFileSize:{defaultValue:null,description:"",name:"showFileSize",required:!1,type:{name:"boolean"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!1,type:{name:"((file: Attachment) => void)"}}}}}catch{}var c=(e=>(e.GENERAL="GENERAL",e.TIMEOUT="TIMEOUT",e.VALID_EXTENSION="VALID_EXTENSION",e.MAX_SIZE="MAX_SIZE",e))(c||{});const ue=16777,j=({failedAttachment:e,onDelete:n})=>t.jsxs(se,{variant:"warning",closeButton:!0,onClose:()=>n(e),children:[e.error===c.GENERAL&&t.jsx(u,{id:"FailedAttachment.Vedlegg.Feilmelding.Opplasting.Feilet",values:{filename:e.filename}}),e.error===c.TIMEOUT&&t.jsx(u,{id:"FailedAttachment.Vedlegg.Feilmelding.Timeout",values:{filename:e.filename}}),e.error===c.MAX_SIZE&&t.jsx(u,{id:"FailedAttachment.Vedlegg.Feilmelding.Ugyldig.StÃ¸rrelse",values:{filename:e.filename,maxStÃ¸rrelse:ue}}),e.error===c.VALID_EXTENSION&&t.jsx(u,{id:"FailedAttachment.Vedlegg.Feilmelding.Ugyldig.Type",values:{filename:e.filename}})]});try{j.displayName="FailedAttachment",j.__docgenInfo={description:"",displayName:"FailedAttachment",props:{failedAttachment:{defaultValue:null,description:"",name:"failedAttachment",required:!0,type:{name:"Attachment"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"(file: Attachment) => void"}}}}}catch{}const V=e=>{const{failedAttachments:n,onDelete:s}=e;return t.jsx(t.Fragment,{children:n.length>0&&t.jsx(y,{gap:"2",children:n.map(a=>t.jsx(l.Fragment,{children:t.jsx(j,{failedAttachment:a,onDelete:s})},z()))})})};try{V.displayName="FailedAttachmentList",V.__docgenInfo={description:"",displayName:"FailedAttachmentList",props:{failedAttachments:{defaultValue:null,description:"",name:"failedAttachments",required:!0,type:{name:"Attachment[]"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"(file: Attachment) => void"}}}}}catch{}const G=[".pdf",".jpeg",".jpg",".png"],he=16777,ge=.0009765625,fe=(e,n,s)=>{const a=pe(e,n,s);return a.pending=!0,a},Ae=e=>{const n=e.split(".").pop();return G.includes(`.${n.toLowerCase()}`)},Ee=e=>e*ge<=he,Se=async(e,n)=>{var s;if(!Ae(e.file.name)){e.pending=!1,e.error=c.VALID_EXTENSION;return}if(!Ee(e.filesize)){e.pending=!1,e.error=c.MAX_SIZE;return}try{const a=await n(e);e.pending=!1,e.url=a.headers.location,e.uploaded=!0,e.uuid=a.data}catch(a){e.pending=!1,((s=a==null?void 0:a.response)==null?void 0:s.status)===408?e.error=c.TIMEOUT:e.error=c.GENERAL}},_e=[],O=({existingAttachments:e=_e,updateAttachments:n,attachmentType:s,skjemanummber:a,saveAttachment:h})=>{const[i,g]=l.useState(e);l.useEffect(()=>{n(i.filter(r=>!r.error&&r.pending===!1))},[i]);const m=async r=>{for(const o of r)await Se(o,h),g(p=>p.map(F=>F.filename===o.filename?o:F))},I=l.useCallback(r=>{const o=r.map(p=>fe(p,s,a));g(p=>p.filter(C=>!o.some($=>$.filename===C.filename)).concat(o)),m(o)},[]),L=l.useCallback(r=>{g(o=>o.filter(p=>p.filename!==r.filename))},[]),N=l.useMemo(()=>i.filter(r=>!r.error),[i]),X=l.useMemo(()=>i.filter(r=>!!r.error),[i]);return t.jsx(re,{children:t.jsxs(y,{gap:"6",children:[t.jsx(T,{attachments:N,showFileSize:!0,onDelete:L}),t.jsx(x,{accept:G.join(", "),onFilesSelect:I,hasUplodedAttachements:N.length>0}),t.jsx(V,{failedAttachments:X,onDelete:L})]})})},B=O;try{O.displayName="FileUploader",O.__docgenInfo={description:"",displayName:"FileUploader",props:{updateAttachments:{defaultValue:null,description:"",name:"updateAttachments",required:!0,type:{name:"(attachments: Attachment[]) => void"}},attachmentType:{defaultValue:null,description:"",name:"attachmentType",required:!0,type:{name:"enum",value:[{value:'"terminbekreftelse"'},{value:'"omsorgsovertakelse"'}]}},skjemanummber:{defaultValue:null,description:"",name:"skjemanummber",required:!0,type:{name:"enum",value:[{value:'"I000062"'},{value:'"I000042"'}]}},existingAttachments:{defaultValue:{value:"[] as Attachment[]"},description:"",name:"existingAttachments",required:!1,type:{name:"Attachment[]"}},saveAttachment:{defaultValue:null,description:"",name:"saveAttachment",required:!0,type:{name:"SaveAttachment"}}}}}catch{}var S=(e=>(e.TERMINBEKREFTELSE="terminbekreftelse",e.OMSORGSOVERTAKELSE="omsorgsovertakelse",e))(S||{}),_=(e=>(e.TERMINBEKREFTELSE="I000062",e.OMSORGSOVERTAKELSE="I000042",e))(_||{});const Re={title:"FileUploader",component:B},R=({saveAttachment:e,existingAttachments:n})=>t.jsx(ie,{value:le({locale:"nb",messages:{}}),children:t.jsx(B,{attachmentType:S.OMSORGSOVERTAKELSE,saveAttachment:e,skjemanummber:_.OMSORGSOVERTAKELSE,existingAttachments:n,updateAttachments:()=>{}})}),f=R.bind({});f.args={existingAttachments:[{id:"1",filename:"Dette er en fil som er lastet opp.jpg",filesize:234,file:{},pending:!1,uploaded:!0,type:S.TERMINBEKREFTELSE,skjemanummer:_.TERMINBEKREFTELSE},{id:"2",filename:"Dette er en fil som holder pÃ¥ Ã¥ bli lastet opp.jpg",filesize:2344,file:{},pending:!0,uploaded:!1,type:S.TERMINBEKREFTELSE,skjemanummer:_.TERMINBEKREFTELSE}]};const A=R.bind({});A.args={saveAttachment:()=>Promise.resolve({headers:{location:""},data:"test"})};const E=R.bind({});var k,M,b;f.parameters={...f.parameters,docs:{...(k=f.parameters)==null?void 0:k.docs,source:{originalSource:`({
  saveAttachment,
  existingAttachments
}) => {
  return <RawIntlProvider value={createIntl({
    locale: 'nb',
    messages: {}
  })}>
            <FileUploader attachmentType={AttachmentType.OMSORGSOVERTAKELSE} saveAttachment={saveAttachment} skjemanummber={Skjemanummer.OMSORGSOVERTAKELSE} existingAttachments={existingAttachments} updateAttachments={() => undefined} />
        </RawIntlProvider>;
}`,...(b=(M=f.parameters)==null?void 0:M.docs)==null?void 0:b.source}}};var K,D,q;A.parameters={...A.parameters,docs:{...(K=A.parameters)==null?void 0:K.docs,source:{originalSource:`({
  saveAttachment,
  existingAttachments
}) => {
  return <RawIntlProvider value={createIntl({
    locale: 'nb',
    messages: {}
  })}>
            <FileUploader attachmentType={AttachmentType.OMSORGSOVERTAKELSE} saveAttachment={saveAttachment} skjemanummber={Skjemanummer.OMSORGSOVERTAKELSE} existingAttachments={existingAttachments} updateAttachments={() => undefined} />
        </RawIntlProvider>;
}`,...(q=(D=A.parameters)==null?void 0:D.docs)==null?void 0:q.source}}};var w,P,U;E.parameters={...E.parameters,docs:{...(w=E.parameters)==null?void 0:w.docs,source:{originalSource:`({
  saveAttachment,
  existingAttachments
}) => {
  return <RawIntlProvider value={createIntl({
    locale: 'nb',
    messages: {}
  })}>
            <FileUploader attachmentType={AttachmentType.OMSORGSOVERTAKELSE} saveAttachment={saveAttachment} skjemanummber={Skjemanummer.OMSORGSOVERTAKELSE} existingAttachments={existingAttachments} updateAttachments={() => undefined} />
        </RawIntlProvider>;
}`,...(U=(P=E.parameters)==null?void 0:P.docs)==null?void 0:U.source}}};const Le=["VisEksisterendeVedlegg","OpplastingOk","OpplastingFeiler"];export{E as OpplastingFeiler,A as OpplastingOk,f as VisEksisterendeVedlegg,Le as __namedExportsOrder,Re as default};
//# sourceMappingURL=FileUploader.stories-58231172.js.map
