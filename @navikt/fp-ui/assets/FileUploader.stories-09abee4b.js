import{j as t,c as C,g as $,F as A,u as Z,h as Y,a as H,i as J,k as Q,V as y,L as W,S as ee,X as te,l as G,A as ne,U as ae,P as se,f as re}from"./UiIntlProvider-c86c7022.js";import{r as l}from"./_baseToString-0ec4c824.js";import"./_createSet-cf25111a.js";import"./tslib.es6-c380bd65.js";import"./index-9d475cdf.js";import"./_commonjsHelpers-de833af9.js";import"./index-05e4a7e3.js";import"./index-2ffc1685.js";import"./v4-a960c1f4.js";const F=({multiple:e,accept:n,onFilesSelect:a,hasUplodedAttachements:s})=>{const u=l.useCallback(d=>{if(d.target.files){const I=Array.from(d.target.files);a(I),d.target.value=""}},[a]),i=l.useRef(null),h=l.useCallback(()=>{i.current&&i.current.click()},[i.current]);return t.jsxs(t.Fragment,{children:[t.jsx("input",{ref:i,className:"fileInput",type:"file",accept:n,onChange:d=>u(d),multiple:e===!0,"data-testid":"file-upload"}),t.jsxs(C,{className:"upload_button",variant:s?"secondary":"primary",type:"button",onClick:h,icon:t.jsx($,{}),iconPosition:"right",children:[s&&t.jsx(A,{id:"FileInput.Vedlegg.Lastoppknapp.Flere"}),!s&&t.jsx(A,{id:"FileInput.Vedlegg.Lastoppknapp"})]})]})};try{F.displayName="FileInput",F.__docgenInfo={description:"",displayName:"FileInput",props:{onFilesSelect:{defaultValue:null,description:"",name:"onFilesSelect",required:!0,type:{name:"(files: File[]) => void"}},multiple:{defaultValue:null,description:"",name:"multiple",required:!1,type:{name:"boolean"}},accept:{defaultValue:null,description:"",name:"accept",required:!0,type:{name:"string"}},hasUplodedAttachements:{defaultValue:null,description:"",name:"hasUplodedAttachements",required:!0,type:{name:"boolean"}}}}}catch{}const ie=()=>{const e=Z();return{i18n:(n,a)=>e.formatMessage({id:n},a)}},c=()=>Math.floor((1+Math.random())*65536).toString().substring(1),le=()=>`${c()}${c()}-${c()}-${c()}-${c()}-${c()}${c()}${c()}`,oe=e=>Y(e,{unitSeparator:" ",thousandsSeparator:" ",decimalPlaces:1,fixedDecimals:!1}),ce=()=>"V".concat(le().replace(/-/g,"")),de=(e,n,a)=>({id:ce(),file:e,filename:e.name,filesize:e.size,uploaded:!1,pending:!1,type:n,skjemanummer:a});const x=({attachment:e,showFileSize:n,onDelete:a})=>{const{i18n:s}=ie();return t.jsx("div",{className:"attachmentPanel",children:t.jsxs(H,{gap:"4",children:[e.pending&&t.jsx(J,{type:"S"}),!e.pending&&t.jsx(Q,{width:24,height:24}),t.jsxs(y,{gap:"1",children:[e.url?t.jsx(W,{href:e.url,target:"_blank",children:e.filename}):t.jsx("span",{children:e.filename}),n&&t.jsx("div",{children:oe(e.filesize)})]}),a&&t.jsxs(t.Fragment,{children:[t.jsx(ee,{}),t.jsx(te,{onClick:()=>a(e),height:24,width:24,cursor:"pointer","aria-label":s("Attachment.Vedlegg.Slett",{navn:e.filename})})]})]})})};try{x.displayName="Attachment",x.__docgenInfo={description:"",displayName:"Attachment",props:{attachment:{defaultValue:null,description:"",name:"attachment",required:!0,type:{name:"Attachment"}},showFileSize:{defaultValue:null,description:"",name:"showFileSize",required:!1,type:{name:"boolean"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!1,type:{name:"((file: Attachment) => void)"}}}}}catch{}const v=e=>{const{attachments:n,showFileSize:a,onDelete:s}=e;return t.jsx(t.Fragment,{children:n.length>0&&t.jsx(y,{gap:"2",children:n.map(u=>t.jsx(l.Fragment,{children:t.jsx(x,{attachment:u,onDelete:s,showFileSize:a})},G()))})})};try{v.displayName="AttachmentList",v.__docgenInfo={description:"",displayName:"AttachmentList",props:{attachments:{defaultValue:null,description:"",name:"attachments",required:!0,type:{name:"Attachment[]"}},showFileSize:{defaultValue:null,description:"",name:"showFileSize",required:!1,type:{name:"boolean"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!1,type:{name:"((file: Attachment) => void)"}}}}}catch{}var p=(e=>(e.GENERAL="GENERAL",e.VALID_EXTENSION="VALID_EXTENSION",e.MAX_SIZE="MAX_SIZE",e))(p||{});const me=16777,j=({failedAttachment:e,onDelete:n})=>t.jsxs(ne,{variant:"warning",closeButton:!0,onClose:()=>n(e),children:[e.error===p.GENERAL&&t.jsx(A,{id:"FailedAttachment.Vedlegg.Feilmelding.Opplasting.Feilet",values:{filename:e.filename}}),e.error===p.MAX_SIZE&&t.jsx(A,{id:"FailedAttachment.Vedlegg.Feilmelding.Ugyldig.StÃ¸rrelse",values:{filename:e.filename,maxStÃ¸rrelse:me}}),e.error===p.VALID_EXTENSION&&t.jsx(A,{id:"FailedAttachment.Vedlegg.Feilmelding.Ugyldig.Type",values:{filename:e.filename}})]});try{j.displayName="FailedAttachment",j.__docgenInfo={description:"",displayName:"FailedAttachment",props:{failedAttachment:{defaultValue:null,description:"",name:"failedAttachment",required:!0,type:{name:"Attachment"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"(file: Attachment) => void"}}}}}catch{}const V=e=>{const{failedAttachments:n,onDelete:a}=e;return t.jsx(t.Fragment,{children:n.length>0&&t.jsx(y,{gap:"2",children:n.map(s=>t.jsx(l.Fragment,{children:t.jsx(j,{failedAttachment:s,onDelete:a})},G()))})})};try{V.displayName="FailedAttachmentList",V.__docgenInfo={description:"",displayName:"FailedAttachmentList",props:{failedAttachments:{defaultValue:null,description:"",name:"failedAttachments",required:!0,type:{name:"Attachment[]"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"(file: Attachment) => void"}}}}}catch{}const B=[".pdf",".jpeg",".jpg",".png"],pe=16777,ue=.0009765625,he=(e,n,a)=>{const s=de(e,n,a);return s.pending=!0,s},ge=e=>{const n=e.split(".").pop();return B.includes(`.${n.toLowerCase()}`)},fe=e=>e*ue<=pe,Ae=async(e,n)=>{if(!ge(e.file.name)){e.pending=!1,e.error=p.VALID_EXTENSION;return}if(!fe(e.filesize)){e.pending=!1,e.error=p.MAX_SIZE;return}try{const a=await n(e);e.pending=!1,e.url=a.headers.location,e.uploaded=!0,e.uuid=a.data}catch{e.pending=!1,e.error=p.GENERAL}},Ee=[],R=({existingAttachments:e=Ee,updateAttachments:n,attachmentType:a,skjemanummber:s,saveAttachment:u})=>{const[i,h]=l.useState(e);l.useEffect(()=>{n(i.filter(r=>!r.error&&r.pending===!1))},[i]);const d=async r=>{for(const o of r)await Ae(o,u),h(m=>m.map(N=>N.filename===o.filename?o:N))},I=l.useCallback(r=>{const o=r.map(m=>he(m,a,s));h(m=>m.concat(o)),d(o)},[]),O=l.useCallback(r=>{h(o=>o.filter(m=>m.filename!==r.filename))},[]),L=l.useMemo(()=>i.filter(r=>!r.error),[i]),X=l.useMemo(()=>i.filter(r=>!!r.error),[i]);return t.jsx(ae,{children:t.jsxs(y,{gap:"6",children:[t.jsx(v,{attachments:L,showFileSize:!0,onDelete:O}),t.jsx(F,{accept:B.join(", "),onFilesSelect:I,hasUplodedAttachements:L.length>0}),t.jsx(V,{failedAttachments:X,onDelete:O})]})})},U=R;try{R.displayName="FileUploader",R.__docgenInfo={description:"",displayName:"FileUploader",props:{updateAttachments:{defaultValue:null,description:"",name:"updateAttachments",required:!0,type:{name:"(attachments: Attachment[]) => void"}},attachmentType:{defaultValue:null,description:"",name:"attachmentType",required:!0,type:{name:"enum",value:[{value:'"terminbekreftelse"'},{value:'"omsorgsovertakelse"'}]}},skjemanummber:{defaultValue:null,description:"",name:"skjemanummber",required:!0,type:{name:"enum",value:[{value:'"I000062"'},{value:'"I000042"'}]}},existingAttachments:{defaultValue:{value:"[] as Attachment[]"},description:"",name:"existingAttachments",required:!1,type:{name:"Attachment[]"}},saveAttachment:{defaultValue:null,description:"",name:"saveAttachment",required:!0,type:{name:"SaveAttachment"}}}}}catch{}var S=(e=>(e.TERMINBEKREFTELSE="terminbekreftelse",e.OMSORGSOVERTAKELSE="omsorgsovertakelse",e))(S||{}),_=(e=>(e.TERMINBEKREFTELSE="I000062",e.OMSORGSOVERTAKELSE="I000042",e))(_||{});const Re={title:"FileUploader",component:U},T=({saveAttachment:e,existingAttachments:n})=>t.jsx(se,{value:re({locale:"nb",messages:{}}),children:t.jsx(U,{attachmentType:S.OMSORGSOVERTAKELSE,saveAttachment:e,skjemanummber:_.OMSORGSOVERTAKELSE,existingAttachments:n,updateAttachments:()=>{}})}),g=T.bind({});g.args={existingAttachments:[{id:"1",filename:"Dette er en fil som er lastet opp.jpg",filesize:234,file:{},pending:!1,uploaded:!0,type:S.TERMINBEKREFTELSE,skjemanummer:_.TERMINBEKREFTELSE},{id:"2",filename:"Dette er en fil som holder pÃ¥ Ã¥ bli lastet opp.jpg",filesize:2344,file:{},pending:!0,uploaded:!1,type:S.TERMINBEKREFTELSE,skjemanummer:_.TERMINBEKREFTELSE}]};const f=T.bind({});f.args={saveAttachment:()=>Promise.resolve({headers:{location:""},data:"test"})};const E=T.bind({});var k,b,M;g.parameters={...g.parameters,docs:{...(k=g.parameters)==null?void 0:k.docs,source:{originalSource:`({
  saveAttachment,
  existingAttachments
}) => {
  return <RawIntlProvider value={createIntl({
    locale: 'nb',
    messages: {}
  })}>
            <FileUploader attachmentType={AttachmentType.OMSORGSOVERTAKELSE} saveAttachment={saveAttachment} skjemanummber={Skjemanummer.OMSORGSOVERTAKELSE} existingAttachments={existingAttachments} updateAttachments={() => undefined} />
        </RawIntlProvider>;
}`,...(M=(b=g.parameters)==null?void 0:b.docs)==null?void 0:M.source}}};var K,D,q;f.parameters={...f.parameters,docs:{...(K=f.parameters)==null?void 0:K.docs,source:{originalSource:`({
  saveAttachment,
  existingAttachments
}) => {
  return <RawIntlProvider value={createIntl({
    locale: 'nb',
    messages: {}
  })}>
            <FileUploader attachmentType={AttachmentType.OMSORGSOVERTAKELSE} saveAttachment={saveAttachment} skjemanummber={Skjemanummer.OMSORGSOVERTAKELSE} existingAttachments={existingAttachments} updateAttachments={() => undefined} />
        </RawIntlProvider>;
}`,...(q=(D=f.parameters)==null?void 0:D.docs)==null?void 0:q.source}}};var w,P,z;E.parameters={...E.parameters,docs:{...(w=E.parameters)==null?void 0:w.docs,source:{originalSource:`({
  saveAttachment,
  existingAttachments
}) => {
  return <RawIntlProvider value={createIntl({
    locale: 'nb',
    messages: {}
  })}>
            <FileUploader attachmentType={AttachmentType.OMSORGSOVERTAKELSE} saveAttachment={saveAttachment} skjemanummber={Skjemanummer.OMSORGSOVERTAKELSE} existingAttachments={existingAttachments} updateAttachments={() => undefined} />
        </RawIntlProvider>;
}`,...(z=(P=E.parameters)==null?void 0:P.docs)==null?void 0:z.source}}};const Te=["VisEksisterendeVedlegg","OpplastingOk","OpplastingFeiler"];export{E as OpplastingFeiler,f as OpplastingOk,g as VisEksisterendeVedlegg,Te as __namedExportsOrder,Re as default};
//# sourceMappingURL=FileUploader.stories-09abee4b.js.map
