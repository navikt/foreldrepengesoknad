import{j as a}from"./jsx-runtime-Cw0GR0a5.js";import{b as $,C as u}from"./FpDataContext-BUlrLNeW.js";import{e as oe,a as ie,S as C}from"./useFpNavigator-BxJxFpUw.js";import{r as R}from"./index-CTjT7uj6.js";import{b as le,u as de,R as me,f as ue}from"./ErrorSummaryHookForm-CT0q75h-.js";import{u as z,M as p,H as fe,a as J}from"./Label-CHcQrBTs.js";import{m as ge,o as ve,a as ke,b as ce}from"./eksisterendeSakUtils-DNSnsRvg.js";import{d as m,e as W,l as pe}from"./dates-ChcVThbp.js";import{c as Se,R as x,G as ye,U as he,H as De,L as Fe,C as je,J as Be,E as Ee}from"./Uttaksplan-CWkj2MGn.js";import{b as Te,c as be,d as Ae,t as Ne,e as Q,I as h,h as qe,i as X,j as _e,k as b,s as Me}from"./barnUtils-BBq_6ICT.js";import{D as Re}from"./DinePlikter-CbI6klY4.js";import{g as A}from"./guid-CsArkN6i.js";import{D as Pe}from"./DinePersonopplysningerModal-DtQY1HQo.js";import{V as E,H as T,B as xe}from"./VStack-CqTcH1lX.js";const Oe=()=>{const n=$();return{oppdaterSøknadIState:(e,o)=>{n(u.SØKERSITUASJON,e.søkersituasjon),n(u.OM_BARNET,e.barn),n(u.ANNEN_FORELDER,e.annenForelder),n(u.ARBEIDSFORHOLD_OG_INNTEKT,e.arbeidsforholdOgInntekt),n(u.FRILANS,e.frilans),n(u.EGEN_NÆRING,e.egenNæring),n(u.ANDRE_INNTEKTSKILDER,e.andreInntektskilder),n(u.UTENLANDSOPPHOLD,e.utenlandsopphold),n(u.UTENLANDSOPPHOLD_TIDLIGERE,e.utenlandsoppholdSiste12Mnd),n(u.UTENLANDSOPPHOLD_SENERE,e.utenlandsoppholdNeste12Mnd),n(u.PERIODE_MED_FORELDREPENGER,e.dekningsgrad),n(u.UTTAKSPLAN,e.uttaksplan),n(u.UTTAKSPLAN_METADATA,{ønskerJustertUttakVedFødsel:e.ønskerJustertUttakVedFødsel}),o&&n(u.EKSISTERENDE_SAK,o)}}};var k=(n=>(n.FØDT="født",n.UFØDT="ufødt",n.ADOPTERT="adoptert",n.IKKE_UTFYLT="ikkeUtfylt",n))(k||{}),P=(n=>(n.SØKNAD_GJELDER_NYTT_BARN="søknad_gjeder_nytt_barn",n))(P||{});const Le=(n,r)=>n.map(e=>{const o=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,r):void 0,i=e.sak!==void 0?r.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"";return a.jsx(x,{value:e.id,description:e.sak!==void 0?`${i}, ${o}`:i,children:a.jsx(p,{id:"velkommen.barnVelger.ufødtBarn",values:{antallBarnTekst:Te(e.antallBarn,r),termin:m(e.termindato).format(W),b:t=>a.jsx("b",{children:t})}})},e.id)}),Z=(n,r)=>n?r.formatMessage({id:"velkommen.sak.status.ferdigBehandlet"}):r.formatMessage({id:"velkommen.sak.status.underBehandling"}),we=(n,r)=>n.map(e=>{const o=be(e.fornavn,e.fødselsdatoer,e.omsorgsovertagelse,e.alleBarnaLever,e.antallBarn,r),i=Ae(e.fødselsdatoer),t=e.type===k.FØDT||e.type===k.IKKE_UTFYLT?i:m(e.omsorgsovertagelse).format(W),l=e.type===k.FØDT||e.type===k.IKKE_UTFYLT?r.formatMessage({id:"velkommen.barnVelger.født"}):r.formatMessage({id:"velkommen.barnVelger.adopsjon"}),d=e.sak!==void 0?r.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"",S=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,r):void 0;return a.jsx(x,{value:e.id,description:S?`${d}, ${S}`:d,children:a.jsx("b",{children:e.alleBarnaLever?`${o} ${l} ${t}`:o})},e.id)}),ee=({selectableBarn:n})=>{const r=z();if(n.length===0)return null;const e=n.filter(t=>t.type===k.UFØDT),o=n.filter(t=>t.type!==k.UFØDT);let i=[];return o.length>0&&(i=i.concat(we(o,r))),e.length>0&&(i=i.concat(Le(e,r))),a.jsx(le,{name:"valgteBarn",label:a.jsx(p,{id:"velkommen.intro.harSaker.barnVelger.label"}),validate:[Se(r.formatMessage({id:"steg.footer.spørsmålMåBesvares"}))],children:i.concat(a.jsx(x,{value:"søknad_gjeder_nytt_barn",description:r.formatMessage({id:"velkommen.intro.harSaker.barnVelger.info"}),children:a.jsx(p,{id:"omBarnet.gjelderAnnetBarn",values:{b:t=>a.jsx("b",{children:t})}})},"søknad_gjeder_nytt_barn"))})};ee.__docgenInfo={description:"",methods:[],displayName:"BarnVelger",props:{selectableBarn:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    id: string;
    type: ValgtBarnType;
    antallBarn: number;
    sortableDato: Date;
    fnr?: string[];
    termindato?: Date;
    fødselsdatoer?: Date[];
    omsorgsovertagelse?: Date;
    fornavn?: string[];
    kanSøkeOmEndring?: boolean;
    sak?: Sak;
    annenForelder?: RegistrertAnnenForelder;
    familiehendelsesdato?: Date;
    startdatoFørsteStønadsperiode?: Date;
    alleBarnaLever: boolean;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"type",value:{name:"ValgtBarnType",required:!0}},{key:"antallBarn",value:{name:"number",required:!0}},{key:"sortableDato",value:{name:"Date",required:!0}},{key:"fnr",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"termindato",value:{name:"Date",required:!1}},{key:"fødselsdatoer",value:{name:"Array",elements:[{name:"Date"}],raw:"Date[]",required:!1}},{key:"omsorgsovertagelse",value:{name:"Date",required:!1}},{key:"fornavn",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"kanSøkeOmEndring",value:{name:"boolean",required:!1}},{key:"sak",value:{name:"Sak",required:!1}},{key:"annenForelder",value:{name:"Omit",elements:[{name:"PersonBase"},{name:"union",raw:"'kjønn' | 'fødselsdato'",elements:[{name:"literal",value:"'kjønn'"},{name:"literal",value:"'fødselsdato'"}]}],raw:"Omit<PersonBase, 'kjønn' | 'fødselsdato'>",required:!1}},{key:"familiehendelsesdato",value:{name:"Date",required:!1}},{key:"startdatoFørsteStønadsperiode",value:{name:"Date",required:!1}},{key:"alleBarnaLever",value:{name:"boolean",required:!0}}]}}],raw:"ValgtBarn[]"},description:""}}};m.extend(ye);m.extend(Ne);const Ie=(n,r,e)=>n?k.ADOPTERT:r.fødselsdato!==void 0||e&&e.length>0?k.FØDT:k.UFØDT,Ke=(n,r)=>{const e=n.familiehendelse.termindato;if(De(e)){const o=m(e).subtract(17,"week"),i=m(e).add(6,"week");return r.filter(t=>m(t.fødselsdato).isBetween(o,i,"day","[]"))}return[]},Ue=(n,r)=>{const e=h(n.familiehendelse.fødselsdato),o=n.barn!==void 0?n.barn.map(l=>l.fnr).flat():[],i=r.filter(l=>o.includes(l.fnr)),t=e!==void 0?r.filter(l=>Q(l.fødselsdato,e)&&!i.find(d=>d.fnr===l.fnr)):[];return i.concat(t)},Ve=(n,r)=>{let e;(n.barn||n.familiehendelse.fødselsdato)&&(e=Ue(n,r)),n.familiehendelse.termindato&&!n.familiehendelse.fødselsdato&&!n.barn&&(e=Ke(n,r));const o=h(_e(n.familiehendelse.termindato,n.familiehendelse.fødselsdato,n.familiehendelse.omsorgsovertakelse)),i=Ie(n.gjelderAdopsjon,n.familiehendelse,e),t=h(n.familiehendelse.fødselsdato);let l;return e&&e.length>0?l=e.map(d=>m.utc(d.fødselsdato).toDate()):t!==void 0&&(l=Array(n.familiehendelse.antallBarn).fill(t)),{id:A(),type:i,antallBarn:n.familiehendelse.antallBarn,termindato:h(n.familiehendelse.termindato),omsorgsovertagelse:h(n.familiehendelse.omsorgsovertakelse),kanSøkeOmEndring:n.kanSøkeOmEndring,sak:n,fødselsdatoer:l,familiehendelsesdato:o,sortableDato:h(n.familiehendelse.termindato),startdatoFørsteStønadsperiode:n.gjeldendeVedtak!==void 0&&n.gjeldendeVedtak.perioder.length>0?he(h(n.gjeldendeVedtak.perioder[0].fom)).denneEllerNeste():void 0,fornavn:e!==void 0&&e.length>0?e.filter(d=>d.fornavn!==void 0&&d.fornavn.trim()!=="").map(d=>[d.fornavn,d.mellomnavn!==void 0?d.mellomnavn:""].join(" ")):void 0,fnr:e!==void 0&&e.length>0?e.filter(d=>d.fnr!==void 0).map(d=>d.fnr):void 0,alleBarnaLever:e!==void 0&&e.length>0?e.every(d=>b(d)):!1}},Ge=(n,r)=>{const e=n.mellomnavn!==void 0?[n.fornavn,n.mellomnavn].join(" "):n.fornavn;return{id:A(),type:k.IKKE_UTFYLT,antallBarn:1,fødselsdatoer:[m.utc(n.fødselsdato).toDate()],fornavn:e!==void 0?[e]:void 0,fnr:[n.fnr],sortableDato:m.utc(n.fødselsdato).toDate(),alleBarnaLever:b(n),annenForelder:r}},Ye=(n,r,e)=>{const o=[n].concat(r).sort(Me);if(!(o.find(t=>!b(t)&&X(t))||o.length==0))return{id:A(),type:k.IKKE_UTFYLT,antallBarn:o.length,fødselsdatoer:o.map(t=>m.utc(t.fødselsdato).toDate()),fornavn:o.map(t=>[t.fornavn,t.mellomnavn!==void 0?t.mellomnavn:""].join(" ")),fnr:o.map(t=>t.fnr),sortableDato:m.utc(o[0].fødselsdato).toDate(),alleBarnaLever:o.every(t=>b(t)),annenForelder:e}},He=(n,r)=>n.filter(e=>e.barn!==void 0&&e.barn.length>0||e.familiehendelse.termindato!==void 0||e.familiehendelse.fødselsdato!==void 0||e.familiehendelse.omsorgsovertakelse!==void 0).map(e=>Ve(e,r)),Ce=(n,r,e)=>{const o=n.filter(s=>!e.find(g=>Q(s.fødselsdato,h(g.familiehendelse.fødselsdato)))),i="tempFnr",t=o.map(s=>s.fnr===void 0?{...s,fnr:i+A().toString()}:s),l=r.map(s=>s.fnr).flat(),d=r.filter(s=>s.fødselsdatoer!==void 0&&s.fødselsdatoer.length>0).map(s=>s.fødselsdatoer).flat(),S=[];return t.filter(s=>!(s.dødsdato!==void 0&&d.find(g=>m(g).isSame(m.utc(s.fødselsdato),"day")))).forEach(s=>{if(!l.includes(s.fnr)&&!oe(s.fødselsdato)){const g=qe(s.fnr,s.fødselsdato,t),F=s.annenForelder!==void 0?{fnr:s.annenForelder.fnr,fornavn:s.annenForelder.fornavn,mellomnavn:s.annenForelder.mellomnavn,etternavn:s.annenForelder.etternavn}:void 0;if(l.push(s.fnr),g.length===0){if(!X(s)){const y=Ge(s,F);S.push(y)}}else{const y=Ye(s,g,F);g.forEach(N=>{l.push(N.fnr)}),y!==void 0&&S.push(y)}}}),S.map(s=>s.fnr&&s.fnr.length>0?{...s,fnr:s.fnr.filter(g=>g&&!g.startsWith(i))}:s)},Je=(n,r)=>{const e=n.filter(l=>!l.sakAvsluttet),o=n.filter(l=>l.sakAvsluttet),i=He(e,r),t=Ce(r,i,o);return i.concat(t)},$e=(n,r)=>{var i,t;const e=r.filter(l=>l.sak!==void 0&&l.id!==n.id&&l.familiehendelsesdato!==void 0&&m(l.familiehendelsesdato).isAfter(n.familiehendelsesdato,"day"));e.sort(ne);const o=e[e.length-1];if(o!==void 0)return{familiehendelsesdato:o.familiehendelsesdato,startdatoFørsteStønadsperiode:o.startdatoFørsteStønadsperiode,fnr:o.fnr,annenForelderFnr:(t=(i=o.sak)==null?void 0:i.annenPart)==null?void 0:t.fnr}},ne=(n,r)=>m(n.sortableDato).isBefore(r.sortableDato,"d")?1:m(n.sortableDato).isAfter(r.sortableDato,"d")?-1:0,ze=({locale:n,saker:r,onChangeLocale:e,harGodkjentVilkår:o,søkerInfo:i,setHarGodkjentVilkår:t,setErEndringssøknad:l,setSøknadGjelderNyttBarn:d,mellomlagreSøknadOgNaviger:S})=>{const D=z(),O=ie(i.arbeidsforhold,S),[s,g]=R.useState(!1),F=$(),{oppdaterSøknadIState:y}=Oe(),[N,L]=R.useState(!1),q=R.useMemo(()=>Je(r,i.søker.barn),[r,i.søker.barn]),w=[...q].sort(ne),re=v=>{if(v.harForståttRettigheterOgPlikter!==!0)return;g(!0);const f=v.valgteBarn===P.SØKNAD_GJELDER_NYTT_BARN?void 0:q.find(c=>c.id===v.valgteBarn),_=f!==void 0&&!!f.kanSøkeOmEndring;let j;f!==void 0&&(j=$e(f,w),F(u.BARN_FRA_NESTE_SAK,j));const M=_&&f.sak!==void 0?r.find(c=>{var B;return c.saksnummer===((B=f.sak)==null?void 0:B.saksnummer)}):void 0,ae=j!==void 0?j.startdatoFørsteStønadsperiode:void 0,V=_&&M,G=f!==void 0&&f.sak!==void 0&&f.kanSøkeOmEndring===!1,se=!V&&!G&&f!==void 0;let Y=C.SØKERSITUASJON,H=!1;if(V){const c=ge(M,ae,f.fødselsdatoer);Y=C.UTTAKSPLAN;const B=ve(i.søker,c,D,M.annenPart,f);y(B,c)}else if(G){const c=ke(f,D,i.søker.barn,i.søker.fnr);y(c)}else if(se){const c=ce(f);y(c)}else H=!0;return t(v.harForståttRettigheterOgPlikter),l(_),d(H),O.goToNextStep(Y)},I=de({defaultValues:{harForståttRettigheterOgPlikter:o}}),K=I.watch("valgteBarn"),U=K===P.SØKNAD_GJELDER_NYTT_BARN?void 0:q.find(v=>v.id===K),te=U!==void 0&&U.kanSøkeOmEndring===!0?D.formatMessage({id:"velkommen.endreSøknad"}):D.formatMessage({id:"velkommen.begynnMedSøknad"});return a.jsx(me,{formMethods:I,onSubmit:re,children:a.jsxs(E,{gap:"10",children:[a.jsx(Fe,{locale:n,availableLocales:["nb","nn"],toggleLanguage:e}),a.jsx(je,{children:a.jsxs(E,{gap:"8",children:[a.jsx(T,{justify:"center",children:a.jsx(fe,{size:"xlarge",children:a.jsx(p,{id:"velkommen.tittel"})})}),a.jsx(Be,{poster:!0,children:a.jsxs(E,{gap:"2",children:[a.jsx(p,{id:"velkommen.guidepanel.del1"}),a.jsx(p,{id:"velkommen.guidepanel.del2",values:{a:v=>a.jsx("a",{className:"lenke",rel:"noopener noreferrer",href:pe.foreldrepenger,children:v})}})]})}),a.jsx(ee,{selectableBarn:w}),a.jsx(Ee,{variant:"info",children:a.jsx(p,{id:"velkommen.lagring.info"})}),a.jsx(ue,{name:"harForståttRettigheterOgPlikter",label:D.formatMessage({id:"velkommen.samtykke"}),validate:[v=>v!==!0?D.formatMessage({id:"valideringsfeil.velkommen.harForståttRettigheterOgPlikter.påkrevd"}):null],children:a.jsx(E,{gap:"5",children:a.jsxs(T,{gap:"1",children:[a.jsx(J,{children:a.jsx(p,{id:"velkommen.samtykkeIntro.del1"})}),a.jsx(Re,{})]})})}),a.jsx(T,{justify:"center",children:a.jsx(xe,{type:"submit",variant:"primary",disabled:s,loading:s,children:te})}),a.jsx(T,{justify:"center",children:a.jsx(J,{children:a.jsx("a",{className:"lenke",href:"#",onClick:v=>{v.preventDefault(),L(!0)},children:a.jsx(p,{id:"velkommen.lesMerOmPersonopplysninger"})})})}),a.jsx(Pe,{isOpen:N,onRequestClose:()=>L(!1)})]})})]})})};ze.__docgenInfo={description:"",methods:[],displayName:"Forside",props:{onChangeLocale:{required:!0,tsType:{name:"signature",type:"function",raw:"(locale: LocaleNo) => void",signature:{arguments:[{type:{name:"union",raw:"'nb' | 'nn'",elements:[{name:"literal",value:"'nb'"},{name:"literal",value:"'nn'"}]},name:"locale"}],return:{name:"void"}}},description:""},locale:{required:!0,tsType:{name:"union",raw:"'nb' | 'nn'",elements:[{name:"literal",value:"'nb'"},{name:"literal",value:"'nn'"}]},description:""},saker:{required:!0,tsType:{name:"Array",elements:[{name:"Sak"}],raw:"Sak[]"},description:""},harGodkjentVilkår:{required:!0,tsType:{name:"boolean"},description:""},søkerInfo:{required:!0,tsType:{name:"signature",type:"object",raw:`{
    søker: Søker;
    arbeidsforhold: Arbeidsforhold[];
}`,signature:{properties:[{key:"søker",value:{name:"intersection",raw:`{
    fødselsdato: string;
    kjønn: Kjønn;
    bankkonto?: Bankkonto;
    sivilstand?: Sivilstand;
    barn: SøkerBarn[];
} & PersonBase`,elements:[{name:"signature",type:"object",raw:`{
    fødselsdato: string;
    kjønn: Kjønn;
    bankkonto?: Bankkonto;
    sivilstand?: Sivilstand;
    barn: SøkerBarn[];
}`,signature:{properties:[{key:"fødselsdato",value:{name:"string",required:!0}},{key:"kjønn",value:{name:"union",raw:"'M' | 'K'",elements:[{name:"literal",value:"'M'"},{name:"literal",value:"'K'"}],required:!0}},{key:"bankkonto",value:{name:"Bankkonto",required:!1}},{key:"sivilstand",value:{name:"Sivilstand",required:!1}},{key:"barn",value:{name:"Array",elements:[{name:"intersection",raw:`{
    kjønn: Kjønn;
    fødselsdato: string;
    dødsdato?: string;
    annenForelder?: SøkerAnnenForelder;
} & PersonBase`,elements:[{name:"signature",type:"object",raw:`{
    kjønn: Kjønn;
    fødselsdato: string;
    dødsdato?: string;
    annenForelder?: SøkerAnnenForelder;
}`,signature:{properties:[{key:"kjønn",value:{name:"union",raw:"'M' | 'K'",elements:[{name:"literal",value:"'M'"},{name:"literal",value:"'K'"}],required:!0}},{key:"fødselsdato",value:{name:"string",required:!0}},{key:"dødsdato",value:{name:"string",required:!1}},{key:"annenForelder",value:{name:"intersection",raw:`{
    fødselsdato?: string;
} & PersonBase`,elements:[{name:"signature",type:"object",raw:`{
    fødselsdato?: string;
}`,signature:{properties:[{key:"fødselsdato",value:{name:"string",required:!1}}]}},{name:"signature",type:"object",raw:`{
    fnr: string;
    fornavn: string;
    mellomnavn?: string;
    etternavn: string;
}`,signature:{properties:[{key:"fnr",value:{name:"string",required:!0}},{key:"fornavn",value:{name:"string",required:!0}},{key:"mellomnavn",value:{name:"string",required:!1}},{key:"etternavn",value:{name:"string",required:!0}}]}}],required:!1}}]}},{name:"signature",type:"object",raw:`{
    fnr: string;
    fornavn: string;
    mellomnavn?: string;
    etternavn: string;
}`,signature:{properties:[{key:"fnr",value:{name:"string",required:!0}},{key:"fornavn",value:{name:"string",required:!0}},{key:"mellomnavn",value:{name:"string",required:!1}},{key:"etternavn",value:{name:"string",required:!0}}]}}]}],raw:"SøkerBarn[]",required:!0}}]}},{name:"signature",type:"object",raw:`{
    fnr: string;
    fornavn: string;
    mellomnavn?: string;
    etternavn: string;
}`,signature:{properties:[{key:"fnr",value:{name:"string",required:!0}},{key:"fornavn",value:{name:"string",required:!0}},{key:"mellomnavn",value:{name:"string",required:!1}},{key:"etternavn",value:{name:"string",required:!0}}]}}],required:!0}},{key:"arbeidsforhold",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    arbeidsgiverNavn: string;
    arbeidsgiverId: string;
    arbeidsgiverIdType: string;
    fom: string;
    tom?: string;
    stillingsprosent: number;
}`,signature:{properties:[{key:"arbeidsgiverNavn",value:{name:"string",required:!0}},{key:"arbeidsgiverId",value:{name:"string",required:!0}},{key:"arbeidsgiverIdType",value:{name:"string",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!1}},{key:"stillingsprosent",value:{name:"number",required:!0}}]}}],raw:"Arbeidsforhold[]",required:!0}}]}},description:""},setHarGodkjentVilkår:{required:!0,tsType:{name:"signature",type:"function",raw:"(harGodkjentVilkår: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"harGodkjentVilkår"}],return:{name:"void"}}},description:""},setErEndringssøknad:{required:!0,tsType:{name:"signature",type:"function",raw:"(erEndringssøknad: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"erEndringssøknad"}],return:{name:"void"}}},description:""},setSøknadGjelderNyttBarn:{required:!0,tsType:{name:"signature",type:"function",raw:"(søknadGjelderNyttBarn: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"søknadGjelderNyttBarn"}],return:{name:"void"}}},description:""},mellomlagreSøknadOgNaviger:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""}}};export{ze as F};
