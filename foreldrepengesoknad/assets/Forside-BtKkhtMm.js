import{j as r}from"./tslib.es6-BMc9PpVS.js";import{r as R}from"./index-BP8_t0zE.js";import{R as de,u as le,F as ie,C as me,G as fe,A as ce,b as ve}from"./ErrorSummaryHookForm-CdkcT8AX.js";import{u as J,M as k,d as m,e as z,b as ge,i as pe,H as ue,B as H}from"./Uttaksdagen-B0FM17qM.js";import{R as L,a as D,U as ke,L as Se,c as he}from"./Tidsperioden-DbKFRn-R.js";import{l as De}from"./links-BegG-28I.js";import"./_baseToString-7VaozA17.js";import"./_createSet-1Wr4uFiM.js";import{k as W,C as f}from"./FpDataContext-wT6-gpAc.js";import{x as O,y as Fe,a as Ee,S as $}from"./useFpNavigator-BVwVhtUu.js";import{m as Be,o as je,a as Te,b as ye}from"./eksisterendeSakUtils-B9l3V8nw.js";import{i as Ne,V as T,H as y}from"./dateFormValidation-Dz9wII_h.js";import{a as Oe,f as _e,b as Ae,c as Me,d as Q,e as N,s as xe}from"./barnUtils-BcuO7KJQ.js";import{D as Re}from"./DinePlikter-BnBpQ0vx.js";import{t as Pe,g as X,a as Le}from"./dateUtils-BK4KPdhi.js";import{D as Ue}from"./DinePersonopplysningerModal-BrccWDvc.js";const be=()=>{const t=W();return{oppdaterSøknadIState:(e,o)=>{t(f.SØKERSITUASJON,e.søkersituasjon),t(f.OM_BARNET,e.barn),t(f.ANNEN_FORELDER,e.annenForelder),t(f.ARBEIDSFORHOLD_OG_INNTEKT,e.arbeidsforholdOgInntekt),t(f.FRILANS,e.frilans),t(f.EGEN_NÆRING,e.egenNæring),t(f.ANDRE_INNTEKTSKILDER,e.andreInntektskilder),t(f.UTENLANDSOPPHOLD,e.informasjonOmUtenlandsopphold?{iNorgeNeste12Mnd:e.informasjonOmUtenlandsopphold.iNorgeNeste12Mnd,iNorgeSiste12Mnd:e.informasjonOmUtenlandsopphold.iNorgeSiste12Mnd}:void 0),t(f.UTENLANDSOPPHOLD_TIDLIGERE,e.informasjonOmUtenlandsopphold?{tidligereOpphold:e.informasjonOmUtenlandsopphold.tidligereOpphold}:void 0),t(f.UTENLANDSOPPHOLD_SENERE,e.informasjonOmUtenlandsopphold?{senereOpphold:e.informasjonOmUtenlandsopphold.senereOpphold}:void 0),t(f.PERIODE_MED_FORELDREPENGER,{dekningsgrad:e.dekningsgrad}),t(f.UTTAKSPLAN,e.uttaksplan),t(f.UTTAKSPLAN_METADATA,{ønskerJustertUttakVedFødsel:e.ønskerJustertUttakVedFødsel}),o&&t(f.EKSISTERENDE_SAK,o)}}};var p=(t=>(t.FØDT="født",t.UFØDT="ufødt",t.ADOPTERT="adoptert",t.IKKE_UTFYLT="ikkeUtfylt",t))(p||{}),P=(t=>(t.SØKNAD_GJELDER_NYTT_BARN="søknad_gjeder_nytt_barn",t))(P||{});const Ie=(t,n)=>t.map(e=>{const o=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,n):void 0,d=e.sak!==void 0?n.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"";return r.jsx(L,{value:e.id,description:e.sak!==void 0?`${d}, ${o}`:d,children:r.jsx(k,{id:"velkommen.barnVelger.ufødtBarn",values:{antallBarnTekst:Oe(e.antallBarn,n),termin:m(e.termindato).format(z),b:a=>r.jsx("b",{children:a})}})},e.id)}),Z=(t,n)=>t?n.formatMessage({id:"velkommen.sak.status.ferdigBehandlet"}):n.formatMessage({id:"velkommen.sak.status.underBehandling"}),Ke=(t,n)=>t.map(e=>{const o=_e(e.fornavn,e.fødselsdatoer,e.omsorgsovertagelse,e.alleBarnaLever,e.antallBarn,n),d=Ae(e.fødselsdatoer),a=e.type===p.FØDT||e.type===p.IKKE_UTFYLT?d:m(e.omsorgsovertagelse).format(z),l=e.type===p.FØDT||e.type===p.IKKE_UTFYLT?n.formatMessage({id:"velkommen.barnVelger.født"}):n.formatMessage({id:"velkommen.barnVelger.adopsjon"}),i=e.sak!==void 0?n.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"",S=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,n):void 0;return r.jsx(L,{value:e.id,description:S?`${i}, ${S}`:i,children:r.jsx("b",{children:e.alleBarnaLever?`${o} ${l} ${a}`:o})},e.id)}),ee=({selectableBarn:t})=>{const n=J();if(t.length===0)return null;const e=t.filter(a=>a.type===p.UFØDT),o=t.filter(a=>a.type!==p.UFØDT);let d=[];return o.length>0&&(d=d.concat(Ke(o,n))),e.length>0&&(d=d.concat(Ie(e,n))),r.jsx(de,{name:"valgteBarn",label:r.jsx(k,{id:"velkommen.intro.harSaker.barnVelger.label"}),validate:[Ne(n.formatMessage({id:"steg.footer.spørsmålMåBesvares"}))],children:d.concat(r.jsx(L,{value:"søknad_gjeder_nytt_barn",description:n.formatMessage({id:"velkommen.intro.harSaker.barnVelger.info"}),children:r.jsx(k,{id:"omBarnet.gjelderAnnetBarn",values:{b:a=>r.jsx("b",{children:a})}})},"søknad_gjeder_nytt_barn"))})};ee.__docgenInfo={description:"",methods:[],displayName:"BarnVelger",props:{selectableBarn:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    id: string;
    type: ValgtBarnType;
    antallBarn: number;
    sortableDato: Date;
    fnr?: string[];
    termindato?: Date;
    fødselsdatoer?: Date[];
    omsorgsovertagelse?: Date;
    fornavn?: string[];
    kanSøkeOmEndring?: boolean;
    sak?: Sak;
    annenForelder?: RegistrertAnnenForelder;
    familiehendelsesdato?: Date;
    startdatoFørsteStønadsperiode?: Date;
    alleBarnaLever: boolean;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"type",value:{name:"ValgtBarnType",required:!0}},{key:"antallBarn",value:{name:"number",required:!0}},{key:"sortableDato",value:{name:"Date",required:!0}},{key:"fnr",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"termindato",value:{name:"Date",required:!1}},{key:"fødselsdatoer",value:{name:"Array",elements:[{name:"Date"}],raw:"Date[]",required:!1}},{key:"omsorgsovertagelse",value:{name:"Date",required:!1}},{key:"fornavn",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"kanSøkeOmEndring",value:{name:"boolean",required:!1}},{key:"sak",value:{name:"Sak",required:!1}},{key:"annenForelder",value:{name:"Omit",elements:[{name:"PersonBase"},{name:"union",raw:"'kjønn' | 'fødselsdato'",elements:[{name:"literal",value:"'kjønn'"},{name:"literal",value:"'fødselsdato'"}]}],raw:"Omit<PersonBase, 'kjønn' | 'fødselsdato'>",required:!1}},{key:"familiehendelsesdato",value:{name:"Date",required:!1}},{key:"startdatoFørsteStønadsperiode",value:{name:"Date",required:!1}},{key:"alleBarnaLever",value:{name:"boolean",required:!0}}]}}],raw:"ValgtBarn[]"},description:""}}};m.extend(ge);m.extend(Pe);const Ve=(t,n,e)=>t?p.ADOPTERT:n.fødselsdato!==void 0||e&&e.length>0?p.FØDT:p.UFØDT,qe=(t,n)=>{const e=t.familiehendelse.termindato;if(pe(e)){const o=m(e).subtract(17,"week"),d=m(e).add(6,"week");return n.filter(a=>m(a.fødselsdato).isBetween(o,d,"day","[]"))}return[]},Ge=(t,n)=>{const e=D(t.familiehendelse.fødselsdato),o=t.barn!==void 0?t.barn.map(l=>l.fnr).flat():[],d=n.filter(l=>o.includes(l.fnr)),a=e!==void 0?n.filter(l=>X(l.fødselsdato,e)&&!d.find(i=>i.fnr===l.fnr)):[];return d.concat(a)},Ye=(t,n)=>{let e;(t.barn||t.familiehendelse.fødselsdato)&&(e=Ge(t,n)),t.familiehendelse.termindato&&!t.familiehendelse.fødselsdato&&!t.barn&&(e=qe(t,n));const o=D(Le(t.familiehendelse.termindato,t.familiehendelse.fødselsdato,t.familiehendelse.omsorgsovertakelse)),d=Ve(t.gjelderAdopsjon,t.familiehendelse,e),a=D(t.familiehendelse.fødselsdato);let l;return e&&e.length>0?l=e.map(i=>m.utc(i.fødselsdato).toDate()):a!==void 0&&(l=Array(t.familiehendelse.antallBarn).fill(a)),{id:O(),type:d,antallBarn:t.familiehendelse.antallBarn,termindato:D(t.familiehendelse.termindato),omsorgsovertagelse:D(t.familiehendelse.omsorgsovertakelse),kanSøkeOmEndring:t.kanSøkeOmEndring,sak:t,fødselsdatoer:l,familiehendelsesdato:o,sortableDato:D(t.familiehendelse.termindato),startdatoFørsteStønadsperiode:t.gjeldendeVedtak!==void 0&&t.gjeldendeVedtak.perioder.length>0?ke(D(t.gjeldendeVedtak.perioder[0].fom)).denneEllerNeste():void 0,fornavn:e!==void 0&&e.length>0?e.filter(i=>i.fornavn!==void 0&&i.fornavn.trim()!=="").map(i=>[i.fornavn,i.mellomnavn!==void 0?i.mellomnavn:""].join(" ")):void 0,fnr:e!==void 0&&e.length>0?e.filter(i=>i.fnr!==void 0).map(i=>i.fnr):void 0,alleBarnaLever:e!==void 0&&e.length>0?e.every(i=>N(i)):!1}},we=(t,n)=>{const e=t.mellomnavn!==void 0?[t.fornavn,t.mellomnavn].join(" "):t.fornavn;return{id:O(),type:p.IKKE_UTFYLT,antallBarn:1,fødselsdatoer:[m.utc(t.fødselsdato).toDate()],fornavn:e!==void 0?[e]:void 0,fnr:[t.fnr],sortableDato:m.utc(t.fødselsdato).toDate(),alleBarnaLever:N(t),annenForelder:n}},Ce=(t,n,e)=>{const o=[t].concat(n).sort(xe);if(!(o.find(a=>!N(a)&&Q(a))||o.length==0))return{id:O(),type:p.IKKE_UTFYLT,antallBarn:o.length,fødselsdatoer:o.map(a=>m.utc(a.fødselsdato).toDate()),fornavn:o.map(a=>[a.fornavn,a.mellomnavn!==void 0?a.mellomnavn:""].join(" ")),fnr:o.map(a=>a.fnr),sortableDato:m.utc(o[0].fødselsdato).toDate(),alleBarnaLever:o.every(a=>N(a)),annenForelder:e}},He=(t,n)=>t.filter(e=>e.barn!==void 0&&e.barn.length>0||e.familiehendelse.termindato!==void 0||e.familiehendelse.fødselsdato!==void 0||e.familiehendelse.omsorgsovertakelse!==void 0).map(e=>Ye(e,n)),$e=(t,n,e)=>{const o=t.filter(s=>!e.find(v=>X(s.fødselsdato,D(v.familiehendelse.fødselsdato)))),d="tempFnr",a=o.map(s=>s.fnr===void 0?{...s,fnr:d+O().toString()}:s),l=n.map(s=>s.fnr).flat(),i=n.filter(s=>s.fødselsdatoer!==void 0&&s.fødselsdatoer.length>0).map(s=>s.fødselsdatoer).flat(),S=[];return a.filter(s=>!(s.dødsdato!==void 0&&i.find(v=>m(v).isSame(m.utc(s.fødselsdato),"day")))).forEach(s=>{if(!l.includes(s.fnr)&&!Fe(s.fødselsdato)){const v=Me(s.fnr,s.fødselsdato,a),E=s.annenForelder!==void 0?{fnr:s.annenForelder.fnr,fornavn:s.annenForelder.fornavn,mellomnavn:s.annenForelder.mellomnavn,etternavn:s.annenForelder.etternavn}:void 0;if(l.push(s.fnr),v.length===0){if(!Q(s)){const h=we(s,E);S.push(h)}}else{const h=Ce(s,v,E);v.forEach(_=>{l.push(_.fnr)}),h!==void 0&&S.push(h)}}}),S.map(s=>s.fnr&&s.fnr.length>0?{...s,fnr:s.fnr.filter(v=>v&&!v.startsWith(d))}:s)},Je=(t,n)=>{const e=t.filter(l=>!l.sakAvsluttet),o=t.filter(l=>l.sakAvsluttet),d=He(e,n),a=$e(n,d,o);return d.concat(a)},ze=(t,n)=>{var d,a;const e=n.filter(l=>l.sak!==void 0&&l.id!==t.id&&l.familiehendelsesdato!==void 0&&m(l.familiehendelsesdato).isAfter(t.familiehendelsesdato,"day"));e.sort(te);const o=e[e.length-1];if(o!==void 0)return{familiehendelsesdato:o.familiehendelsesdato,startdatoFørsteStønadsperiode:o.startdatoFørsteStønadsperiode,fnr:o.fnr,annenForelderFnr:(a=(d=o.sak)==null?void 0:d.annenPart)==null?void 0:a.fnr}},te=(t,n)=>m(t.sortableDato).isBefore(n.sortableDato,"d")?1:m(t.sortableDato).isAfter(n.sortableDato,"d")?-1:0,ne=({locale:t,saker:n,onChangeLocale:e,harGodkjentVilkår:o,søkerInfo:d,setHarGodkjentVilkår:a,setErEndringssøknad:l,setSøknadGjelderNyttBarn:i,mellomlagreSøknadOgNaviger:S})=>{const F=J(),U=Ee(d.arbeidsforhold,S),[s,v]=R.useState(!1),E=W(),{oppdaterSøknadIState:h}=be(),[_,b]=R.useState(!1),A=R.useMemo(()=>Je(n,d.søker.barn),[n,d.søker.barn]),I=[...A].sort(te),ae=g=>{if(g.harForståttRettigheterOgPlikter!==!0)return;v(!0);const c=g.valgteBarn===P.SØKNAD_GJELDER_NYTT_BARN?void 0:A.find(u=>u.id===g.valgteBarn),M=c!==void 0&&!!c.kanSøkeOmEndring;let B;c!==void 0&&(B=ze(c,I),E(f.BARN_FRA_NESTE_SAK,B));const x=M&&c.sak!==void 0?n.find(u=>{var j;return u.saksnummer===((j=c.sak)==null?void 0:j.saksnummer)}):void 0,se=B!==void 0?B.startdatoFørsteStønadsperiode:void 0,G=M&&x,Y=c!==void 0&&c.sak!==void 0&&c.kanSøkeOmEndring===!1,oe=!G&&!Y&&c!==void 0;let w=$.SØKERSITUASJON,C=!1;if(G){const u=Be(x,se,c.fødselsdatoer);w=$.UTTAKSPLAN;const j=je(d.søker,u,F,x.annenPart,c);h(j,u)}else if(Y){const u=Te(c,F,d.søker.barn,d.søker.fnr);h(u)}else if(oe){const u=ye(c);h(u)}else C=!0;return a(g.harForståttRettigheterOgPlikter),l(M),i(C),U.goToNextStep(w)},K=le({defaultValues:{harForståttRettigheterOgPlikter:o}}),V=K.watch("valgteBarn"),q=V===P.SØKNAD_GJELDER_NYTT_BARN?void 0:A.find(g=>g.id===V),re=q!==void 0&&q.kanSøkeOmEndring===!0?F.formatMessage({id:"velkommen.endreSøknad"}):F.formatMessage({id:"velkommen.begynnMedSøknad"});return r.jsx(ie,{formMethods:K,onSubmit:ae,children:r.jsxs(T,{gap:"10",children:[r.jsx(Se,{locale:t,availableLocales:["nb","nn"],toggle:e}),r.jsx(me,{children:r.jsxs(T,{gap:"8",children:[r.jsx(y,{justify:"center",children:r.jsx(ue,{size:"xlarge",children:r.jsx(k,{id:"velkommen.tittel"})})}),r.jsx(fe,{poster:!0,children:r.jsxs(T,{gap:"2",children:[r.jsx(k,{id:"velkommen.guidepanel.del1"}),r.jsx(k,{id:"velkommen.guidepanel.del2",values:{a:g=>r.jsx("a",{className:"lenke",rel:"noopener noreferrer",href:De.foreldrepenger,children:g})}})]})}),r.jsx(ee,{selectableBarn:I}),r.jsx(ce,{variant:"info",children:r.jsx(k,{id:"velkommen.lagring.info"})}),r.jsx(ve,{name:"harForståttRettigheterOgPlikter",label:F.formatMessage({id:"velkommen.samtykke"}),validate:[g=>g!==!0?F.formatMessage({id:"valideringsfeil.velkommen.harForståttRettigheterOgPlikter.påkrevd"}):null],children:r.jsx(T,{gap:"5",children:r.jsxs(y,{gap:"1",children:[r.jsx(H,{children:r.jsx(k,{id:"velkommen.samtykkeIntro.del1"})}),r.jsx(Re,{})]})})}),r.jsx(y,{justify:"center",children:r.jsx(he,{type:"submit",variant:"primary",disabled:s,loading:s,children:re})}),r.jsx(y,{justify:"center",children:r.jsx(H,{children:r.jsx("a",{className:"lenke",href:"#",onClick:g=>{g.preventDefault(),b(!0)},children:r.jsx(k,{id:"velkommen.lesMerOmPersonopplysninger"})})})}),r.jsx(Ue,{isOpen:_,onRequestClose:()=>b(!1)})]})})]})})},ct=ne;ne.__docgenInfo={description:"",methods:[],displayName:"Forside"};export{ct as F};
