import{j as r}from"./jsx-runtime-Cw0GR0a5.js";import{b as $,C as f}from"./FpDataContext-DbGuQRR8.js";import{e as oe,a as de,S as H}from"./useFpNavigator-CVbVA1IY.js";import{r as R}from"./index-CTjT7uj6.js";import{R as le,u as ie,F as me,C as fe}from"./ErrorSummaryHookForm-DMrWerbz.js";import{u as z,M as k,H as ce,B as J}from"./Label-DlDsESPM.js";import{m as ge,o as ve,a as ue,b as pe}from"./eksisterendeSakUtils-p-Gf_ybT.js";import{l as ke}from"./links-DsaZ4ja0.js";import{d as m,c as W,u as Se,U as he,i as De}from"./Uttaksdagen-Uuolrvsk.js";import{c as Fe,R as L,L as Ee,C as Be,J as je,K as Te}from"./Uttaksplan-Bv_Qa67z.js";import{b as ye,c as Ne,d as Oe,t as _e,e as Q,I as D,h as Ae,i as X,j as Me,k as N,s as xe}from"./barnUtils-BbVHJko0.js";import{D as Re}from"./DinePlikter-CeSrjll3.js";import{g as O}from"./guid-CsArkN6i.js";import{D as Pe}from"./DinePersonopplysningerModal-D7A35WP9.js";import{V as T,H as y,B as Le}from"./VStack-CrTlUGgl.js";const Ue=()=>{const t=$();return{oppdaterSøknadIState:(e,o)=>{t(f.SØKERSITUASJON,e.søkersituasjon),t(f.OM_BARNET,e.barn),t(f.ANNEN_FORELDER,e.annenForelder),t(f.ARBEIDSFORHOLD_OG_INNTEKT,e.arbeidsforholdOgInntekt),t(f.FRILANS,e.frilans),t(f.EGEN_NÆRING,e.egenNæring),t(f.ANDRE_INNTEKTSKILDER,e.andreInntektskilder),t(f.UTENLANDSOPPHOLD,e.informasjonOmUtenlandsopphold?{iNorgeNeste12Mnd:e.informasjonOmUtenlandsopphold.iNorgeNeste12Mnd,iNorgeSiste12Mnd:e.informasjonOmUtenlandsopphold.iNorgeSiste12Mnd}:void 0),t(f.UTENLANDSOPPHOLD_TIDLIGERE,e.informasjonOmUtenlandsopphold?{tidligereOpphold:e.informasjonOmUtenlandsopphold.tidligereOpphold}:void 0),t(f.UTENLANDSOPPHOLD_SENERE,e.informasjonOmUtenlandsopphold?{senereOpphold:e.informasjonOmUtenlandsopphold.senereOpphold}:void 0),t(f.PERIODE_MED_FORELDREPENGER,{dekningsgrad:e.dekningsgrad}),t(f.UTTAKSPLAN,e.uttaksplan),t(f.UTTAKSPLAN_METADATA,{ønskerJustertUttakVedFødsel:e.ønskerJustertUttakVedFødsel}),o&&t(f.EKSISTERENDE_SAK,o)}}};var u=(t=>(t.FØDT="født",t.UFØDT="ufødt",t.ADOPTERT="adoptert",t.IKKE_UTFYLT="ikkeUtfylt",t))(u||{}),P=(t=>(t.SØKNAD_GJELDER_NYTT_BARN="søknad_gjeder_nytt_barn",t))(P||{});const be=(t,n)=>t.map(e=>{const o=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,n):void 0,d=e.sak!==void 0?n.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"";return r.jsx(L,{value:e.id,description:e.sak!==void 0?`${d}, ${o}`:d,children:r.jsx(k,{id:"velkommen.barnVelger.ufødtBarn",values:{antallBarnTekst:ye(e.antallBarn,n),termin:m(e.termindato).format(W),b:a=>r.jsx("b",{children:a})}})},e.id)}),Z=(t,n)=>t?n.formatMessage({id:"velkommen.sak.status.ferdigBehandlet"}):n.formatMessage({id:"velkommen.sak.status.underBehandling"}),Ie=(t,n)=>t.map(e=>{const o=Ne(e.fornavn,e.fødselsdatoer,e.omsorgsovertagelse,e.alleBarnaLever,e.antallBarn,n),d=Oe(e.fødselsdatoer),a=e.type===u.FØDT||e.type===u.IKKE_UTFYLT?d:m(e.omsorgsovertagelse).format(W),l=e.type===u.FØDT||e.type===u.IKKE_UTFYLT?n.formatMessage({id:"velkommen.barnVelger.født"}):n.formatMessage({id:"velkommen.barnVelger.adopsjon"}),i=e.sak!==void 0?n.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"",S=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,n):void 0;return r.jsx(L,{value:e.id,description:S?`${i}, ${S}`:i,children:r.jsx("b",{children:e.alleBarnaLever?`${o} ${l} ${a}`:o})},e.id)}),ee=({selectableBarn:t})=>{const n=z();if(t.length===0)return null;const e=t.filter(a=>a.type===u.UFØDT),o=t.filter(a=>a.type!==u.UFØDT);let d=[];return o.length>0&&(d=d.concat(Ie(o,n))),e.length>0&&(d=d.concat(be(e,n))),r.jsx(le,{name:"valgteBarn",label:r.jsx(k,{id:"velkommen.intro.harSaker.barnVelger.label"}),validate:[Fe(n.formatMessage({id:"steg.footer.spørsmålMåBesvares"}))],children:d.concat(r.jsx(L,{value:"søknad_gjeder_nytt_barn",description:n.formatMessage({id:"velkommen.intro.harSaker.barnVelger.info"}),children:r.jsx(k,{id:"omBarnet.gjelderAnnetBarn",values:{b:a=>r.jsx("b",{children:a})}})},"søknad_gjeder_nytt_barn"))})};ee.__docgenInfo={description:"",methods:[],displayName:"BarnVelger",props:{selectableBarn:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    id: string;
    type: ValgtBarnType;
    antallBarn: number;
    sortableDato: Date;
    fnr?: string[];
    termindato?: Date;
    fødselsdatoer?: Date[];
    omsorgsovertagelse?: Date;
    fornavn?: string[];
    kanSøkeOmEndring?: boolean;
    sak?: Sak;
    annenForelder?: RegistrertAnnenForelder;
    familiehendelsesdato?: Date;
    startdatoFørsteStønadsperiode?: Date;
    alleBarnaLever: boolean;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"type",value:{name:"ValgtBarnType",required:!0}},{key:"antallBarn",value:{name:"number",required:!0}},{key:"sortableDato",value:{name:"Date",required:!0}},{key:"fnr",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"termindato",value:{name:"Date",required:!1}},{key:"fødselsdatoer",value:{name:"Array",elements:[{name:"Date"}],raw:"Date[]",required:!1}},{key:"omsorgsovertagelse",value:{name:"Date",required:!1}},{key:"fornavn",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"kanSøkeOmEndring",value:{name:"boolean",required:!1}},{key:"sak",value:{name:"Sak",required:!1}},{key:"annenForelder",value:{name:"Omit",elements:[{name:"PersonBase"},{name:"union",raw:"'kjønn' | 'fødselsdato'",elements:[{name:"literal",value:"'kjønn'"},{name:"literal",value:"'fødselsdato'"}]}],raw:"Omit<PersonBase, 'kjønn' | 'fødselsdato'>",required:!1}},{key:"familiehendelsesdato",value:{name:"Date",required:!1}},{key:"startdatoFørsteStønadsperiode",value:{name:"Date",required:!1}},{key:"alleBarnaLever",value:{name:"boolean",required:!0}}]}}],raw:"ValgtBarn[]"},description:""}}};m.extend(Se);m.extend(_e);const Ke=(t,n,e)=>t?u.ADOPTERT:n.fødselsdato!==void 0||e&&e.length>0?u.FØDT:u.UFØDT,Ve=(t,n)=>{const e=t.familiehendelse.termindato;if(De(e)){const o=m(e).subtract(17,"week"),d=m(e).add(6,"week");return n.filter(a=>m(a.fødselsdato).isBetween(o,d,"day","[]"))}return[]},qe=(t,n)=>{const e=D(t.familiehendelse.fødselsdato),o=t.barn!==void 0?t.barn.map(l=>l.fnr).flat():[],d=n.filter(l=>o.includes(l.fnr)),a=e!==void 0?n.filter(l=>Q(l.fødselsdato,e)&&!d.find(i=>i.fnr===l.fnr)):[];return d.concat(a)},Ye=(t,n)=>{let e;(t.barn||t.familiehendelse.fødselsdato)&&(e=qe(t,n)),t.familiehendelse.termindato&&!t.familiehendelse.fødselsdato&&!t.barn&&(e=Ve(t,n));const o=D(Me(t.familiehendelse.termindato,t.familiehendelse.fødselsdato,t.familiehendelse.omsorgsovertakelse)),d=Ke(t.gjelderAdopsjon,t.familiehendelse,e),a=D(t.familiehendelse.fødselsdato);let l;return e&&e.length>0?l=e.map(i=>m.utc(i.fødselsdato).toDate()):a!==void 0&&(l=Array(t.familiehendelse.antallBarn).fill(a)),{id:O(),type:d,antallBarn:t.familiehendelse.antallBarn,termindato:D(t.familiehendelse.termindato),omsorgsovertagelse:D(t.familiehendelse.omsorgsovertakelse),kanSøkeOmEndring:t.kanSøkeOmEndring,sak:t,fødselsdatoer:l,familiehendelsesdato:o,sortableDato:D(t.familiehendelse.termindato),startdatoFørsteStønadsperiode:t.gjeldendeVedtak!==void 0&&t.gjeldendeVedtak.perioder.length>0?he(D(t.gjeldendeVedtak.perioder[0].fom)).denneEllerNeste():void 0,fornavn:e!==void 0&&e.length>0?e.filter(i=>i.fornavn!==void 0&&i.fornavn.trim()!=="").map(i=>[i.fornavn,i.mellomnavn!==void 0?i.mellomnavn:""].join(" ")):void 0,fnr:e!==void 0&&e.length>0?e.filter(i=>i.fnr!==void 0).map(i=>i.fnr):void 0,alleBarnaLever:e!==void 0&&e.length>0?e.every(i=>N(i)):!1}},we=(t,n)=>{const e=t.mellomnavn!==void 0?[t.fornavn,t.mellomnavn].join(" "):t.fornavn;return{id:O(),type:u.IKKE_UTFYLT,antallBarn:1,fødselsdatoer:[m.utc(t.fødselsdato).toDate()],fornavn:e!==void 0?[e]:void 0,fnr:[t.fnr],sortableDato:m.utc(t.fødselsdato).toDate(),alleBarnaLever:N(t),annenForelder:n}},Ge=(t,n,e)=>{const o=[t].concat(n).sort(xe);if(!(o.find(a=>!N(a)&&X(a))||o.length==0))return{id:O(),type:u.IKKE_UTFYLT,antallBarn:o.length,fødselsdatoer:o.map(a=>m.utc(a.fødselsdato).toDate()),fornavn:o.map(a=>[a.fornavn,a.mellomnavn!==void 0?a.mellomnavn:""].join(" ")),fnr:o.map(a=>a.fnr),sortableDato:m.utc(o[0].fødselsdato).toDate(),alleBarnaLever:o.every(a=>N(a)),annenForelder:e}},Ce=(t,n)=>t.filter(e=>e.barn!==void 0&&e.barn.length>0||e.familiehendelse.termindato!==void 0||e.familiehendelse.fødselsdato!==void 0||e.familiehendelse.omsorgsovertakelse!==void 0).map(e=>Ye(e,n)),He=(t,n,e)=>{const o=t.filter(s=>!e.find(g=>Q(s.fødselsdato,D(g.familiehendelse.fødselsdato)))),d="tempFnr",a=o.map(s=>s.fnr===void 0?{...s,fnr:d+O().toString()}:s),l=n.map(s=>s.fnr).flat(),i=n.filter(s=>s.fødselsdatoer!==void 0&&s.fødselsdatoer.length>0).map(s=>s.fødselsdatoer).flat(),S=[];return a.filter(s=>!(s.dødsdato!==void 0&&i.find(g=>m(g).isSame(m.utc(s.fødselsdato),"day")))).forEach(s=>{if(!l.includes(s.fnr)&&!oe(s.fødselsdato)){const g=Ae(s.fnr,s.fødselsdato,a),E=s.annenForelder!==void 0?{fnr:s.annenForelder.fnr,fornavn:s.annenForelder.fornavn,mellomnavn:s.annenForelder.mellomnavn,etternavn:s.annenForelder.etternavn}:void 0;if(l.push(s.fnr),g.length===0){if(!X(s)){const h=we(s,E);S.push(h)}}else{const h=Ge(s,g,E);g.forEach(_=>{l.push(_.fnr)}),h!==void 0&&S.push(h)}}}),S.map(s=>s.fnr&&s.fnr.length>0?{...s,fnr:s.fnr.filter(g=>g&&!g.startsWith(d))}:s)},Je=(t,n)=>{const e=t.filter(l=>!l.sakAvsluttet),o=t.filter(l=>l.sakAvsluttet),d=Ce(e,n),a=He(n,d,o);return d.concat(a)},$e=(t,n)=>{var d,a;const e=n.filter(l=>l.sak!==void 0&&l.id!==t.id&&l.familiehendelsesdato!==void 0&&m(l.familiehendelsesdato).isAfter(t.familiehendelsesdato,"day"));e.sort(te);const o=e[e.length-1];if(o!==void 0)return{familiehendelsesdato:o.familiehendelsesdato,startdatoFørsteStønadsperiode:o.startdatoFørsteStønadsperiode,fnr:o.fnr,annenForelderFnr:(a=(d=o.sak)==null?void 0:d.annenPart)==null?void 0:a.fnr}},te=(t,n)=>m(t.sortableDato).isBefore(n.sortableDato,"d")?1:m(t.sortableDato).isAfter(n.sortableDato,"d")?-1:0,ze=({locale:t,saker:n,onChangeLocale:e,harGodkjentVilkår:o,søkerInfo:d,setHarGodkjentVilkår:a,setErEndringssøknad:l,setSøknadGjelderNyttBarn:i,mellomlagreSøknadOgNaviger:S})=>{const F=z(),U=de(d.arbeidsforhold,S),[s,g]=R.useState(!1),E=$(),{oppdaterSøknadIState:h}=Ue(),[_,b]=R.useState(!1),A=R.useMemo(()=>Je(n,d.søker.barn),[n,d.søker.barn]),I=[...A].sort(te),ne=v=>{if(v.harForståttRettigheterOgPlikter!==!0)return;g(!0);const c=v.valgteBarn===P.SØKNAD_GJELDER_NYTT_BARN?void 0:A.find(p=>p.id===v.valgteBarn),M=c!==void 0&&!!c.kanSøkeOmEndring;let B;c!==void 0&&(B=$e(c,I),E(f.BARN_FRA_NESTE_SAK,B));const x=M&&c.sak!==void 0?n.find(p=>{var j;return p.saksnummer===((j=c.sak)==null?void 0:j.saksnummer)}):void 0,re=B!==void 0?B.startdatoFørsteStønadsperiode:void 0,Y=M&&x,w=c!==void 0&&c.sak!==void 0&&c.kanSøkeOmEndring===!1,se=!Y&&!w&&c!==void 0;let G=H.SØKERSITUASJON,C=!1;if(Y){const p=ge(x,re,c.fødselsdatoer);G=H.UTTAKSPLAN;const j=ve(d.søker,p,F,x.annenPart,c);h(j,p)}else if(w){const p=ue(c,F,d.søker.barn,d.søker.fnr);h(p)}else if(se){const p=pe(c);h(p)}else C=!0;return a(v.harForståttRettigheterOgPlikter),l(M),i(C),U.goToNextStep(G)},K=ie({defaultValues:{harForståttRettigheterOgPlikter:o}}),V=K.watch("valgteBarn"),q=V===P.SØKNAD_GJELDER_NYTT_BARN?void 0:A.find(v=>v.id===V),ae=q!==void 0&&q.kanSøkeOmEndring===!0?F.formatMessage({id:"velkommen.endreSøknad"}):F.formatMessage({id:"velkommen.begynnMedSøknad"});return r.jsx(me,{formMethods:K,onSubmit:ne,children:r.jsxs(T,{gap:"10",children:[r.jsx(Ee,{locale:t,availableLocales:["nb","nn"],toggleLanguage:e}),r.jsx(Be,{children:r.jsxs(T,{gap:"8",children:[r.jsx(y,{justify:"center",children:r.jsx(ce,{size:"xlarge",children:r.jsx(k,{id:"velkommen.tittel"})})}),r.jsx(je,{poster:!0,children:r.jsxs(T,{gap:"2",children:[r.jsx(k,{id:"velkommen.guidepanel.del1"}),r.jsx(k,{id:"velkommen.guidepanel.del2",values:{a:v=>r.jsx("a",{className:"lenke",rel:"noopener noreferrer",href:ke.foreldrepenger,children:v})}})]})}),r.jsx(ee,{selectableBarn:I}),r.jsx(Te,{variant:"info",children:r.jsx(k,{id:"velkommen.lagring.info"})}),r.jsx(fe,{name:"harForståttRettigheterOgPlikter",label:F.formatMessage({id:"velkommen.samtykke"}),validate:[v=>v!==!0?F.formatMessage({id:"valideringsfeil.velkommen.harForståttRettigheterOgPlikter.påkrevd"}):null],children:r.jsx(T,{gap:"5",children:r.jsxs(y,{gap:"1",children:[r.jsx(J,{children:r.jsx(k,{id:"velkommen.samtykkeIntro.del1"})}),r.jsx(Re,{})]})})}),r.jsx(y,{justify:"center",children:r.jsx(Le,{type:"submit",variant:"primary",disabled:s,loading:s,children:ae})}),r.jsx(y,{justify:"center",children:r.jsx(J,{children:r.jsx("a",{className:"lenke",href:"#",onClick:v=>{v.preventDefault(),b(!0)},children:r.jsx(k,{id:"velkommen.lesMerOmPersonopplysninger"})})})}),r.jsx(Pe,{isOpen:_,onRequestClose:()=>b(!1)})]})})]})})};ze.__docgenInfo={description:"",methods:[],displayName:"Forside"};export{ze as F};
