import{j as s}from"./jsx-runtime-Cw0GR0a5.js";import{b as $,C as f}from"./FpDataContext-CsWTkUpZ.js";import{e as oe,a as de,S as H}from"./useFpNavigator-DNvZodRn.js";import{r as x}from"./index-CTjT7uj6.js";import{b as le,u as ie,R as me,c as fe}from"./ErrorSummaryHookForm-DyIKHKiB.js";import{u as z,M as k,H as ce,B as J}from"./Label-DlDsESPM.js";import{m as ge,o as ve,a as ue,b as pe}from"./eksisterendeSakUtils-BTVgFjBV.js";import{l as ke}from"./links-DsaZ4ja0.js";import{d as m,c as W,u as Se,U as he,i as De}from"./Uttaksdagen-Uuolrvsk.js";import{c as Fe,R as L,L as Ee,C as Be,J as je,K as Te}from"./Uttaksplan-CrTp7dMA.js";import{b as ye,c as Ne,d as _e,t as Oe,e as Q,I as D,h as Ae,i as X,j as Me,k as N,s as Re}from"./barnUtils-HoWmB2Bo.js";import{D as xe}from"./DinePlikter-CeSrjll3.js";import{g as _}from"./guid-CsArkN6i.js";import{D as Pe}from"./DinePersonopplysningerModal-D7A35WP9.js";import{V as T,H as y,B as Le}from"./VStack-CrTlUGgl.js";const Ue=()=>{const t=$();return{oppdaterSøknadIState:(e,d)=>{t(f.SØKERSITUASJON,e.søkersituasjon),t(f.OM_BARNET,e.barn),t(f.ANNEN_FORELDER,e.annenForelder),t(f.ARBEIDSFORHOLD_OG_INNTEKT,e.arbeidsforholdOgInntekt),t(f.FRILANS,e.frilans),t(f.EGEN_NÆRING,e.egenNæring),t(f.ANDRE_INNTEKTSKILDER,e.andreInntektskilder),t(f.UTENLANDSOPPHOLD,e.informasjonOmUtenlandsopphold?{skalBoUtenforNorgeNeste12Mnd:!e.informasjonOmUtenlandsopphold.iNorgeNeste12Mnd,harBoddUtenforNorgeSiste12Mnd:!e.informasjonOmUtenlandsopphold.iNorgeSiste12Mnd}:void 0),t(f.UTENLANDSOPPHOLD_TIDLIGERE,e.informasjonOmUtenlandsopphold?{utenlandsoppholdSiste12Mnd:e.informasjonOmUtenlandsopphold.tidligereOpphold.map(a=>({landkode:a.land,...a.tidsperiode}))}:void 0),t(f.UTENLANDSOPPHOLD_SENERE,e.informasjonOmUtenlandsopphold?{utenlandsoppholdNeste12Mnd:e.informasjonOmUtenlandsopphold.tidligereOpphold.map(a=>({landkode:a.land,...a.tidsperiode}))}:void 0),t(f.PERIODE_MED_FORELDREPENGER,{dekningsgrad:e.dekningsgrad}),t(f.UTTAKSPLAN,e.uttaksplan),t(f.UTTAKSPLAN_METADATA,{ønskerJustertUttakVedFødsel:e.ønskerJustertUttakVedFødsel}),d&&t(f.EKSISTERENDE_SAK,d)}}};var u=(t=>(t.FØDT="født",t.UFØDT="ufødt",t.ADOPTERT="adoptert",t.IKKE_UTFYLT="ikkeUtfylt",t))(u||{}),P=(t=>(t.SØKNAD_GJELDER_NYTT_BARN="søknad_gjeder_nytt_barn",t))(P||{});const be=(t,n)=>t.map(e=>{const d=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,n):void 0,a=e.sak!==void 0?n.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"";return s.jsx(L,{value:e.id,description:e.sak!==void 0?`${a}, ${d}`:a,children:s.jsx(k,{id:"velkommen.barnVelger.ufødtBarn",values:{antallBarnTekst:ye(e.antallBarn,n),termin:m(e.termindato).format(W),b:r=>s.jsx("b",{children:r})}})},e.id)}),Z=(t,n)=>t?n.formatMessage({id:"velkommen.sak.status.ferdigBehandlet"}):n.formatMessage({id:"velkommen.sak.status.underBehandling"}),Ie=(t,n)=>t.map(e=>{const d=Ne(e.fornavn,e.fødselsdatoer,e.omsorgsovertagelse,e.alleBarnaLever,e.antallBarn,n),a=_e(e.fødselsdatoer),r=e.type===u.FØDT||e.type===u.IKKE_UTFYLT?a:m(e.omsorgsovertagelse).format(W),l=e.type===u.FØDT||e.type===u.IKKE_UTFYLT?n.formatMessage({id:"velkommen.barnVelger.født"}):n.formatMessage({id:"velkommen.barnVelger.adopsjon"}),i=e.sak!==void 0?n.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"",S=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,n):void 0;return s.jsx(L,{value:e.id,description:S?`${i}, ${S}`:i,children:s.jsx("b",{children:e.alleBarnaLever?`${d} ${l} ${r}`:d})},e.id)}),ee=({selectableBarn:t})=>{const n=z();if(t.length===0)return null;const e=t.filter(r=>r.type===u.UFØDT),d=t.filter(r=>r.type!==u.UFØDT);let a=[];return d.length>0&&(a=a.concat(Ie(d,n))),e.length>0&&(a=a.concat(be(e,n))),s.jsx(le,{name:"valgteBarn",label:s.jsx(k,{id:"velkommen.intro.harSaker.barnVelger.label"}),validate:[Fe(n.formatMessage({id:"steg.footer.spørsmålMåBesvares"}))],children:a.concat(s.jsx(L,{value:"søknad_gjeder_nytt_barn",description:n.formatMessage({id:"velkommen.intro.harSaker.barnVelger.info"}),children:s.jsx(k,{id:"omBarnet.gjelderAnnetBarn",values:{b:r=>s.jsx("b",{children:r})}})},"søknad_gjeder_nytt_barn"))})};ee.__docgenInfo={description:"",methods:[],displayName:"BarnVelger",props:{selectableBarn:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    id: string;
    type: ValgtBarnType;
    antallBarn: number;
    sortableDato: Date;
    fnr?: string[];
    termindato?: Date;
    fødselsdatoer?: Date[];
    omsorgsovertagelse?: Date;
    fornavn?: string[];
    kanSøkeOmEndring?: boolean;
    sak?: Sak;
    annenForelder?: RegistrertAnnenForelder;
    familiehendelsesdato?: Date;
    startdatoFørsteStønadsperiode?: Date;
    alleBarnaLever: boolean;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"type",value:{name:"ValgtBarnType",required:!0}},{key:"antallBarn",value:{name:"number",required:!0}},{key:"sortableDato",value:{name:"Date",required:!0}},{key:"fnr",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"termindato",value:{name:"Date",required:!1}},{key:"fødselsdatoer",value:{name:"Array",elements:[{name:"Date"}],raw:"Date[]",required:!1}},{key:"omsorgsovertagelse",value:{name:"Date",required:!1}},{key:"fornavn",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"kanSøkeOmEndring",value:{name:"boolean",required:!1}},{key:"sak",value:{name:"Sak",required:!1}},{key:"annenForelder",value:{name:"Omit",elements:[{name:"PersonBase"},{name:"union",raw:"'kjønn' | 'fødselsdato'",elements:[{name:"literal",value:"'kjønn'"},{name:"literal",value:"'fødselsdato'"}]}],raw:"Omit<PersonBase, 'kjønn' | 'fødselsdato'>",required:!1}},{key:"familiehendelsesdato",value:{name:"Date",required:!1}},{key:"startdatoFørsteStønadsperiode",value:{name:"Date",required:!1}},{key:"alleBarnaLever",value:{name:"boolean",required:!0}}]}}],raw:"ValgtBarn[]"},description:""}}};m.extend(Se);m.extend(Oe);const Ke=(t,n,e)=>t?u.ADOPTERT:n.fødselsdato!==void 0||e&&e.length>0?u.FØDT:u.UFØDT,Ve=(t,n)=>{const e=t.familiehendelse.termindato;if(De(e)){const d=m(e).subtract(17,"week"),a=m(e).add(6,"week");return n.filter(r=>m(r.fødselsdato).isBetween(d,a,"day","[]"))}return[]},qe=(t,n)=>{const e=D(t.familiehendelse.fødselsdato),d=t.barn!==void 0?t.barn.map(l=>l.fnr).flat():[],a=n.filter(l=>d.includes(l.fnr)),r=e!==void 0?n.filter(l=>Q(l.fødselsdato,e)&&!a.find(i=>i.fnr===l.fnr)):[];return a.concat(r)},Ye=(t,n)=>{let e;(t.barn||t.familiehendelse.fødselsdato)&&(e=qe(t,n)),t.familiehendelse.termindato&&!t.familiehendelse.fødselsdato&&!t.barn&&(e=Ve(t,n));const d=D(Me(t.familiehendelse.termindato,t.familiehendelse.fødselsdato,t.familiehendelse.omsorgsovertakelse)),a=Ke(t.gjelderAdopsjon,t.familiehendelse,e),r=D(t.familiehendelse.fødselsdato);let l;return e&&e.length>0?l=e.map(i=>m.utc(i.fødselsdato).toDate()):r!==void 0&&(l=Array(t.familiehendelse.antallBarn).fill(r)),{id:_(),type:a,antallBarn:t.familiehendelse.antallBarn,termindato:D(t.familiehendelse.termindato),omsorgsovertagelse:D(t.familiehendelse.omsorgsovertakelse),kanSøkeOmEndring:t.kanSøkeOmEndring,sak:t,fødselsdatoer:l,familiehendelsesdato:d,sortableDato:D(t.familiehendelse.termindato),startdatoFørsteStønadsperiode:t.gjeldendeVedtak!==void 0&&t.gjeldendeVedtak.perioder.length>0?he(D(t.gjeldendeVedtak.perioder[0].fom)).denneEllerNeste():void 0,fornavn:e!==void 0&&e.length>0?e.filter(i=>i.fornavn!==void 0&&i.fornavn.trim()!=="").map(i=>[i.fornavn,i.mellomnavn!==void 0?i.mellomnavn:""].join(" ")):void 0,fnr:e!==void 0&&e.length>0?e.filter(i=>i.fnr!==void 0).map(i=>i.fnr):void 0,alleBarnaLever:e!==void 0&&e.length>0?e.every(i=>N(i)):!1}},we=(t,n)=>{const e=t.mellomnavn!==void 0?[t.fornavn,t.mellomnavn].join(" "):t.fornavn;return{id:_(),type:u.IKKE_UTFYLT,antallBarn:1,fødselsdatoer:[m.utc(t.fødselsdato).toDate()],fornavn:e!==void 0?[e]:void 0,fnr:[t.fnr],sortableDato:m.utc(t.fødselsdato).toDate(),alleBarnaLever:N(t),annenForelder:n}},Ge=(t,n,e)=>{const d=[t].concat(n).sort(Re);if(!(d.find(r=>!N(r)&&X(r))||d.length==0))return{id:_(),type:u.IKKE_UTFYLT,antallBarn:d.length,fødselsdatoer:d.map(r=>m.utc(r.fødselsdato).toDate()),fornavn:d.map(r=>[r.fornavn,r.mellomnavn!==void 0?r.mellomnavn:""].join(" ")),fnr:d.map(r=>r.fnr),sortableDato:m.utc(d[0].fødselsdato).toDate(),alleBarnaLever:d.every(r=>N(r)),annenForelder:e}},Ce=(t,n)=>t.filter(e=>e.barn!==void 0&&e.barn.length>0||e.familiehendelse.termindato!==void 0||e.familiehendelse.fødselsdato!==void 0||e.familiehendelse.omsorgsovertakelse!==void 0).map(e=>Ye(e,n)),He=(t,n,e)=>{const d=t.filter(o=>!e.find(g=>Q(o.fødselsdato,D(g.familiehendelse.fødselsdato)))),a="tempFnr",r=d.map(o=>o.fnr===void 0?{...o,fnr:a+_().toString()}:o),l=n.map(o=>o.fnr).flat(),i=n.filter(o=>o.fødselsdatoer!==void 0&&o.fødselsdatoer.length>0).map(o=>o.fødselsdatoer).flat(),S=[];return r.filter(o=>!(o.dødsdato!==void 0&&i.find(g=>m(g).isSame(m.utc(o.fødselsdato),"day")))).forEach(o=>{if(!l.includes(o.fnr)&&!oe(o.fødselsdato)){const g=Ae(o.fnr,o.fødselsdato,r),E=o.annenForelder!==void 0?{fnr:o.annenForelder.fnr,fornavn:o.annenForelder.fornavn,mellomnavn:o.annenForelder.mellomnavn,etternavn:o.annenForelder.etternavn}:void 0;if(l.push(o.fnr),g.length===0){if(!X(o)){const h=we(o,E);S.push(h)}}else{const h=Ge(o,g,E);g.forEach(O=>{l.push(O.fnr)}),h!==void 0&&S.push(h)}}}),S.map(o=>o.fnr&&o.fnr.length>0?{...o,fnr:o.fnr.filter(g=>g&&!g.startsWith(a))}:o)},Je=(t,n)=>{const e=t.filter(l=>!l.sakAvsluttet),d=t.filter(l=>l.sakAvsluttet),a=Ce(e,n),r=He(n,a,d);return a.concat(r)},$e=(t,n)=>{var a,r;const e=n.filter(l=>l.sak!==void 0&&l.id!==t.id&&l.familiehendelsesdato!==void 0&&m(l.familiehendelsesdato).isAfter(t.familiehendelsesdato,"day"));e.sort(te);const d=e[e.length-1];if(d!==void 0)return{familiehendelsesdato:d.familiehendelsesdato,startdatoFørsteStønadsperiode:d.startdatoFørsteStønadsperiode,fnr:d.fnr,annenForelderFnr:(r=(a=d.sak)==null?void 0:a.annenPart)==null?void 0:r.fnr}},te=(t,n)=>m(t.sortableDato).isBefore(n.sortableDato,"d")?1:m(t.sortableDato).isAfter(n.sortableDato,"d")?-1:0,ze=({locale:t,saker:n,onChangeLocale:e,harGodkjentVilkår:d,søkerInfo:a,setHarGodkjentVilkår:r,setErEndringssøknad:l,setSøknadGjelderNyttBarn:i,mellomlagreSøknadOgNaviger:S})=>{const F=z(),U=de(a.arbeidsforhold,S),[o,g]=x.useState(!1),E=$(),{oppdaterSøknadIState:h}=Ue(),[O,b]=x.useState(!1),A=x.useMemo(()=>Je(n,a.søker.barn),[n,a.søker.barn]),I=[...A].sort(te),ne=v=>{if(v.harForståttRettigheterOgPlikter!==!0)return;g(!0);const c=v.valgteBarn===P.SØKNAD_GJELDER_NYTT_BARN?void 0:A.find(p=>p.id===v.valgteBarn),M=c!==void 0&&!!c.kanSøkeOmEndring;let B;c!==void 0&&(B=$e(c,I),E(f.BARN_FRA_NESTE_SAK,B));const R=M&&c.sak!==void 0?n.find(p=>{var j;return p.saksnummer===((j=c.sak)==null?void 0:j.saksnummer)}):void 0,re=B!==void 0?B.startdatoFørsteStønadsperiode:void 0,Y=M&&R,w=c!==void 0&&c.sak!==void 0&&c.kanSøkeOmEndring===!1,se=!Y&&!w&&c!==void 0;let G=H.SØKERSITUASJON,C=!1;if(Y){const p=ge(R,re,c.fødselsdatoer);G=H.UTTAKSPLAN;const j=ve(a.søker,p,F,R.annenPart,c);h(j,p)}else if(w){const p=ue(c,F,a.søker.barn,a.søker.fnr);h(p)}else if(se){const p=pe(c);h(p)}else C=!0;return r(v.harForståttRettigheterOgPlikter),l(M),i(C),U.goToNextStep(G)},K=ie({defaultValues:{harForståttRettigheterOgPlikter:d}}),V=K.watch("valgteBarn"),q=V===P.SØKNAD_GJELDER_NYTT_BARN?void 0:A.find(v=>v.id===V),ae=q!==void 0&&q.kanSøkeOmEndring===!0?F.formatMessage({id:"velkommen.endreSøknad"}):F.formatMessage({id:"velkommen.begynnMedSøknad"});return s.jsx(me,{formMethods:K,onSubmit:ne,children:s.jsxs(T,{gap:"10",children:[s.jsx(Ee,{locale:t,availableLocales:["nb","nn"],toggleLanguage:e}),s.jsx(Be,{children:s.jsxs(T,{gap:"8",children:[s.jsx(y,{justify:"center",children:s.jsx(ce,{size:"xlarge",children:s.jsx(k,{id:"velkommen.tittel"})})}),s.jsx(je,{poster:!0,children:s.jsxs(T,{gap:"2",children:[s.jsx(k,{id:"velkommen.guidepanel.del1"}),s.jsx(k,{id:"velkommen.guidepanel.del2",values:{a:v=>s.jsx("a",{className:"lenke",rel:"noopener noreferrer",href:ke.foreldrepenger,children:v})}})]})}),s.jsx(ee,{selectableBarn:I}),s.jsx(Te,{variant:"info",children:s.jsx(k,{id:"velkommen.lagring.info"})}),s.jsx(fe,{name:"harForståttRettigheterOgPlikter",label:F.formatMessage({id:"velkommen.samtykke"}),validate:[v=>v!==!0?F.formatMessage({id:"valideringsfeil.velkommen.harForståttRettigheterOgPlikter.påkrevd"}):null],children:s.jsx(T,{gap:"5",children:s.jsxs(y,{gap:"1",children:[s.jsx(J,{children:s.jsx(k,{id:"velkommen.samtykkeIntro.del1"})}),s.jsx(xe,{})]})})}),s.jsx(y,{justify:"center",children:s.jsx(Le,{type:"submit",variant:"primary",disabled:o,loading:o,children:ae})}),s.jsx(y,{justify:"center",children:s.jsx(J,{children:s.jsx("a",{className:"lenke",href:"#",onClick:v=>{v.preventDefault(),b(!0)},children:s.jsx(k,{id:"velkommen.lesMerOmPersonopplysninger"})})})}),s.jsx(Pe,{isOpen:O,onRequestClose:()=>b(!1)})]})})]})})};ze.__docgenInfo={description:"",methods:[],displayName:"Forside"};export{ze as F};
