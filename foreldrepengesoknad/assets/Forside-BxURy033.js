import{j as d}from"./jsx-runtime-CLpGMVip.js";import{b as R,C as u}from"./FpDataContext-DWIUkGg8.js";import{e as Y,a as C,S as x}from"./useFpNavigator-BYMqweuH.js";import{r as $}from"./index-DI2V0i71.js";import{b as J,u as z,R as W,f as Q}from"./ErrorSummaryHookForm-5kw4kaVD.js";import{u as _,M as y,H as X,a as Z}from"./Link-BKbcfhYA.js";import{m as ee,l as ne,a as re,b as ae}from"./eksisterendeSakUtils-OjPIxmA5.js";import{d as m,e as L,l as te}from"./dates-AkG-ZPn6.js";import{i as se,R as P,F as de,U as ie,G as le,L as oe,C as me,H as ue,A as fe}from"./Uttaksplan-BXHm6hRO.js";import{b as ge,c as ke,d as ve,t as ce,e as w,I as S,h as pe,i as I,j as Se,k as q,s as ye}from"./barnUtils-B38-HG2L.js";import{D as he}from"./DinePlikter-CFr91-uG.js";import{g as M}from"./guid-CsArkN6i.js";import{D as Fe}from"./DinePersonopplysningerModal-CjHPoX9a.js";import{V as A,H as O,B as De}from"./VStack-0uPSX4Ae.js";const je=()=>{const n=R();return{oppdaterSøknadIState:(e,t)=>{n(u.SØKERSITUASJON,e.søkersituasjon),n(u.OM_BARNET,e.barn),n(u.ANNEN_FORELDER,e.annenForelder),n(u.ARBEIDSFORHOLD_OG_INNTEKT,e.arbeidsforholdOgInntekt),n(u.FRILANS,e.frilans),n(u.EGEN_NÆRING,e.egenNæring),n(u.ANDRE_INNTEKTSKILDER,e.andreInntektskilder),n(u.UTENLANDSOPPHOLD,e.utenlandsopphold),n(u.UTENLANDSOPPHOLD_TIDLIGERE,e.utenlandsoppholdSiste12Mnd),n(u.UTENLANDSOPPHOLD_SENERE,e.utenlandsoppholdNeste12Mnd),n(u.PERIODE_MED_FORELDREPENGER,e.dekningsgrad),n(u.UTTAKSPLAN,e.uttaksplan),n(u.UTTAKSPLAN_METADATA,{ønskerJustertUttakVedFødsel:e.ønskerJustertUttakVedFødsel}),t&&n(u.EKSISTERENDE_SAK,t)}}};var g=(n=>(n.FØDT="født",n.UFØDT="ufødt",n.ADOPTERT="adoptert",n.IKKE_UTFYLT="ikkeUtfylt",n))(g||{});const Te=(n,r)=>n.map(e=>{const t=e.sak!==void 0?U(e.sak.åpenBehandling===void 0,r):void 0,i=e.sak!==void 0?r.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"";return d.jsx(P,{value:e.id,description:e.sak!==void 0?`${i}, ${t}`:i,children:d.jsx(y,{id:"velkommen.barnVelger.ufødtBarn",values:{antallBarnTekst:ge(e.antallBarn,r),termin:m(e.termindato).format(L),b:a=>d.jsx("b",{children:a})}})},e.id)}),U=(n,r)=>n?r.formatMessage({id:"velkommen.sak.status.ferdigBehandlet"}):r.formatMessage({id:"velkommen.sak.status.underBehandling"}),Ee=(n,r)=>n.map(e=>{const t=ke(e.fornavn,e.fødselsdatoer,e.omsorgsovertagelse,e.alleBarnaLever,e.antallBarn,r),i=ve(e.fødselsdatoer),a=e.type===g.FØDT||e.type===g.IKKE_UTFYLT?i:m(e.omsorgsovertagelse).format(L),l=e.type===g.FØDT||e.type===g.IKKE_UTFYLT?r.formatMessage({id:"velkommen.barnVelger.født"}):r.formatMessage({id:"velkommen.barnVelger.adopsjon"}),o=e.sak!==void 0?r.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"",p=e.sak!==void 0?U(e.sak.åpenBehandling===void 0,r):void 0;return d.jsx(P,{value:e.id,description:p?`${o}, ${p}`:o,children:d.jsx("b",{children:e.alleBarnaLever?`${t} ${l} ${a}`:t})},e.id)}),K=({selectableBarn:n})=>{const r=_();if(n.length===0)return null;const e=n.filter(a=>a.type===g.UFØDT),t=n.filter(a=>a.type!==g.UFØDT);let i=[];return t.length>0&&(i=i.concat(Ee(t,r))),e.length>0&&(i=i.concat(Te(e,r))),d.jsx(J,{name:"valgteBarn",label:d.jsx(y,{id:"velkommen.intro.harSaker.barnVelger.label"}),validate:[se(r.formatMessage({id:"steg.footer.spørsmålMåBesvares"}))],children:i.concat(d.jsx(P,{value:"søknad_gjeder_nytt_barn",description:r.formatMessage({id:"velkommen.intro.harSaker.barnVelger.info"}),children:d.jsx(y,{id:"omBarnet.gjelderAnnetBarn",values:{b:a=>d.jsx("b",{children:a})}})},"søknad_gjeder_nytt_barn"))})};K.__docgenInfo={description:"",methods:[],displayName:"BarnVelger",props:{selectableBarn:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    id: string;
    type: ValgtBarnType;
    antallBarn: number;
    sortableDato: Date;
    fnr?: string[];
    termindato?: Date;
    fødselsdatoer?: Date[];
    omsorgsovertagelse?: Date;
    fornavn?: string[];
    kanSøkeOmEndring?: boolean;
    sak?: Sak;
    annenForelder?: RegistrertAnnenForelder;
    familiehendelsesdato?: Date;
    startdatoFørsteStønadsperiode?: Date;
    alleBarnaLever: boolean;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"type",value:{name:"ValgtBarnType",required:!0}},{key:"antallBarn",value:{name:"number",required:!0}},{key:"sortableDato",value:{name:"Date",required:!0}},{key:"fnr",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"termindato",value:{name:"Date",required:!1}},{key:"fødselsdatoer",value:{name:"Array",elements:[{name:"Date"}],raw:"Date[]",required:!1}},{key:"omsorgsovertagelse",value:{name:"Date",required:!1}},{key:"fornavn",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"kanSøkeOmEndring",value:{name:"boolean",required:!1}},{key:"sak",value:{name:"Sak",required:!1}},{key:"annenForelder",value:{name:"Omit",elements:[{name:"PersonBase"},{name:"union",raw:"'kjønn' | 'fødselsdato'",elements:[{name:"literal",value:"'kjønn'"},{name:"literal",value:"'fødselsdato'"}]}],raw:"Omit<PersonBase, 'kjønn' | 'fødselsdato'>",required:!1}},{key:"familiehendelsesdato",value:{name:"Date",required:!1}},{key:"startdatoFørsteStønadsperiode",value:{name:"Date",required:!1}},{key:"alleBarnaLever",value:{name:"boolean",required:!0}}]}}],raw:"ValgtBarn[]"},description:""}}};m.extend(de);m.extend(ce);const Be=(n,r,e)=>n?g.ADOPTERT:r.fødselsdato!==void 0||e&&e.length>0?g.FØDT:g.UFØDT,be=(n,r)=>{const e=n.familiehendelse.termindato;if(le(e)){const t=m(e).subtract(17,"week"),i=m(e).add(6,"week");return r.filter(a=>m(a.fødselsdato).isBetween(t,i,"day","[]"))}return[]},Ae=(n,r)=>{const e=S(n.familiehendelse.fødselsdato),t=n.barn!==void 0?n.barn.map(l=>l.fnr).flat():[],i=r.filter(l=>t.includes(l.fnr)),a=e!==void 0?r.filter(l=>w(l.fødselsdato,e)&&!i.find(o=>o.fnr===l.fnr)):[];return i.concat(a)},qe=(n,r)=>{let e;(n.barn||n.familiehendelse.fødselsdato)&&(e=Ae(n,r)),n.familiehendelse.termindato&&!n.familiehendelse.fødselsdato&&!n.barn&&(e=be(n,r));const t=S(Se(n.familiehendelse.termindato,n.familiehendelse.fødselsdato,n.familiehendelse.omsorgsovertakelse)),i=Be(n.gjelderAdopsjon,n.familiehendelse,e),a=S(n.familiehendelse.fødselsdato);let l;return e&&e.length>0?l=e.map(o=>m.utc(o.fødselsdato).toDate()):a!==void 0&&(l=Array(n.familiehendelse.antallBarn).fill(a)),{id:M(),type:i,antallBarn:n.familiehendelse.antallBarn,termindato:S(n.familiehendelse.termindato),omsorgsovertagelse:S(n.familiehendelse.omsorgsovertakelse),kanSøkeOmEndring:n.kanSøkeOmEndring,sak:n,fødselsdatoer:l,familiehendelsesdato:t,sortableDato:S(n.familiehendelse.termindato),startdatoFørsteStønadsperiode:n.gjeldendeVedtak!==void 0&&n.gjeldendeVedtak.perioder.length>0?ie(S(n.gjeldendeVedtak.perioder[0].fom)).denneEllerNeste():void 0,fornavn:e!==void 0&&e.length>0?e.filter(o=>o.fornavn!==void 0&&o.fornavn.trim()!=="").map(o=>[o.fornavn,o.mellomnavn!==void 0?o.mellomnavn:""].join(" ")):void 0,fnr:e!==void 0&&e.length>0?e.filter(o=>o.fnr!==void 0).map(o=>o.fnr):void 0,alleBarnaLever:e!==void 0&&e.length>0?e.every(o=>q(o)):!1}},Me=(n,r)=>{const e=n.mellomnavn!==void 0?[n.fornavn,n.mellomnavn].join(" "):n.fornavn;return{id:M(),type:g.IKKE_UTFYLT,antallBarn:1,fødselsdatoer:[m.utc(n.fødselsdato).toDate()],fornavn:e!==void 0?[e]:void 0,fnr:[n.fnr],sortableDato:m.utc(n.fødselsdato).toDate(),alleBarnaLever:q(n),annenForelder:r}},Ne=(n,r,e)=>{const t=[n].concat(r).sort(ye);if(!(t.find(a=>!q(a)&&I(a))||t.length==0))return{id:M(),type:g.IKKE_UTFYLT,antallBarn:t.length,fødselsdatoer:t.map(a=>m.utc(a.fødselsdato).toDate()),fornavn:t.map(a=>[a.fornavn,a.mellomnavn!==void 0?a.mellomnavn:""].join(" ")),fnr:t.map(a=>a.fnr),sortableDato:m.utc(t[0].fødselsdato).toDate(),alleBarnaLever:t.every(a=>q(a)),annenForelder:e}},xe=(n,r)=>n.filter(e=>e.barn!==void 0&&e.barn.length>0||e.familiehendelse.termindato!==void 0||e.familiehendelse.fødselsdato!==void 0||e.familiehendelse.omsorgsovertakelse!==void 0).map(e=>qe(e,r)),Oe=(n,r,e)=>{const t=n.filter(s=>!e.find(f=>w(s.fødselsdato,S(f.familiehendelse.fødselsdato)))),i="tempFnr",a=t.map(s=>s.fnr===void 0?{...s,fnr:i+M().toString()}:s),l=r.map(s=>s.fnr).flat(),o=r.filter(s=>s.fødselsdatoer!==void 0&&s.fødselsdatoer.length>0).map(s=>s.fødselsdatoer).flat(),p=[];return a.filter(s=>!(s.dødsdato!==void 0&&o.find(f=>m(f).isSame(m.utc(s.fødselsdato),"day")))).forEach(s=>{if(!l.includes(s.fnr)&&!Y(s.fødselsdato)){const f=pe(s.fnr,s.fødselsdato,a),F=s.annenForelder!==void 0?{fnr:s.annenForelder.fnr,fornavn:s.annenForelder.fornavn,mellomnavn:s.annenForelder.mellomnavn,etternavn:s.annenForelder.etternavn}:void 0;if(l.push(s.fnr),f.length===0){if(!I(s)){const D=Me(s,F);p.push(D)}}else{const D=Ne(s,f,F);f.forEach(T=>{l.push(T.fnr)}),D!==void 0&&p.push(D)}}}),p.map(s=>s.fnr&&s.fnr.length>0?{...s,fnr:s.fnr.filter(f=>f&&!f.startsWith(i))}:s)},Pe=(n,r)=>{const e=n.filter(l=>!l.sakAvsluttet),t=n.filter(l=>l.sakAvsluttet),i=xe(e,r),a=Oe(r,i,t);return i.concat(a)},Re=(n,r)=>{var i,a;const e=r.filter(l=>l.sak!==void 0&&l.id!==n.id&&l.familiehendelsesdato!==void 0&&m(l.familiehendelsesdato).isAfter(n.familiehendelsesdato,"day"));e.sort(V);const t=e[e.length-1];if(t!==void 0)return{familiehendelsesdato:t.familiehendelsesdato,startdatoFørsteStønadsperiode:t.startdatoFørsteStønadsperiode,fnr:t.fnr,annenForelderFnr:(a=(i=t.sak)==null?void 0:i.annenPart)==null?void 0:a.fnr}},V=(n,r)=>m(n.sortableDato).isBefore(r.sortableDato,"d")?1:m(n.sortableDato).isAfter(r.sortableDato,"d")?-1:0,_e=({locale:n,saker:r,onChangeLocale:e,harGodkjentVilkår:t,søkerInfo:i,setHarGodkjentVilkår:a,setErEndringssøknad:l,setSøknadGjelderNyttBarn:o,mellomlagreSøknadOgNaviger:p})=>{const h=_(),j=C(i.arbeidsforhold,p),s=R(),{oppdaterSøknadIState:f}=je(),F=$.useMemo(()=>[...Pe(r,i.søker.barn)].sort(V),[r,i.søker.barn]),D=c=>{if(!c.harForståttRettigheterOgPlikter){console.error("harForståttRettigheterOgPlikter er falsy til tross for at formet skal ha validert den",c.harForståttRettigheterOgPlikter);return}a(!0);const k=F.find(v=>v.id===c.valgteBarn);if(k===void 0)return l(!1),o(!0),j.goToNextStep(x.SØKERSITUASJON);const E=Re(k,F);s(u.BARN_FRA_NESTE_SAK,E);const B=!!k.kanSøkeOmEndring?r.find(v=>{var b;return v.saksnummer===((b=k.sak)==null?void 0:b.saksnummer)}):void 0;if(B){const v=ee(B,E==null?void 0:E.startdatoFørsteStønadsperiode,k.fødselsdatoer),b=ne(i.søker,v,h,B.annenPart,k);return f(b,v),l(!0),o(!1),j.goToNextStep(x.UTTAKSPLAN)}if(k.sak!==void 0&&k.kanSøkeOmEndring===!1){const v=re({...k,sak:k.sak},h,i.søker.barn,i.søker.fnr);f(v)}if(!B){const v=ae(k);f(v)}return l(!1),o(!1),j.goToNextStep(x.SØKERSITUASJON)},T=z({defaultValues:{harForståttRettigheterOgPlikter:t}}),G=T.watch("valgteBarn"),N=F.find(c=>c.id===G),H=(N==null?void 0:N.kanSøkeOmEndring)===!0?h.formatMessage({id:"velkommen.endreSøknad"}):h.formatMessage({id:"velkommen.begynnMedSøknad"});return d.jsx(W,{formMethods:T,onSubmit:D,children:d.jsxs(A,{gap:"10",children:[d.jsx(oe,{locale:n,availableLocales:["nb","nn"],toggleLanguage:e}),d.jsx(me,{children:d.jsxs(A,{gap:"8",children:[d.jsx(O,{justify:"center",children:d.jsx(X,{size:"xlarge",children:d.jsx(y,{id:"velkommen.tittel"})})}),d.jsx(ue,{poster:!0,children:d.jsxs(A,{gap:"2",children:[d.jsx(y,{id:"velkommen.guidepanel.del1"}),d.jsx(y,{id:"velkommen.guidepanel.del2",values:{a:c=>d.jsx("a",{className:"lenke",rel:"noopener noreferrer",href:te.foreldrepenger,children:c})}})]})}),d.jsx(K,{selectableBarn:F}),d.jsx(fe,{variant:"info",children:d.jsx(y,{id:"velkommen.lagring.info"})}),d.jsx(Q,{name:"harForståttRettigheterOgPlikter",label:h.formatMessage({id:"velkommen.samtykke"}),validate:[c=>c!==!0?h.formatMessage({id:"valideringsfeil.velkommen.harForståttRettigheterOgPlikter.påkrevd"}):null],children:d.jsx(A,{gap:"5",children:d.jsxs(O,{gap:"1",children:[d.jsx(Z,{children:d.jsx(y,{id:"velkommen.samtykkeIntro.del1"})}),d.jsx(he,{})]})})}),d.jsx(O,{justify:"center",children:d.jsx(De,{type:"submit",variant:"primary",children:H})}),d.jsx(Fe,{})]})})]})})};_e.__docgenInfo={description:"",methods:[],displayName:"Forside",props:{onChangeLocale:{required:!0,tsType:{name:"signature",type:"function",raw:"(locale: LocaleNo) => void",signature:{arguments:[{type:{name:"union",raw:"'nb' | 'nn'",elements:[{name:"literal",value:"'nb'"},{name:"literal",value:"'nn'"}]},name:"locale"}],return:{name:"void"}}},description:""},locale:{required:!0,tsType:{name:"union",raw:"'nb' | 'nn'",elements:[{name:"literal",value:"'nb'"},{name:"literal",value:"'nn'"}]},description:""},saker:{required:!0,tsType:{name:"Array",elements:[{name:"Sak"}],raw:"Sak[]"},description:""},harGodkjentVilkår:{required:!0,tsType:{name:"boolean"},description:""},søkerInfo:{required:!0,tsType:{name:"signature",type:"object",raw:`{
    søker: Søker;
    arbeidsforhold: Arbeidsforhold[];
}`,signature:{properties:[{key:"søker",value:{name:"intersection",raw:`{
    fødselsdato: string;
    kjønn: Kjønn;
    bankkonto?: Bankkonto;
    sivilstand?: Sivilstand;
    barn: SøkerBarn[];
} & PersonBase`,elements:[{name:"signature",type:"object",raw:`{
    fødselsdato: string;
    kjønn: Kjønn;
    bankkonto?: Bankkonto;
    sivilstand?: Sivilstand;
    barn: SøkerBarn[];
}`,signature:{properties:[{key:"fødselsdato",value:{name:"string",required:!0}},{key:"kjønn",value:{name:"union",raw:"'M' | 'K'",elements:[{name:"literal",value:"'M'"},{name:"literal",value:"'K'"}],required:!0}},{key:"bankkonto",value:{name:"Bankkonto",required:!1}},{key:"sivilstand",value:{name:"Sivilstand",required:!1}},{key:"barn",value:{name:"Array",elements:[{name:"intersection",raw:`{
    kjønn: Kjønn;
    fødselsdato: string;
    dødsdato?: string;
    annenForelder?: SøkerAnnenForelder;
} & PersonBase`,elements:[{name:"signature",type:"object",raw:`{
    kjønn: Kjønn;
    fødselsdato: string;
    dødsdato?: string;
    annenForelder?: SøkerAnnenForelder;
}`,signature:{properties:[{key:"kjønn",value:{name:"union",raw:"'M' | 'K'",elements:[{name:"literal",value:"'M'"},{name:"literal",value:"'K'"}],required:!0}},{key:"fødselsdato",value:{name:"string",required:!0}},{key:"dødsdato",value:{name:"string",required:!1}},{key:"annenForelder",value:{name:"intersection",raw:`{
    fødselsdato?: string;
} & PersonBase`,elements:[{name:"signature",type:"object",raw:`{
    fødselsdato?: string;
}`,signature:{properties:[{key:"fødselsdato",value:{name:"string",required:!1}}]}},{name:"signature",type:"object",raw:`{
    fnr: string;
    fornavn: string;
    mellomnavn?: string;
    etternavn: string;
}`,signature:{properties:[{key:"fnr",value:{name:"string",required:!0}},{key:"fornavn",value:{name:"string",required:!0}},{key:"mellomnavn",value:{name:"string",required:!1}},{key:"etternavn",value:{name:"string",required:!0}}]}}],required:!1}}]}},{name:"signature",type:"object",raw:`{
    fnr: string;
    fornavn: string;
    mellomnavn?: string;
    etternavn: string;
}`,signature:{properties:[{key:"fnr",value:{name:"string",required:!0}},{key:"fornavn",value:{name:"string",required:!0}},{key:"mellomnavn",value:{name:"string",required:!1}},{key:"etternavn",value:{name:"string",required:!0}}]}}]}],raw:"SøkerBarn[]",required:!0}}]}},{name:"signature",type:"object",raw:`{
    fnr: string;
    fornavn: string;
    mellomnavn?: string;
    etternavn: string;
}`,signature:{properties:[{key:"fnr",value:{name:"string",required:!0}},{key:"fornavn",value:{name:"string",required:!0}},{key:"mellomnavn",value:{name:"string",required:!1}},{key:"etternavn",value:{name:"string",required:!0}}]}}],required:!0}},{key:"arbeidsforhold",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    arbeidsgiverNavn: string;
    arbeidsgiverId: string;
    arbeidsgiverIdType: string;
    fom: string;
    tom?: string;
    stillingsprosent: number;
}`,signature:{properties:[{key:"arbeidsgiverNavn",value:{name:"string",required:!0}},{key:"arbeidsgiverId",value:{name:"string",required:!0}},{key:"arbeidsgiverIdType",value:{name:"string",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!1}},{key:"stillingsprosent",value:{name:"number",required:!0}}]}}],raw:"Arbeidsforhold[]",required:!0}}]}},description:""},setHarGodkjentVilkår:{required:!0,tsType:{name:"signature",type:"function",raw:"(harGodkjentVilkår: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"harGodkjentVilkår"}],return:{name:"void"}}},description:""},setErEndringssøknad:{required:!0,tsType:{name:"signature",type:"function",raw:"(erEndringssøknad: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"erEndringssøknad"}],return:{name:"void"}}},description:""},setSøknadGjelderNyttBarn:{required:!0,tsType:{name:"signature",type:"function",raw:"(søknadGjelderNyttBarn: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"søknadGjelderNyttBarn"}],return:{name:"void"}}},description:""},mellomlagreSøknadOgNaviger:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""}}};export{_e as F};
