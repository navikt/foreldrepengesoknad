import{U as p,d as a,T as U,C as h,D as y,g as v,v as _,E as H}from"./Tidsperioden-2d_zadTE.js";import"./jsx-runtime-DtaoT6pD.js";import{b as E,f as L,j as J,e as R,l as Q,h as N,P as M,S as F,c as X,i as Y,m as V}from"./Perioden-RLDz9uWW.js";import"./index-rOAPTY5O.js";import"./index-OjgoNOWw.js";import{P as T,s as j}from"./Periodene-FeW126ra.js";import"./_baseToString-c7_W74Ua.js";import"./_createSet-hSZRoo1M.js";var Z=(t=>(t.arbeidstaker="ARBEIDSTAKER",t.frilans="FRILANS",t.selvstendignæringsdrivende="SELVSTENDIG_NÆRINGSDRIVENDE",t))(Z||{}),C=(t=>(t.fridag="fridag",t.avslåttPeriode="avslåttPeriode",t))(C||{});const $=(t,e,o,n)=>{if(t.length<=1)return t;const d=[];let r={...t[0]};return t.forEach((s,c)=>{if(c!==0){if(r===void 0){r=s;return}if(N(r).erLik(s,!1,!0)&&N(r).erSammenhengende(s)){if(n&&E(s)&&s.ønskerSamtidigUttak&&E(r)&&r.ønskerSamtidigUttak){const l=T(n).finnOverlappendePerioder(r),u=T(n).finnOverlappendePerioder(s);if(u.length===0&&l.length>0||u.length>0&&l.length===0){d.push(r),r=s;return}}if(a(r.tidsperiode.tom).isBefore(e,"day")&&a(s.tidsperiode.tom).isSameOrAfter(p(e).denneEllerNeste())||o!==void 0&&a(r.tidsperiode.tom).isBefore(o,"day")&&a(s.tidsperiode.fom).isSameOrAfter(p(o).denneEllerNeste(),"day")){d.push(r),r=s;return}const i={fom:r.tidsperiode.fom,tom:s.tidsperiode.tom};r.tidsperiode={...i};return}else d.push(r);r=s}}),d.push(r),d},I=(t,e)=>e!==void 0&&H(t.tidsperiode,e)?tt(t,e):[t],O=(t,e,o,n,d,r,s,c=C.fridag)=>{if(h(o)){const u=p(o).denneEllerNeste(),m=p(u).leggTil(30),f=U(t).erInnenforFørsteSeksUker(o),g=a(t.fom).isBefore(m,"day")&&!n&&(d&&h(o)||r&&y(o));if(e&&!g)return I(A(t,c),s);if(a(t.fom).isBefore(o,"day"))return I(D(t),s);if(f&&!n){if(a(t.tom).isBefore(m,"day"))return d&&h(o)||r&&y(o)?[D(t)]:[A(t,c)];const P=U({fom:t.fom,tom:m}).getAntallUttaksdager()-2,k=U(t).getAntallUttaksdager()-P,S={fom:t.fom,tom:p(m).leggTil(-1)},K={fom:m,tom:p(m).leggTil(k-2)};if(d&&h(o)||r&&y(o)){if(r&&!d)return[D(t)];const x=D(S),z=A(K,c);return[x,z]}const q=A(S,c),w=D(K);return[q,w]}return I(D(t),s)}return I(A(t,c),s)},A=(t,e)=>({id:v(),type:M.Hull,tidsperiode:t,årsak:e}),D=t=>({id:v(),type:M.PeriodeUtenUttak,tidsperiode:t}),B=(t,e)=>{const o={fom:p(t.tom).neste(),tom:p(e.fom).forrige()},n=U(o).getAntallUttaksdager();if(_(o)&&n>0)return o},at=t=>t.reduce((e,o,n)=>n===0&&L(o)?e:n===t.length-1?(R(o)||L(o)||e.push(o),e):(e.push(o),e),[]),mt=(t,e,o,n,d,r,s)=>t.length===0?t:t.reduce((i,l,u)=>{if(u===0&&r){const P=p(o).denneEllerNeste();if(a(P).isBefore(l.tidsperiode.fom)){const k={fom:P,tom:p(l.tidsperiode.fom).forrige()};U(k).getAntallUttaksdager()>0&&i.push(...O(k,e,o,n,d,r,s))}}if(i.push(l),u===t.length-1)return i;const m=t[u+1],f={fom:p(l.tidsperiode.tom).neste(),tom:p(m.tidsperiode.fom).forrige()};return a(f.tom).isBefore(f.fom,"day")||!r&&a(f.tom).isBefore(o,"day")||U(f).getAntallUttaksdager()>0&&i.push(...O(f,e,o,n,d,r,s)),i},[]),G=(t,e)=>{const o=e.filter(d=>U(t.tidsperiode).inneholderDato(d.dato)),n=[];return o.length===2?[t]:(o.forEach((d,r)=>{if(r===0){n.push({...t,tidsperiode:{fom:d.dato,tom:void 0}});return}n[r-1].tidsperiode.tom=d.erFom?p(d.dato).forrige():d.dato,r<o.length-1&&n.push({...t,id:v(),tidsperiode:{fom:d.erFom?d.dato:p(d.dato).neste(),tom:void 0}})}),n.filter(d=>_(d.tidsperiode)))},b=(t,e)=>{const o=t.filter(i=>_(i.tidsperiode)).reduce((i,l)=>(i.push({dato:l.tidsperiode.fom,erFom:!0}),i.push({dato:l.tidsperiode.tom,erFom:!1}),i),[]),n=e.reduce((i,l)=>(i.push({dato:l.tidsperiode.fom,erFom:!0}),i.push({dato:l.tidsperiode.tom,erFom:!1}),i),[]),r=o.concat(n).sort((i,l)=>{if(i.dato.getTime()-l.dato.getTime()===0){if(!i.erFom)return 1;if(!l.erFom)return-1}return i.dato.getTime()-l.dato.getTime()}).filter((i,l,u)=>u.findIndex(m=>m.dato.getTime()===i.dato.getTime()&&m.erFom===i.erFom)===l),s=[],c=[];return t.forEach(i=>{const l=G(i,r);s.push(...l)}),e.forEach(i=>{const l=G(i,r);c.push(...l)}),{normaliserteEgnePerioder:s,normaliserteAnnenPartsPerioder:c}},ut=(t,e,o,n,d=!1)=>{if(e.length===0)return t;if(t.length===0)return e;const{normaliserteEgnePerioder:r,normaliserteAnnenPartsPerioder:s}=b(t,e),c=r.reduce((f,g)=>{const P=T(s).finnOverlappendePerioder(g);if(P.length===0)return E(g)&&g.ønskerSamtidigUttak&&d?(f.push({...g,ønskerSamtidigUttak:!1}),f):(f.push(g),f);if(L(g)||J(g)||R(g)){const k=P[0];return f.push({...k,visPeriodeIPlan:!0}),f}if(E(g)&&g.ønskerSamtidigUttak){const k=P[0];return f.push(g),Q(k)||f.push({...k,visPeriodeIPlan:!1,ønskerSamtidigUttak:!0}),f}else return f.push(g),f},[]);c.sort(j);const i=t[0].tidsperiode.fom,l=s.filter(f=>a(f.tidsperiode.tom).isBefore(i,"day")),u=t[t.length-1].tidsperiode.tom,m=s.filter(f=>a(f.tidsperiode.fom).isAfter(u,"day"));return $([...l,...c,...m],o,n,e)},W=(t,e)=>{const o=U(t.tidsperiode).getAntallUttaksdager(),n={...t,tidsperiode:{fom:t.tidsperiode.fom,tom:p(e.tidsperiode.fom).forrige()}},d=U(n.tidsperiode).getAntallUttaksdager(),r=o-d,s=p(e.tidsperiode.tom).neste();if(V(t)){const c={...t,id:v(),tidsperiode:{fom:e.tidsperiode.fom,tom:t.tidsperiode.tom}};return[n,e,c]}else{const c={...t,id:v(),tidsperiode:{fom:s,tom:p(s).leggTil(r-1)}};return[n,e,c]}},tt=(t,e)=>{const o={...t,tidsperiode:{fom:t.tidsperiode.fom,tom:p(e).forrige()}},n={...t,id:v(),tidsperiode:{fom:p(o.tidsperiode.tom).neste(),tom:t.tidsperiode.tom}};return[o,n]},gt=(t,e)=>{const o={...t,konto:t.konto==F.Foreldrepenger?F.AktivitetsfriKvote:t.konto,morsAktivitetIPerioden:t.konto==F.Foreldrepenger?void 0:t.morsAktivitetIPerioden,erMorForSyk:t.konto==F.Foreldrepenger?void 0:t.erMorForSyk,tidsperiode:{fom:t.tidsperiode.fom,tom:p(e).forrige()}},n={...t,id:v(),tidsperiode:{fom:p(o.tidsperiode.tom).neste(),tom:t.tidsperiode.tom}};return[o,n]},et=(t,e)=>{if(T([t]).finnOverlappendePerioder(e).length>0){const o=[a(t.tidsperiode.fom),a(t.tidsperiode.tom),a(e.tidsperiode.fom),a(e.tidsperiode.tom)],n=a.min(o),d=a.max(o),r=o.filter(s=>s!==n&&s!==d);return U({fom:a.min(r).toDate(),tom:a.max(r).toDate()}).getAntallUttaksdager()}return 0},ct=({perioder:t,nyPeriode:e,familiehendelsesdato:o,harAktivitetskravIPeriodeUtenUttak:n,erAdopsjon:d,bareFarHarRett:r,erFarEllerMedmor:s,førsteUttaksdagNesteBarnsSak:c})=>{if(t.length===0)return[e];const i=e.tidsperiode.fom,l=e.tidsperiode.tom;if(a(i).isBefore(o,"day")&&a(l).isSameOrAfter(o,"day"))return[...t];const u=t.find(m=>U(m.tidsperiode).inneholderDato(i));if(u){if(X(u)||Y(u))return[...t];const m=T(t).finnAlleForegåendePerioder(u),f=T(t).finnAllePåfølgendePerioder(u),g=U(e.tidsperiode).getAntallUttaksdager();if(a(u.tidsperiode.fom).isSame(i))return[...m,e,...T([u,...f]).forskyvPerioder(g)];const P=W(u,e);return V(u)?[...m,P[0],P[1],...T([P[2],...f]).forskyvPerioder(g)]:[...m,...P,...T(f).forskyvPerioder(g)]}else{const m=t[0],f=t[t.length-1],g=a(e.tidsperiode.fom),P=a(e.tidsperiode.tom);if(g.isBefore(m.tidsperiode.fom,"day")){const k=B(e.tidsperiode,m.tidsperiode);if(P.isSameOrAfter(m.tidsperiode.fom,"day")){if(g.isBefore(o,"day"))return[...t];const S=et(m,e);return[e,...T(t).forskyvPerioder(S)]}return k?[e,...O(k,n,o,d,r,s,c),...t]:[e,...t]}else{const k=B(f.tidsperiode,e.tidsperiode);return k?[...t,...O(k,n,o,d,r,s,c),e]:[...t,e].sort(j)}}};export{Z as A,gt as a,tt as b,$ as c,at as d,mt as f,O as g,ct as l,b as n,ut as s};
