import{j as a}from"./jsx-runtime-DCY474Ph.js";import{b as $,C as u}from"./FpDataContext-jML7Xeq2.js";import{e as de,a as ie,S as C}from"./useFpNavigator-r0RGj3UR.js";import{r as P}from"./index-f9CH5uyH.js";import{b as le,c as x,u as oe,R as me,g as ue}from"./ErrorSummaryHookForm-D2QheYbh.js";import{u as z,M as v,H as fe,a as J}from"./Label-BPBaHb1Y.js";import{m as ge,o as ke,a as ce,b as pe}from"./eksisterendeSakUtils-BQPJNAcs.js";import{d as m,e as W,l as ve}from"./dates-B17XcA27.js";import{i as Se,G as ye,U as he,H as De,L as Fe,C as je,J as Be,E as Ee}from"./Uttaksplan-_1fVZ-rO.js";import{b as Te,c as be,d as Ae,t as Ne,e as Q,I as h,h as qe,i as X,j as _e,k as b,s as Me}from"./barnUtils-B8FipAJr.js";import{D as Pe}from"./DinePlikter-DQtfmNqD.js";import{g as A}from"./guid-CsArkN6i.js";import{D as Re}from"./DinePersonopplysningerModal-BUdeX7KO.js";import{V as E,H as T,B as xe}from"./VStack-DCKXGmgz.js";const Oe=()=>{const n=$();return{oppdaterSøknadIState:(e,d)=>{n(u.SØKERSITUASJON,e.søkersituasjon),n(u.OM_BARNET,e.barn),n(u.ANNEN_FORELDER,e.annenForelder),n(u.ARBEIDSFORHOLD_OG_INNTEKT,e.arbeidsforholdOgInntekt),n(u.FRILANS,e.frilans),n(u.EGEN_NÆRING,e.egenNæring),n(u.ANDRE_INNTEKTSKILDER,e.andreInntektskilder),n(u.UTENLANDSOPPHOLD,e.utenlandsopphold),n(u.UTENLANDSOPPHOLD_TIDLIGERE,e.utenlandsoppholdSiste12Mnd),n(u.UTENLANDSOPPHOLD_SENERE,e.utenlandsoppholdNeste12Mnd),n(u.PERIODE_MED_FORELDREPENGER,e.dekningsgrad),n(u.UTTAKSPLAN,e.uttaksplan),n(u.UTTAKSPLAN_METADATA,{ønskerJustertUttakVedFødsel:e.ønskerJustertUttakVedFødsel}),d&&n(u.EKSISTERENDE_SAK,d)}}};var c=(n=>(n.FØDT="født",n.UFØDT="ufødt",n.ADOPTERT="adoptert",n.IKKE_UTFYLT="ikkeUtfylt",n))(c||{}),R=(n=>(n.SØKNAD_GJELDER_NYTT_BARN="søknad_gjeder_nytt_barn",n))(R||{});const Le=(n,r)=>n.map(e=>{const d=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,r):void 0,i=e.sak!==void 0?r.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"";return a.jsx(x,{value:e.id,description:e.sak!==void 0?`${i}, ${d}`:i,children:a.jsx(v,{id:"velkommen.barnVelger.ufødtBarn",values:{antallBarnTekst:Te(e.antallBarn,r),termin:m(e.termindato).format(W),b:t=>a.jsx("b",{children:t})}})},e.id)}),Z=(n,r)=>n?r.formatMessage({id:"velkommen.sak.status.ferdigBehandlet"}):r.formatMessage({id:"velkommen.sak.status.underBehandling"}),we=(n,r)=>n.map(e=>{const d=be(e.fornavn,e.fødselsdatoer,e.omsorgsovertagelse,e.alleBarnaLever,e.antallBarn,r),i=Ae(e.fødselsdatoer),t=e.type===c.FØDT||e.type===c.IKKE_UTFYLT?i:m(e.omsorgsovertagelse).format(W),l=e.type===c.FØDT||e.type===c.IKKE_UTFYLT?r.formatMessage({id:"velkommen.barnVelger.født"}):r.formatMessage({id:"velkommen.barnVelger.adopsjon"}),o=e.sak!==void 0?r.formatMessage({id:"velkommen.barnVelger.saksnummer"},{saksnummer:e.sak.saksnummer}):"",S=e.sak!==void 0?Z(e.sak.åpenBehandling===void 0,r):void 0;return a.jsx(x,{value:e.id,description:S?`${o}, ${S}`:o,children:a.jsx("b",{children:e.alleBarnaLever?`${d} ${l} ${t}`:d})},e.id)}),ee=({selectableBarn:n})=>{const r=z();if(n.length===0)return null;const e=n.filter(t=>t.type===c.UFØDT),d=n.filter(t=>t.type!==c.UFØDT);let i=[];return d.length>0&&(i=i.concat(we(d,r))),e.length>0&&(i=i.concat(Le(e,r))),a.jsx(le,{name:"valgteBarn",label:a.jsx(v,{id:"velkommen.intro.harSaker.barnVelger.label"}),validate:[Se(r.formatMessage({id:"steg.footer.spørsmålMåBesvares"}))],children:i.concat(a.jsx(x,{value:"søknad_gjeder_nytt_barn",description:r.formatMessage({id:"velkommen.intro.harSaker.barnVelger.info"}),children:a.jsx(v,{id:"omBarnet.gjelderAnnetBarn",values:{b:t=>a.jsx("b",{children:t})}})},"søknad_gjeder_nytt_barn"))})};ee.__docgenInfo={description:"",methods:[],displayName:"BarnVelger",props:{selectableBarn:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    id: string;
    type: ValgtBarnType;
    antallBarn: number;
    sortableDato: Date;
    fnr?: string[];
    termindato?: Date;
    fødselsdatoer?: Date[];
    omsorgsovertagelse?: Date;
    fornavn?: string[];
    kanSøkeOmEndring?: boolean;
    sak?: Sak;
    annenForelder?: RegistrertAnnenForelder;
    familiehendelsesdato?: Date;
    startdatoFørsteStønadsperiode?: Date;
    alleBarnaLever: boolean;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"type",value:{name:"ValgtBarnType",required:!0}},{key:"antallBarn",value:{name:"number",required:!0}},{key:"sortableDato",value:{name:"Date",required:!0}},{key:"fnr",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"termindato",value:{name:"Date",required:!1}},{key:"fødselsdatoer",value:{name:"Array",elements:[{name:"Date"}],raw:"Date[]",required:!1}},{key:"omsorgsovertagelse",value:{name:"Date",required:!1}},{key:"fornavn",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"kanSøkeOmEndring",value:{name:"boolean",required:!1}},{key:"sak",value:{name:"Sak",required:!1}},{key:"annenForelder",value:{name:"Omit",elements:[{name:"PersonBase"},{name:"union",raw:"'kjønn' | 'fødselsdato'",elements:[{name:"literal",value:"'kjønn'"},{name:"literal",value:"'fødselsdato'"}]}],raw:"Omit<PersonBase, 'kjønn' | 'fødselsdato'>",required:!1}},{key:"familiehendelsesdato",value:{name:"Date",required:!1}},{key:"startdatoFørsteStønadsperiode",value:{name:"Date",required:!1}},{key:"alleBarnaLever",value:{name:"boolean",required:!0}}]}}],raw:"ValgtBarn[]"},description:""}}};m.extend(ye);m.extend(Ne);const Ie=(n,r,e)=>n?c.ADOPTERT:r.fødselsdato!==void 0||e&&e.length>0?c.FØDT:c.UFØDT,Ke=(n,r)=>{const e=n.familiehendelse.termindato;if(De(e)){const d=m(e).subtract(17,"week"),i=m(e).add(6,"week");return r.filter(t=>m(t.fødselsdato).isBetween(d,i,"day","[]"))}return[]},Ue=(n,r)=>{const e=h(n.familiehendelse.fødselsdato),d=n.barn!==void 0?n.barn.map(l=>l.fnr).flat():[],i=r.filter(l=>d.includes(l.fnr)),t=e!==void 0?r.filter(l=>Q(l.fødselsdato,e)&&!i.find(o=>o.fnr===l.fnr)):[];return i.concat(t)},Ve=(n,r)=>{let e;(n.barn||n.familiehendelse.fødselsdato)&&(e=Ue(n,r)),n.familiehendelse.termindato&&!n.familiehendelse.fødselsdato&&!n.barn&&(e=Ke(n,r));const d=h(_e(n.familiehendelse.termindato,n.familiehendelse.fødselsdato,n.familiehendelse.omsorgsovertakelse)),i=Ie(n.gjelderAdopsjon,n.familiehendelse,e),t=h(n.familiehendelse.fødselsdato);let l;return e&&e.length>0?l=e.map(o=>m.utc(o.fødselsdato).toDate()):t!==void 0&&(l=Array(n.familiehendelse.antallBarn).fill(t)),{id:A(),type:i,antallBarn:n.familiehendelse.antallBarn,termindato:h(n.familiehendelse.termindato),omsorgsovertagelse:h(n.familiehendelse.omsorgsovertakelse),kanSøkeOmEndring:n.kanSøkeOmEndring,sak:n,fødselsdatoer:l,familiehendelsesdato:d,sortableDato:h(n.familiehendelse.termindato),startdatoFørsteStønadsperiode:n.gjeldendeVedtak!==void 0&&n.gjeldendeVedtak.perioder.length>0?he(h(n.gjeldendeVedtak.perioder[0].fom)).denneEllerNeste():void 0,fornavn:e!==void 0&&e.length>0?e.filter(o=>o.fornavn!==void 0&&o.fornavn.trim()!=="").map(o=>[o.fornavn,o.mellomnavn!==void 0?o.mellomnavn:""].join(" ")):void 0,fnr:e!==void 0&&e.length>0?e.filter(o=>o.fnr!==void 0).map(o=>o.fnr):void 0,alleBarnaLever:e!==void 0&&e.length>0?e.every(o=>b(o)):!1}},Ge=(n,r)=>{const e=n.mellomnavn!==void 0?[n.fornavn,n.mellomnavn].join(" "):n.fornavn;return{id:A(),type:c.IKKE_UTFYLT,antallBarn:1,fødselsdatoer:[m.utc(n.fødselsdato).toDate()],fornavn:e!==void 0?[e]:void 0,fnr:[n.fnr],sortableDato:m.utc(n.fødselsdato).toDate(),alleBarnaLever:b(n),annenForelder:r}},Ye=(n,r,e)=>{const d=[n].concat(r).sort(Me);if(!(d.find(t=>!b(t)&&X(t))||d.length==0))return{id:A(),type:c.IKKE_UTFYLT,antallBarn:d.length,fødselsdatoer:d.map(t=>m.utc(t.fødselsdato).toDate()),fornavn:d.map(t=>[t.fornavn,t.mellomnavn!==void 0?t.mellomnavn:""].join(" ")),fnr:d.map(t=>t.fnr),sortableDato:m.utc(d[0].fødselsdato).toDate(),alleBarnaLever:d.every(t=>b(t)),annenForelder:e}},He=(n,r)=>n.filter(e=>e.barn!==void 0&&e.barn.length>0||e.familiehendelse.termindato!==void 0||e.familiehendelse.fødselsdato!==void 0||e.familiehendelse.omsorgsovertakelse!==void 0).map(e=>Ve(e,r)),Ce=(n,r,e)=>{const d=n.filter(s=>!e.find(g=>Q(s.fødselsdato,h(g.familiehendelse.fødselsdato)))),i="tempFnr",t=d.map(s=>s.fnr===void 0?{...s,fnr:i+A().toString()}:s),l=r.map(s=>s.fnr).flat(),o=r.filter(s=>s.fødselsdatoer!==void 0&&s.fødselsdatoer.length>0).map(s=>s.fødselsdatoer).flat(),S=[];return t.filter(s=>!(s.dødsdato!==void 0&&o.find(g=>m(g).isSame(m.utc(s.fødselsdato),"day")))).forEach(s=>{if(!l.includes(s.fnr)&&!de(s.fødselsdato)){const g=qe(s.fnr,s.fødselsdato,t),F=s.annenForelder!==void 0?{fnr:s.annenForelder.fnr,fornavn:s.annenForelder.fornavn,mellomnavn:s.annenForelder.mellomnavn,etternavn:s.annenForelder.etternavn}:void 0;if(l.push(s.fnr),g.length===0){if(!X(s)){const y=Ge(s,F);S.push(y)}}else{const y=Ye(s,g,F);g.forEach(N=>{l.push(N.fnr)}),y!==void 0&&S.push(y)}}}),S.map(s=>s.fnr&&s.fnr.length>0?{...s,fnr:s.fnr.filter(g=>g&&!g.startsWith(i))}:s)},Je=(n,r)=>{const e=n.filter(l=>!l.sakAvsluttet),d=n.filter(l=>l.sakAvsluttet),i=He(e,r),t=Ce(r,i,d);return i.concat(t)},$e=(n,r)=>{var i,t;const e=r.filter(l=>l.sak!==void 0&&l.id!==n.id&&l.familiehendelsesdato!==void 0&&m(l.familiehendelsesdato).isAfter(n.familiehendelsesdato,"day"));e.sort(ne);const d=e[e.length-1];if(d!==void 0)return{familiehendelsesdato:d.familiehendelsesdato,startdatoFørsteStønadsperiode:d.startdatoFørsteStønadsperiode,fnr:d.fnr,annenForelderFnr:(t=(i=d.sak)==null?void 0:i.annenPart)==null?void 0:t.fnr}},ne=(n,r)=>m(n.sortableDato).isBefore(r.sortableDato,"d")?1:m(n.sortableDato).isAfter(r.sortableDato,"d")?-1:0,ze=({locale:n,saker:r,onChangeLocale:e,harGodkjentVilkår:d,søkerInfo:i,setHarGodkjentVilkår:t,setErEndringssøknad:l,setSøknadGjelderNyttBarn:o,mellomlagreSøknadOgNaviger:S})=>{const D=z(),O=ie(i.arbeidsforhold,S),[s,g]=P.useState(!1),F=$(),{oppdaterSøknadIState:y}=Oe(),[N,L]=P.useState(!1),q=P.useMemo(()=>Je(r,i.søker.barn),[r,i.søker.barn]),w=[...q].sort(ne),re=k=>{if(k.harForståttRettigheterOgPlikter!==!0)return;g(!0);const f=k.valgteBarn===R.SØKNAD_GJELDER_NYTT_BARN?void 0:q.find(p=>p.id===k.valgteBarn),_=f!==void 0&&!!f.kanSøkeOmEndring;let j;f!==void 0&&(j=$e(f,w),F(u.BARN_FRA_NESTE_SAK,j));const M=_&&f.sak!==void 0?r.find(p=>{var B;return p.saksnummer===((B=f.sak)==null?void 0:B.saksnummer)}):void 0,ae=j!==void 0?j.startdatoFørsteStønadsperiode:void 0,V=_&&M,G=f!==void 0&&f.sak!==void 0&&f.kanSøkeOmEndring===!1,se=!V&&!G&&f!==void 0;let Y=C.SØKERSITUASJON,H=!1;if(V){const p=ge(M,ae,f.fødselsdatoer);Y=C.UTTAKSPLAN;const B=ke(i.søker,p,D,M.annenPart,f);y(B,p)}else if(G){const p=ce(f,D,i.søker.barn,i.søker.fnr);y(p)}else if(se){const p=pe(f);y(p)}else H=!0;return t(k.harForståttRettigheterOgPlikter),l(_),o(H),O.goToNextStep(Y)},I=oe({defaultValues:{harForståttRettigheterOgPlikter:d}}),K=I.watch("valgteBarn"),U=K===R.SØKNAD_GJELDER_NYTT_BARN?void 0:q.find(k=>k.id===K),te=U!==void 0&&U.kanSøkeOmEndring===!0?D.formatMessage({id:"velkommen.endreSøknad"}):D.formatMessage({id:"velkommen.begynnMedSøknad"});return a.jsx(me,{formMethods:I,onSubmit:re,children:a.jsxs(E,{gap:"10",children:[a.jsx(Fe,{locale:n,availableLocales:["nb","nn"],toggleLanguage:e}),a.jsx(je,{children:a.jsxs(E,{gap:"8",children:[a.jsx(T,{justify:"center",children:a.jsx(fe,{size:"xlarge",children:a.jsx(v,{id:"velkommen.tittel"})})}),a.jsx(Be,{poster:!0,children:a.jsxs(E,{gap:"2",children:[a.jsx(v,{id:"velkommen.guidepanel.del1"}),a.jsx(v,{id:"velkommen.guidepanel.del2",values:{a:k=>a.jsx("a",{className:"lenke",rel:"noopener noreferrer",href:ve.foreldrepenger,children:k})}})]})}),a.jsx(ee,{selectableBarn:w}),a.jsx(Ee,{variant:"info",children:a.jsx(v,{id:"velkommen.lagring.info"})}),a.jsx(ue,{name:"harForståttRettigheterOgPlikter",label:D.formatMessage({id:"velkommen.samtykke"}),validate:[k=>k!==!0?D.formatMessage({id:"valideringsfeil.velkommen.harForståttRettigheterOgPlikter.påkrevd"}):null],children:a.jsx(E,{gap:"5",children:a.jsxs(T,{gap:"1",children:[a.jsx(J,{children:a.jsx(v,{id:"velkommen.samtykkeIntro.del1"})}),a.jsx(Pe,{})]})})}),a.jsx(T,{justify:"center",children:a.jsx(xe,{type:"submit",variant:"primary",disabled:s,loading:s,children:te})}),a.jsx(T,{justify:"center",children:a.jsx(J,{children:a.jsx("a",{className:"lenke",href:"#",onClick:k=>{k.preventDefault(),L(!0)},children:a.jsx(v,{id:"velkommen.lesMerOmPersonopplysninger"})})})}),a.jsx(Re,{isOpen:N,onRequestClose:()=>L(!1)})]})})]})})};ze.__docgenInfo={description:"",methods:[],displayName:"Forside",props:{onChangeLocale:{required:!0,tsType:{name:"signature",type:"function",raw:"(locale: LocaleNo) => void",signature:{arguments:[{type:{name:"union",raw:"'nb' | 'nn'",elements:[{name:"literal",value:"'nb'"},{name:"literal",value:"'nn'"}]},name:"locale"}],return:{name:"void"}}},description:""},locale:{required:!0,tsType:{name:"union",raw:"'nb' | 'nn'",elements:[{name:"literal",value:"'nb'"},{name:"literal",value:"'nn'"}]},description:""},saker:{required:!0,tsType:{name:"Array",elements:[{name:"Sak"}],raw:"Sak[]"},description:""},harGodkjentVilkår:{required:!0,tsType:{name:"boolean"},description:""},søkerInfo:{required:!0,tsType:{name:"signature",type:"object",raw:`{
    søker: Søker;
    arbeidsforhold: Arbeidsforhold[];
}`,signature:{properties:[{key:"søker",value:{name:"intersection",raw:`{
    fødselsdato: string;
    kjønn: Kjønn;
    bankkonto?: Bankkonto;
    sivilstand?: Sivilstand;
    barn: SøkerBarn[];
} & PersonBase`,elements:[{name:"signature",type:"object",raw:`{
    fødselsdato: string;
    kjønn: Kjønn;
    bankkonto?: Bankkonto;
    sivilstand?: Sivilstand;
    barn: SøkerBarn[];
}`,signature:{properties:[{key:"fødselsdato",value:{name:"string",required:!0}},{key:"kjønn",value:{name:"union",raw:"'M' | 'K'",elements:[{name:"literal",value:"'M'"},{name:"literal",value:"'K'"}],required:!0}},{key:"bankkonto",value:{name:"Bankkonto",required:!1}},{key:"sivilstand",value:{name:"Sivilstand",required:!1}},{key:"barn",value:{name:"Array",elements:[{name:"intersection",raw:`{
    kjønn: Kjønn;
    fødselsdato: string;
    dødsdato?: string;
    annenForelder?: SøkerAnnenForelder;
} & PersonBase`,elements:[{name:"signature",type:"object",raw:`{
    kjønn: Kjønn;
    fødselsdato: string;
    dødsdato?: string;
    annenForelder?: SøkerAnnenForelder;
}`,signature:{properties:[{key:"kjønn",value:{name:"union",raw:"'M' | 'K'",elements:[{name:"literal",value:"'M'"},{name:"literal",value:"'K'"}],required:!0}},{key:"fødselsdato",value:{name:"string",required:!0}},{key:"dødsdato",value:{name:"string",required:!1}},{key:"annenForelder",value:{name:"intersection",raw:`{
    fødselsdato?: string;
} & PersonBase`,elements:[{name:"signature",type:"object",raw:`{
    fødselsdato?: string;
}`,signature:{properties:[{key:"fødselsdato",value:{name:"string",required:!1}}]}},{name:"signature",type:"object",raw:`{
    fnr: string;
    fornavn: string;
    mellomnavn?: string;
    etternavn: string;
}`,signature:{properties:[{key:"fnr",value:{name:"string",required:!0}},{key:"fornavn",value:{name:"string",required:!0}},{key:"mellomnavn",value:{name:"string",required:!1}},{key:"etternavn",value:{name:"string",required:!0}}]}}],required:!1}}]}},{name:"signature",type:"object",raw:`{
    fnr: string;
    fornavn: string;
    mellomnavn?: string;
    etternavn: string;
}`,signature:{properties:[{key:"fnr",value:{name:"string",required:!0}},{key:"fornavn",value:{name:"string",required:!0}},{key:"mellomnavn",value:{name:"string",required:!1}},{key:"etternavn",value:{name:"string",required:!0}}]}}]}],raw:"SøkerBarn[]",required:!0}}]}},{name:"signature",type:"object",raw:`{
    fnr: string;
    fornavn: string;
    mellomnavn?: string;
    etternavn: string;
}`,signature:{properties:[{key:"fnr",value:{name:"string",required:!0}},{key:"fornavn",value:{name:"string",required:!0}},{key:"mellomnavn",value:{name:"string",required:!1}},{key:"etternavn",value:{name:"string",required:!0}}]}}],required:!0}},{key:"arbeidsforhold",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
    arbeidsgiverNavn: string;
    arbeidsgiverId: string;
    arbeidsgiverIdType: string;
    fom: string;
    tom?: string;
    stillingsprosent: number;
}`,signature:{properties:[{key:"arbeidsgiverNavn",value:{name:"string",required:!0}},{key:"arbeidsgiverId",value:{name:"string",required:!0}},{key:"arbeidsgiverIdType",value:{name:"string",required:!0}},{key:"fom",value:{name:"string",required:!0}},{key:"tom",value:{name:"string",required:!1}},{key:"stillingsprosent",value:{name:"number",required:!0}}]}}],raw:"Arbeidsforhold[]",required:!0}}]}},description:""},setHarGodkjentVilkår:{required:!0,tsType:{name:"signature",type:"function",raw:"(harGodkjentVilkår: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"harGodkjentVilkår"}],return:{name:"void"}}},description:""},setErEndringssøknad:{required:!0,tsType:{name:"signature",type:"function",raw:"(erEndringssøknad: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"erEndringssøknad"}],return:{name:"void"}}},description:""},setSøknadGjelderNyttBarn:{required:!0,tsType:{name:"signature",type:"function",raw:"(søknadGjelderNyttBarn: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"søknadGjelderNyttBarn"}],return:{name:"void"}}},description:""},mellomlagreSøknadOgNaviger:{required:!0,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""}}};export{ze as F};
