{"version":3,"file":"Velkommen-3aa8603e.js","sources":["../../src/app/pages/velkommen/Velkommen.tsx"],"sourcesContent":["import { bemUtils, Block, intlUtils, LanguageToggle, Locale } from '@navikt/fp-common';\nimport actionCreator, { ForeldrepengesøknadContextAction } from 'app/context/action/actionCreator';\nimport { useEffect, useState } from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport useOnValidSubmit from 'app/utils/hooks/useOnValidSubmit';\nimport useSøknad from 'app/utils/hooks/useSøknad';\nimport {\n    getInitialVelkommenValues,\n    VelkommenFormComponents,\n    VelkommenFormData,\n    VelkommenFormField,\n    velkommenFormQuestions,\n    VelkommenQuestionsPayload,\n} from './velkommenFormConfig';\nimport DinePlikter from 'app/components/dine-plikter/DinePlikter';\nimport DinePersonopplysningerModal from '../modaler/DinePersonopplysningerModal';\nimport { validateHarForståttRettigheterOgPlikter } from './validation/velkommenValidation';\nimport SøknadRoutes from 'app/routes/routes';\nimport { storeAppState } from 'app/utils/submitUtils';\nimport { ForeldrepengesøknadContextState } from 'app/context/ForeldrepengesøknadContextConfig';\nimport {\n    mapSøkerensEksisterendeSakFromDTO,\n    opprettSøknadFraEksisterendeSak,\n    opprettSøknadFraValgteBarn,\n    opprettSøknadFraValgteBarnMedSak,\n} from 'app/utils/eksisterendeSakUtils';\nimport { useForeldrepengesøknadContext } from 'app/context/hooks/useForeldrepengesøknadContext';\nimport { Søknad } from 'app/context/types/Søknad';\n\nimport BarnVelger, { SelectableBarnOptions } from './components/barnVelger/BarnVelger';\nimport { getBarnFraNesteSak, getSelectableBarnOptions, sorterSelectableBarnEtterYngst } from './velkommenUtils';\nimport useSøkerinfo from 'app/utils/hooks/useSøkerinfo';\nimport { Sak } from 'app/types/Sak';\nimport { Alert, BodyShort, Button, GuidePanel, Heading } from '@navikt/ds-react';\n\nimport './velkommen.less';\nimport links from 'app/links/links';\n\ninterface Props {\n    fornavn: string;\n    onChangeLocale: (locale: Locale) => void;\n    locale: Locale;\n    saker: Sak[];\n    fnr: string;\n}\n\nconst Velkommen: React.FunctionComponent<Props> = ({ locale, saker, onChangeLocale }) => {\n    const intl = useIntl();\n    const søknad = useSøknad();\n    const { dispatch, state } = useForeldrepengesøknadContext();\n    const [isDinePersonopplysningerModalOpen, setDinePersonopplysningerModalOpen] = useState(false);\n    const bem = bemUtils('velkommen');\n    const søkerinfo = useSøkerinfo();\n    const { registrerteBarn } = søkerinfo;\n    const selectableBarn = getSelectableBarnOptions(saker, registrerteBarn);\n    const sortedSelectableBarn = [...selectableBarn].sort(sorterSelectableBarnEtterYngst);\n\n    useEffect(() => {\n        if (state.søknad.søker.språkkode !== locale) {\n            dispatch(actionCreator.setSpråkkode(locale));\n        }\n    }, [dispatch, locale, state.søknad.søker.språkkode]);\n\n    const onValidSubmitHandler = (values: Partial<VelkommenFormData>) => {\n        const valgteBarn =\n            values.valgteBarn === SelectableBarnOptions.SØKNAD_GJELDER_NYTT_BARN\n                ? undefined\n                : selectableBarn.find((sb) => sb.id === values.valgteBarn);\n        const vilSøkeOmEndring = valgteBarn !== undefined && !!valgteBarn.kanSøkeOmEndring;\n        const valgtEksisterendeSak =\n            vilSøkeOmEndring && valgteBarn.sak !== undefined\n                ? saker.find((sak) => sak.saksnummer === valgteBarn.sak?.saksnummer)\n                : undefined;\n\n        const actionsToDispatch: ForeldrepengesøknadContextAction[] = [\n            actionCreator.setVelkommen(values.harForståttRettigheterOgPlikter!),\n            actionCreator.setErEndringssøknad(vilSøkeOmEndring),\n        ];\n        let barnFraNesteSak = undefined;\n        if (valgteBarn !== undefined) {\n            barnFraNesteSak = getBarnFraNesteSak(valgteBarn, sortedSelectableBarn);\n            actionsToDispatch.push(actionCreator.setBarnFraNesteSak(barnFraNesteSak));\n        }\n        const førsteUttaksdagNesteBarnsSak =\n            barnFraNesteSak !== undefined ? barnFraNesteSak.startdatoFørsteStønadsperiode : undefined;\n\n        const endringssøknad = vilSøkeOmEndring && valgtEksisterendeSak;\n        const nySøknadPåAlleredeSøktBarn =\n            valgteBarn !== undefined && valgteBarn.sak !== undefined && valgteBarn.kanSøkeOmEndring === false;\n        const nySøknadPåValgteRegistrerteBarn =\n            !endringssøknad && !nySøknadPåAlleredeSøktBarn && valgteBarn !== undefined;\n\n        if (endringssøknad) {\n            const eksisterendeSak = mapSøkerensEksisterendeSakFromDTO(\n                valgtEksisterendeSak,\n                førsteUttaksdagNesteBarnsSak,\n            );\n\n            const søknad = opprettSøknadFraEksisterendeSak(\n                state.søkerinfo,\n                eksisterendeSak!,\n                intl,\n                valgtEksisterendeSak.annenPart,\n                valgteBarn,\n            ) as Søknad;\n\n            actionsToDispatch.push(actionCreator.updateCurrentRoute(SøknadRoutes.UTTAKSPLAN));\n            actionsToDispatch.push(actionCreator.setSøknad(søknad));\n            actionsToDispatch.push(actionCreator.setEksisterendeSak(eksisterendeSak));\n            actionsToDispatch.push(\n                actionCreator.setBrukerSvarteJaPåAutoJustering(eksisterendeSak?.grunnlag.ønskerJustertUttakVedFødsel),\n            );\n            actionsToDispatch.push(actionCreator.setSøknadGjelderEtNyttBarn(false));\n        } else if (nySøknadPåAlleredeSøktBarn) {\n            const søknad = opprettSøknadFraValgteBarnMedSak(valgteBarn, intl, søkerinfo) as Søknad;\n            actionsToDispatch.push(actionCreator.setSøknad(søknad));\n            actionsToDispatch.push(actionCreator.setSøknadGjelderEtNyttBarn(false));\n        } else if (nySøknadPåValgteRegistrerteBarn) {\n            const søknad = opprettSøknadFraValgteBarn(valgteBarn) as Søknad;\n            actionsToDispatch.push(actionCreator.setSøknad(søknad));\n            actionsToDispatch.push(actionCreator.setSøknadGjelderEtNyttBarn(false));\n        } else {\n            actionsToDispatch.push(actionCreator.setSøknadGjelderEtNyttBarn(true));\n        }\n\n        return actionsToDispatch;\n    };\n\n    const { handleSubmit, isSubmitting } = useOnValidSubmit(\n        onValidSubmitHandler,\n        SøknadRoutes.SØKERSITUASJON,\n        (state: ForeldrepengesøknadContextState) => storeAppState(state),\n    );\n\n    return (\n        <VelkommenFormComponents.FormikWrapper\n            initialValues={getInitialVelkommenValues(søknad.harGodkjentVilkår)}\n            onSubmit={handleSubmit}\n            renderForm={({ values, setFieldValue }) => {\n                const visibility = velkommenFormQuestions.getVisbility({\n                    ...values,\n                    selectableBarn,\n                } as VelkommenQuestionsPayload);\n                const valgtBarnId = values.valgteBarn;\n                const valgtBarn =\n                    valgtBarnId === SelectableBarnOptions.SØKNAD_GJELDER_NYTT_BARN\n                        ? undefined\n                        : selectableBarn.find((barn) => barn.id === valgtBarnId);\n                const knapptekst =\n                    valgtBarn !== undefined && valgtBarn.kanSøkeOmEndring === true\n                        ? intlUtils(intl, 'velkommen.endreSøknad')\n                        : intlUtils(intl, 'velkommen.begynnMedSøknad');\n                return (\n                    <VelkommenFormComponents.Form includeButtons={false}>\n                        <LanguageToggle\n                            locale={locale}\n                            availableLocales={['nb', 'nn']}\n                            toggle={(l: Locale) => onChangeLocale(l)}\n                        />\n                        <div className={bem.block}>\n                            <Block>\n                                <Heading size=\"xlarge\" className={`${bem.element('tittel')}`}>\n                                    {intlUtils(intl, 'velkommen.tittel')}\n                                </Heading>\n                            </Block>\n                            <Block padBottom=\"l\">\n                                <GuidePanel poster>\n                                    <Block padBottom=\"m\">{intlUtils(intl, 'velkommen.guidepanel.del1')}</Block>{' '}\n                                    <Block>\n                                        <FormattedMessage\n                                            id=\"velkommen.guidepanel.del2\"\n                                            values={{\n                                                a: (msg: any) => (\n                                                    <a\n                                                        className=\"lenke\"\n                                                        rel=\"noopener noreferrer\"\n                                                        href={links.foreldrepenger}\n                                                        target=\"_blank\"\n                                                    >\n                                                        {msg}\n                                                    </a>\n                                                ),\n                                            }}\n                                        />\n                                    </Block>\n                                </GuidePanel>\n                            </Block>\n                            <Block padBottom=\"l\" visible={visibility.isVisible(VelkommenFormField.valgteBarn)}>\n                                <BarnVelger\n                                    selectableBarn={sortedSelectableBarn}\n                                    visibility={visibility}\n                                    formValues={values as VelkommenFormData}\n                                    setFieldValue={setFieldValue}\n                                />\n                            </Block>\n                            <Block\n                                padBottom=\"l\"\n                                visible={visibility.isVisible(VelkommenFormField.harForståttRettigheterOgPlikter)}\n                            >\n                                <Alert variant=\"info\">{intlUtils(intl, 'velkommen.lagring.info')}</Alert>\n                            </Block>\n                            <Block\n                                padBottom=\"l\"\n                                visible={visibility.isVisible(VelkommenFormField.harForståttRettigheterOgPlikter)}\n                            >\n                                <VelkommenFormComponents.ConfirmationCheckbox\n                                    name={VelkommenFormField.harForståttRettigheterOgPlikter}\n                                    label={intlUtils(intl, 'velkommen.samtykke')}\n                                    validate={validateHarForståttRettigheterOgPlikter(intl)}\n                                >\n                                    <>\n                                        <Block padBottom=\"l\">\n                                            <FormattedMessage id=\"velkommen.samtykkeIntro.del1\" />\n                                        </Block>\n                                        <Block padBottom=\"m\">\n                                            <DinePlikter />\n                                        </Block>\n                                    </>\n                                </VelkommenFormComponents.ConfirmationCheckbox>\n                            </Block>\n                            <Block padBottom=\"l\">\n                                <div style={{ textAlign: 'center' }}>\n                                    <Button\n                                        type=\"submit\"\n                                        variant=\"primary\"\n                                        disabled={isSubmitting}\n                                        loading={isSubmitting}\n                                    >\n                                        {knapptekst}\n                                    </Button>\n                                </div>\n                            </Block>\n                            <BodyShort className={bem.element('personopplysningerLink')}>\n                                <a\n                                    className=\"lenke\"\n                                    href=\"#\"\n                                    onClick={(e) => {\n                                        e.preventDefault();\n                                        setDinePersonopplysningerModalOpen(true);\n                                    }}\n                                >\n                                    <FormattedMessage id=\"velkommen.lesMerOmPersonopplysninger\" />\n                                </a>\n                            </BodyShort>\n                            <DinePersonopplysningerModal\n                                isOpen={isDinePersonopplysningerModalOpen}\n                                onRequestClose={() => setDinePersonopplysningerModalOpen(false)}\n                            />\n                        </div>\n                    </VelkommenFormComponents.Form>\n                );\n            }}\n        />\n    );\n};\n\nexport default Velkommen;\n"],"names":["Velkommen","locale","saker","onChangeLocale","intl","useIntl","søknad","useSøknad","dispatch","state","useForeldrepengesøknadContext","isDinePersonopplysningerModalOpen","setDinePersonopplysningerModalOpen","useState","bem","bemUtils","søkerinfo","useSøkerinfo","registrerteBarn","selectableBarn","getSelectableBarnOptions","sortedSelectableBarn","sorterSelectableBarnEtterYngst","useEffect","actionCreator","onValidSubmitHandler","values","valgteBarn","SelectableBarnOptions","sb","vilSøkeOmEndring","valgtEksisterendeSak","sak","_a","actionsToDispatch","barnFraNesteSak","getBarnFraNesteSak","førsteUttaksdagNesteBarnsSak","endringssøknad","nySøknadPåAlleredeSøktBarn","nySøknadPåValgteRegistrerteBarn","eksisterendeSak","mapSøkerensEksisterendeSakFromDTO","søknad2","opprettSøknadFraEksisterendeSak","SøknadRoutes","opprettSøknadFraValgteBarnMedSak","opprettSøknadFraValgteBarn","handleSubmit","isSubmitting","useOnValidSubmit","state2","storeAppState","jsx","VelkommenFormComponents","getInitialVelkommenValues","setFieldValue","visibility","velkommenFormQuestions","valgtBarnId","valgtBarn","barn","knapptekst","intlUtils","jsxs","LanguageToggle","Block","Heading","GuidePanel","FormattedMessage","msg","links","VelkommenFormField","BarnVelger","Alert","validateHarForståttRettigheterOgPlikter","Fragment","DinePlikter","Button","BodyShort","e","DinePersonopplysningerModal","Velkommen$1"],"mappings":"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"}