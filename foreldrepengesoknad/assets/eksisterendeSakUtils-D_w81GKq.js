import{d as A,I as Ae}from"./dates-AkG-ZPn6.js";import{ab as te,ac as U,ad as z,ae as Se,af as H,ag as Re,ah as C,U as h,e as c,ai as W,aj as Te,ak as ge,al as pe,am as F,an as _,ao as S,ap as j,aq as y,ar as G,as as g,at as p,au as Ie,a7 as X,a8 as _e,Q as Oe,D as V,B as M,av as K}from"./Uttaksplan-DwDBGZRj.js";import"./index-DI2V0i71.js";import"./jsx-runtime-CLpGMVip.js";import{I as B,j as ne,G as oe,H as b,e as Pe}from"./barnUtils-fGEJoYVf.js";import{g as I}from"./guid-CsArkN6i.js";import{c as ve}from"./useFpNavigator-CrVLYhlk.js";var J=(e=>(e.ÅTTI_PROSENT="ÅTTI",e.HUNDRE_PROSENT="HUNDRE",e))(J||{}),O=(e=>(e.ADOPSJON="ADPSJN",e.OMSORGSOVERTAKELSE="OMSRGO",e.FØDSEL="FODSL",e.TERM="TERM",e))(O||{}),P=(e=>(e.UttakFellesperiodeAnnenForelder="FELLESPERIODE_ANNEN_FORELDER",e.UttakFedrekvoteAnnenForelder="FEDREKVOTE_ANNEN_FORELDER",e.UttakMødrekvoteAnnenForelder="MØDREKVOTE_ANNEN_FORELDER",e.UttakForeldrepengerAnnenForelder="FORELDREPENGER_ANNEN_FORELDER",e.Ingen="INGEN",e))(P||{}),L=(e=>(e.AVSLAG_FRATREKK_PLEIEPENGER="AVSLAG_FRATREKK_PLEIEPENGER",e.AVSLAG_UTSETTELSE_TILBAKE_I_TID="AVSLAG_UTSETTELSE_TILBAKE_I_TID",e.INNVILGET_UTTAK_AVSLÅTT_GRADERING_TILBAKE_I_TID="INNVILGET_UTTAK_AVSLÅTT_GRADERING_TILBAKE_I_TID",e.AVSLAG_HULL_MELLOM_FORELDRENES_PERIODER="AVSLAG_HULL_MELLOM_FORELDRENES_PERIODER",e.ANNET="ANNET",e))(L||{}),N=(e=>(e.BARE_SØKER_RETT="BARE_SØKER_RETT",e.ALENEOMSORG="ALENEOMSORG",e.BEGGE_RETT="BEGGE_RETT",e))(N||{}),k=(e=>(e.Ferie="LOVBESTEMT_FERIE",e.Arbeid="ARBEID",e.Sykdom="SØKER_SYKDOM",e.InstitusjonSøker="SØKER_INNLAGT",e.InstitusjonBarnet="BARN_INNLAGT",e.HvØvelse="HV_ØVELSE",e.NavTiltak="NAV_TILTAK",e.Fri="FRI",e))(k||{}),w=(e=>(e.ORDINÆRT_ARBEID="ORDINÆRT_ARBEID",e.SELVSTENDIG_NÆRINGSDRIVENDE="SELVSTENDIG_NÆRINGSDRIVENDE",e.FRILANS="FRILANS",e.ANNET="ANNET",e))(w||{});const de=(e,r,t)=>{if(t!==void 0)return O.ADOPSJON;if(e!==void 0)return O.FØDSEL;if(r!==void 0)return O.TERM;throw new Error("Fødselsdato/ termindato/ omsorgsovertakelsedato mangler")},sr=(e,r,t)=>e?t.formatMessage({id:"adopsjon"}):r?t.formatMessage({id:"fødsel"}):t.formatMessage({id:"termin"}),Z=e=>H(e).getAntallUttaksdager()>0,Ne=e=>Re(e.tidsperiode),Me=(e,r,t)=>!!(A(e.tidsperiode.tom).isBefore(t)&&A(r.tidsperiode.tom).isBefore(t)||A(e.tidsperiode.fom).isSameOrAfter(t)&&A(r.tidsperiode.fom).isSameOrAfter(t)),Ue=(e,r,t)=>{if(e.length<=1)return e;const n=[],o=e.filter(i=>U(i)),l=[...e.filter(i=>!U(i)),...o];let s={...l[0]};return l.forEach((i,f)=>{if(f!==0){if(s===void 0){s=i;return}if(H(s).erLik(i,!1,!0)&&H(s).erSammenhengende(i)&&!A(i.tidsperiode.fom).isSame(r,"day")&&Me(s,i,r)&&!(t!==void 0&&A(i.tidsperiode.fom).isSame(t,"day"))){s.tidsperiode.tom=i.tidsperiode.tom;return}else n.push(s);s=i}}),n.push(s),n.sort(te)},Le=e=>{const{fom:r,tom:t}=e.tidsperiode,n=C(r),o=C(t);return n&&o?e:!n&&!o?{...e,tidsperiode:{fom:h(r).neste(),tom:h(t).forrige()}}:!n&&o?{...e,tidsperiode:{fom:h(r).neste(),tom:t}}:{...e,tidsperiode:{fom:r,tom:h(t).forrige()}}},v=(e,r)=>e.gjelderAnnenPart?r?G.mor:G.farMedmor:r?G.farMedmor:G.mor,se=e=>{switch(e){case k.Arbeid:return g.Arbeid;case k.Ferie:return g.Ferie;case k.InstitusjonBarnet:return g.InstitusjonBarnet;case k.InstitusjonSøker:return g.InstitusjonSøker;case k.Sykdom:return g.Sykdom;case k.HvØvelse:return g.HvØvelse;case k.NavTiltak:return g.NavTiltak;case k.Fri:return g.Fri;default:return}},De=e=>{switch(e.kontoType){case c.Fedrekvote:return p.UttakFedrekvoteAnnenForelder;case c.Fellesperiode:return p.UttakFellesperiodeAnnenForelder;case c.Mødrekvote:return p.UttakMødrekvoteAnnenForelder;case c.Foreldrepenger:return p.UttakForeldrepengerAnnenForelder;case c.ForeldrepengerFørFødsel:return p.ForeldrepengerFørFødsel;default:return}},ie=(e,r,t)=>{if(e)return e.toString();if(r)return t?(100-t).toString():"100"},he=e=>e?c.AktivitetsfriKvote:c.Foreldrepenger,Ge=(e,r,t,n)=>{if(e&&!r.flerbarnsdager&&!r.samtidigUttak&&A(r.periode.fom).isBefore(A(t).add(6,"weeks"),"day")&&n!==c.AktivitetsfriKvote&&r.morsAktivitet!==Ie.Uføre)return!0},ye=(e,r,t)=>{var D;const n=e.gradering!==void 0&&e.resultat.innvilget,o=F(e.periode),d=r.søkerErFarEllerMedmor&&!r.morHarRett&&!r.farMedmorErAleneOmOmsorg&&!r.harAnnenForelderTilsvarendeRettEØS,l=t!==void 0?t.find(T=>(_(F(T.periode)).erLik(o)||_(F(T.periode)).overlapper(o))&&T.guid!==e.guid):void 0;let s;l&&(s=l.samtidigUttak);const i=ie(e.samtidigUttak,s,(D=e.gradering)==null?void 0:D.arbeidstidprosent),f=ae(e),{termindato:u,fødselsdato:a,omsorgsovertakelsesdato:m}=r,R=ne(u,a,m),E=d?he(e.resultat.trekkerMinsterett):e.kontoType;return{id:I(),type:S.Uttak,konto:E,tidsperiode:o,forelder:v(e,r.søkerErFarEllerMedmor),ønskerSamtidigUttak:e.samtidigUttak!==void 0,gradert:n,samtidigUttakProsent:i,ønskerFlerbarnsdager:r.antallBarn>1?e.flerbarnsdager:void 0,stillingsprosent:n?e.gradering.arbeidstidprosent.toString():void 0,arbeidsformer:n?[Je(e.gradering.aktivitet.type)]:void 0,orgnumre:n&&e.gradering.aktivitet.arbeidsgiver!==void 0?[e.gradering.aktivitet.arbeidsgiver.id]:void 0,morsAktivitetIPerioden:e.morsAktivitet,erMorForSyk:Ge(r.søkerErFarEllerMedmor,e,R,E),angittAvAnnenPart:e.angittAvAnnenPart,opprinneligSøkt:f}},Ve=(e,r)=>({id:I(),type:S.Utsettelse,årsak:se(e.utsettelseÅrsak),tidsperiode:F(e.periode),forelder:v(e,r),erArbeidstaker:!1,morsAktivitetIPerioden:e.morsAktivitet}),ae=e=>{if(e.resultat.årsak===L.AVSLAG_UTSETTELSE_TILBAKE_I_TID){if(e.utsettelseÅrsak===k.Ferie)return j.Ferie;if(e.utsettelseÅrsak===k.Arbeid)return j.Arbeid}if(e.resultat.årsak===L.INNVILGET_UTTAK_AVSLÅTT_GRADERING_TILBAKE_I_TID)return j.Gradering},je=(e,r)=>{const t=ae(e);return{id:I(),type:S.Info,infotype:y.avslåttPeriode,tidsperiode:F(e.periode),avslåttPeriodeType:e.utsettelseÅrsak!==void 0?S.Utsettelse:S.Uttak,kontoType:e.kontoType,forelder:v(e,r),overskrives:!0,visPeriodeIPlan:!0,kanSlettes:e.resultat.årsak!==L.AVSLAG_FRATREKK_PLEIEPENGER,opprinneligSøkt:t}},Ke=(e,r,t,n)=>{var u;const o=F(e.periode);if(e.utsettelseÅrsak!==void 0&&e.resultat.innvilget===!0)return{type:S.Info,infotype:y.utsettelseAnnenPart,id:I(),årsak:se(e.utsettelseÅrsak),tidsperiode:o,forelder:v(e,r),overskrives:!0,visPeriodeIPlan:!0};const d=n!==void 0&&!n.some(a=>(_(F(a.periode)).erLik(o)||_(F(a.periode)).overlapper(o))&&a.guid!==e.guid),l=De(e),s=n!==void 0?n.find(a=>(_(F(a.periode)).erLik(o)||_(F(a.periode)).overlapper(o))&&a.guid!==e.guid):void 0;let i;s&&(i=s.samtidigUttak);const f=ie(e.samtidigUttak,i,(u=e.gradering)==null?void 0:u.arbeidstidprosent);return x(e,t)?{type:S.Info,infotype:y.avslåttPeriode,id:I(),tidsperiode:o,forelder:v(e,r),overskrives:!0,visPeriodeIPlan:d,kontoType:e.kontoType,avslåttPeriodeType:S.Uttak,kanSlettes:!1}:{type:S.Info,infotype:y.uttakAnnenPart,id:I(),årsak:l,tidsperiode:o,forelder:v(e,r),overskrives:!0,gradert:e.gradering!==void 0,ønskerSamtidigUttak:f!==void 0,samtidigUttakProsent:f,stillingsprosent:e.gradering!==void 0?e.gradering.arbeidstidprosent.toString():void 0,visPeriodeIPlan:d}},He=(e,r)=>({id:I(),forelder:v(e,r),konto:e.kontoType,tidsperiode:F(e.periode),type:S.Overføring,årsak:e.overføringÅrsak}),be=(e,r,t)=>{const n=t.filter(o=>!x(o,r.termindato));return e.gjelderAnnenPart?Ke(e,r.søkerErFarEllerMedmor,r.termindato,n):e.resultat.innvilget?e.utsettelseÅrsak!==void 0?Ve(e,r.søkerErFarEllerMedmor):e.overføringÅrsak!==void 0?He(e,r.søkerErFarEllerMedmor):ye(e,r,n):je(e,r.søkerErFarEllerMedmor)},x=(e,r)=>r&&e.gjelderAnnenPart&&!e.resultat.innvilget&&e.resultat.trekkerDager&&A(e.periode.tom).isBefore(A(B(r)),"d")&&e.kontoType!==c.Fedrekvote,we=(e,r)=>e.resultat.innvilget?!0:e.gjelderAnnenPart?!!x(e,r):e.resultat.årsak!==L.AVSLAG_HULL_MELLOM_FORELDRENES_PERIODER&&e.resultat.trekkerDager===!0,Be=(e,r,t)=>{const n=[];return e.forEach(o=>{W(o.tidsperiode,r)&&Te(o)?ge(o,r).forEach(l=>n.push(l)):t!==void 0&&W(o.tidsperiode,t)?pe(o,t).forEach(l=>n.push(l)):n.push(o)}),n},le=(e,r,t)=>{const n=e.filter(E=>we(E,r.termindato)),o=n.map(E=>be(E,r,n)),d=new Date(r.familiehendelseDato),l=Be(o,d,t),s=Ue([...l].sort(te).filter(Z).map(Le).filter(Ne).filter(Z),d,t),i=!r.morHarRett&&r.farMedmorHarRett&&!r.harAnnenForelderTilsvarendeRettEØS,f=r.familiehendelseType===O.ADOPSJON,u=s.filter(E=>!U(E)),a=s.filter(E=>U(E)),m=!r.erDeltUttak&&i&&!r.farMedmorErAleneOmOmsorg,R=z(u,m,d,f,i,r.søkerErFarEllerMedmor,t);return z(Se(R,a,d,t),m,d,f,i,r.søkerErFarEllerMedmor,t)},Je=e=>{switch(e){case w.SELVSTENDIG_NÆRINGSDRIVENDE:return K.selvstendignæringsdrivende;case w.FRILANS:return K.frilans;default:return K.arbeidstaker}},xe=e=>{switch(e){case P.UttakFedrekvoteAnnenForelder:return c.Fedrekvote;case P.UttakFellesperiodeAnnenForelder:return c.Fellesperiode;case P.UttakMødrekvoteAnnenForelder:return c.Mødrekvote;default:return}},Ye=e=>{switch(e){case P.UttakFedrekvoteAnnenForelder:return p.UttakFedrekvoteAnnenForelder;case P.UttakFellesperiodeAnnenForelder:return p.UttakFellesperiodeAnnenForelder;case P.UttakMødrekvoteAnnenForelder:return p.UttakMødrekvoteAnnenForelder;default:return}},fe=(e,r)=>{const{oppholdÅrsak:t}=e,n={guid:I(),periode:{fom:e.fom,tom:e.tom},gjelderAnnenPart:r,resultat:e.resultat,kontoType:e.kontoType,flerbarnsdager:e.flerbarnsdager,gradering:e.gradering,utsettelseÅrsak:e.utsettelseÅrsak,overføringÅrsak:e.overføringÅrsak,samtidigUttak:e.samtidigUttak,morsAktivitet:e.morsAktivitet,oppholdÅrsak:Ye(e.oppholdÅrsak)};return t!==void 0&&(n.kontoType=xe(t),r&&(n.gjelderAnnenPart=!1,n.angittAvAnnenPart=!0),r||(n.gjelderAnnenPart=!0)),n},$=e=>e.resultat.innvilget,me=(e,r,t)=>{const n=t.filter(d=>e.guid!==d.guid&&_(F(e.periode)).erLik(F(d.periode)));if(n.length===0)return!0;const o=n.filter($);return!($(e)===!1&&o.length>0)},ir=e=>{if(!(e===void 0||e.perioder.length===0))return B(e.perioder[0].fom)},ar=(e,r,t,n,o)=>{if(e==null||e==="")return;const d=!0,l=e.perioder.map(m=>fe(m,d)).filter(me);let s;e.termindato!==void 0?s=e.termindato:(X(r)||_e(r))&&r.termindato!==void 0&&(s=r.termindato);const i=X(r)?r.fødselsdatoer[0]:void 0,f=Oe(r)?r.adopsjonsdato:void 0,u={dekningsgrad:e.dekningsgrad===J.HUNDRE_PROSENT?V.HUNDRE_PROSENT:V.ÅTTI_PROSENT,antallBarn:e.antallBarn?e.antallBarn:r.antallBarn,morErAleneOmOmsorg:!1,morErUfør:!1,morHarRett:!0,farMedmorErAleneOmOmsorg:!1,farMedmorHarRett:!0,søkerErFarEllerMedmor:t,termindato:s,fødselsdato:i,omsorgsovertakelsesdato:f,erDeltUttak:!0,erBarnetFødt:i!==void 0,familiehendelseDato:n,familiehendelseType:de(i,s,f),harAnnenForelderTilsvarendeRettEØS:!1,ønskerJustertUttakVedFødsel:void 0,barn:[]},a=le(l,u,o);return{saksnummer:"",erAnnenPartsSak:d,grunnlag:u,saksperioder:l,uttaksplan:a.filter(m=>U(m))}},qe=(e,r,t)=>{const{dekningsgrad:o,familiehendelse:{fødselsdato:d,termindato:l,omsorgsovertakelse:s,antallBarn:i},harAnnenForelderTilsvarendeRettEØS:f,morUføretrygd:u,rettighetType:a,sakTilhørerMor:m,ønskerJustertUttakVedFødsel:R}=e,E=e.gjeldendeVedtak?e.gjeldendeVedtak.perioder:[],Y=!m,D=t&&t.length>0?oe(t[0]):void 0,T=d||D,q={dekningsgrad:o===J.HUNDRE_PROSENT?V.HUNDRE_PROSENT:V.ÅTTI_PROSENT,antallBarn:i,morErAleneOmOmsorg:m&&a===N.ALENEOMSORG,morErUfør:u,morHarRett:m||a===N.BEGGE_RETT,farMedmorErAleneOmOmsorg:!m&&a===N.ALENEOMSORG,farMedmorHarRett:!m||a===N.BEGGE_RETT,søkerErFarEllerMedmor:Y,termindato:l,fødselsdato:T,omsorgsovertakelsesdato:s,erDeltUttak:a===N.BEGGE_RETT,erBarnetFødt:T!==void 0,familiehendelseDato:ne(l,T,s),familiehendelseType:de(T,l,s),ønskerJustertUttakVedFødsel:T===void 0?R:void 0,harAnnenForelderTilsvarendeRettEØS:f},Q=E.map(ke=>fe(ke,!1)).filter(me),ce=le(Q,q,r);return{saksnummer:e.saksnummer,erAnnenPartsSak:!1,grunnlag:q,saksperioder:Q,uttaksplan:ce}},ue=e=>e===O.TERM||e===O.FØDSEL?"fødsel":"adopsjon",Qe=(e,r)=>{const{søkerErFarEllerMedmor:t}=r;return e.kjønn==="K"?t?"medmor":"mor":"far"},ee=(e,r)=>e.fødselsdatoer?b(e.fødselsdatoer):r.fødselsdato?Array(r.antallBarn).fill(r.fødselsdato):[],ze=(e,r,t)=>{switch(e){case"fødsel":return r.fødselsdato?{type:M.FØDT,antallBarn:r.antallBarn,fødselsdatoer:ee(t,r),termindato:r.termindato?r.termindato:void 0,fnr:t==null?void 0:t.fnr}:{type:M.UFØDT,antallBarn:r.antallBarn,termindato:r.termindato};case"adopsjon":return{type:M.ADOPTERT_STEBARN,adopsjonsdato:r.omsorgsovertakelsesdato,antallBarn:r.antallBarn,fødselsdatoer:ee(t,r),fnr:t==null?void 0:t.fnr};case"omsorgsovertakelse":throw new Error("Kan ikke sende endringssøknad for omsorgsovertakelse")}},re=(e,r)=>e.fornavn!==void 0&&e.fornavn!==""?e.fornavn:r.formatMessage({id:"annen.forelder"}),Ce=(e,r,t,n,o)=>{switch(e){case"fødsel":case"adopsjon":return n?{fornavn:re(t,o),etternavn:t.etternavn,erMorUfør:r.morErUfør,harRettPåForeldrepengerINorge:!!r.morHarRett&&!r.harAnnenForelderTilsvarendeRettEØS,fnr:t.fnr,kanIkkeOppgis:!1,harRettPåForeldrepengerIEØS:r.harAnnenForelderTilsvarendeRettEØS,erAleneOmOmsorg:r.farMedmorErAleneOmOmsorg}:{fornavn:re(t,o),etternavn:t.etternavn,harRettPåForeldrepengerINorge:!!r.farMedmorHarRett&&!r.harAnnenForelderTilsvarendeRettEØS,fnr:t.fnr,kanIkkeOppgis:!1,harRettPåForeldrepengerIEØS:r.harAnnenForelderTilsvarendeRettEØS,erAleneOmOmsorg:r.farMedmorErAleneOmOmsorg||r.morErAleneOmOmsorg};case"omsorgsovertakelse":throw new Error("Kan ikke sende endringssøknad for omsorgsovertakelse")}},We=(e,r,t,n,o,d,l)=>{var u;if(d===void 0&&r===void 0||!l)return;const s=d!==void 0?e.find(a=>d.includes(a.fnr)&&a.annenForelder!==void 0):void 0,i=r!==void 0?e.find(a=>Pe(a.fødselsdato,r)&&a.annenForelder!==void 0):void 0,f=s||i;if(f!==void 0&&((u=f.annenForelder)==null?void 0:u.fnr)===l){const a=f.annenForelder,{fornavn:m}=a,R=m!==void 0&&m.trim()!==""?m:o.formatMessage({id:"annen.forelder"}),E={...a,fornavn:R};return Ce(n,t,E,t.søkerErFarEllerMedmor,o)}},Ee=e=>e.fødselsdatoer!==void 0&&e.fødselsdatoer.length>0?{type:M.FØDT,antallBarn:e.antallBarn,fødselsdatoer:b(e.fødselsdatoer),termindato:oe(e.termindato),fnr:e.fnr!==void 0&&e.fnr.length>0?e.fnr.filter(r=>!!r):void 0}:e.termindato!==void 0?{type:M.UFØDT,antallBarn:e.antallBarn,termindato:A(e.termindato).format(Ae)}:{type:M.IKKE_UTFYLT,antallBarn:e.antallBarn,fødselsdatoer:e.fødselsdatoer?b(e.fødselsdatoer):[],fnr:e.fnr!==void 0&&e.fnr.length>0?e.fnr.filter(r=>!!r):void 0},Xe=e=>e.annenForelder!==void 0?{fornavn:e.annenForelder.fornavn,etternavn:e.annenForelder.etternavn,fnr:e.annenForelder.fnr,kanIkkeOppgis:!1}:{kanIkkeOppgis:!1},Ze=e=>{const r=ve(e);if(r==="K")return"medmor";if(r==="M")return"far";throw new Error("Kan ikke utlede kjønn fra fødselsnummer.")},lr=e=>{const r=Ee(e),t=Xe(e);return{barn:r,annenForelder:t,erEndringssøknad:!1}},Fe=(e,r,t,n,o,d)=>{const l=r!==void 0?r.fnr:void 0,s={fornavn:e.formatMessage({id:"annen.forelder"}),etternavn:"",fnr:l??"",harRettPåForeldrepengerINorge:t.søkerErFarEllerMedmor?t.morHarRett&&!t.harAnnenForelderTilsvarendeRettEØS:t.farMedmorHarRett&&!t.harAnnenForelderTilsvarendeRettEØS,harRettPåForeldrepengerIEØS:t.harAnnenForelderTilsvarendeRettEØS,kanIkkeOppgis:!1,erMorUfør:t.søkerErFarEllerMedmor?t.morErUfør:void 0,erAleneOmOmsorg:t.farMedmorErAleneOmOmsorg||t.morErAleneOmOmsorg};return We(n,B(t.fødselsdato),t,o,e,d,l)||s},fr=(e,r,t,n)=>{const o=qe(e.sak,void 0,e.fødselsdatoer),{grunnlag:d}=o,l=ue(d.familiehendelseType),s=Ee(e),i=Fe(r,e.sak.annenPart,d,t,l,e.fnr),f=e.sak.sakTilhørerMor?"mor":Ze(n),u={situasjon:e.sak.gjelderAdopsjon?"adopsjon":"fødsel",rolle:f};return{barn:s,annenForelder:i,søkersituasjon:u,erEndringssøknad:!1,dekningsgrad:d.dekningsgrad}},mr=(e,r,t,n,o)=>{const{grunnlag:d,uttaksplan:l}=r,{dekningsgrad:s,familiehendelseType:i,søkerErFarEllerMedmor:f,ønskerJustertUttakVedFødsel:u}=d,a=ue(i),m=ze(a,d,o),R=Qe(e,d),E=Fe(t,n,d,e.barn,a,o==null?void 0:o.fnr);return{søkersituasjon:{situasjon:a,rolle:R},barn:m,annenForelder:{...E,erAleneOmOmsorg:f?d.farMedmorErAleneOmOmsorg:d.morErAleneOmOmsorg},erEndringssøknad:!0,dekningsgrad:s,uttaksplan:l,saksnummer:r.saksnummer,ønskerJustertUttakVedFødsel:u}};export{J as D,N as R,fr as a,lr as b,ar as c,ir as d,sr as g,mr as l,qe as m};
