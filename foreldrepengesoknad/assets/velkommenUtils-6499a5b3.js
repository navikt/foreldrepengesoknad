import{d as s,l as T,I as m,g as u,U as y}from"./Tidsperioden-6fae8955.js";import{e as A,g as L,a as g,b as h}from"./barnUtils-88b1e268.js";import"./jsx-runtime-1caa8f64.js";import"./index-753920cd.js";import"./index-1cdf6ce0.js";import"./_baseToString-2517c4f7.js";import"./_createSet-019d3bf6.js";import{t as M,g as O}from"./dateUtils-961b0658.js";var v=(e=>(e.FØDT="født",e.UFØDT="ufødt",e.ADOPTERT="adoptert",e.IKKE_UTFYLT="ikkeUtfylt",e))(v||{});s.extend(T);s.extend(M);const P=(e,t)=>e?v.ADOPTERT:t.fødselsdato!==void 0?v.FØDT:v.UFØDT,E=(e,t)=>e===void 0||t===void 0?!1:s.utc(e).isSameOrAfter(s(t).subtract(1,"day"),"day")&&s.utc(e).isSameOrBefore(s(t).add(1,"day"),"day"),U=(e,t)=>{const o=e.barn!==void 0?e.barn.map(l=>l.fnr).flat():[],r=m(e.familiehendelse.fødselsdato),i=t.filter(l=>o.includes(l.fnr)),d=r!==void 0?t.filter(l=>E(l.fødselsdato,r)&&!i.find(n=>n.fnr===l.fnr)):[],a=i.concat(d),S=m(O(e.familiehendelse.termindato,e.familiehendelse.fødselsdato,e.familiehendelse.omsorgsovertakelse)),c=P(e.gjelderAdopsjon,e.familiehendelse);let p;return a&&a.length>0?p=a.map(l=>s.utc(l.fødselsdato).toDate()):r!==void 0&&(p=Array(e.familiehendelse.antallBarn).fill(r)),{id:u(),type:c,antallBarn:e.familiehendelse.antallBarn,termindato:m(e.familiehendelse.termindato),omsorgsovertagelse:m(e.familiehendelse.omsorgsovertakelse),kanSøkeOmEndring:e.kanSøkeOmEndring,sak:e,fødselsdatoer:p,familiehendelsesdato:S,sortableDato:m(e.familiehendelse.termindato),startdatoFørsteStønadsperiode:e.gjeldendeVedtak!==void 0&&e.gjeldendeVedtak.perioder.length>0?y(m(e.gjeldendeVedtak.perioder[0].fom)).denneEllerNeste():void 0,fornavn:a!==void 0&&a.length>0?a.filter(l=>l.fornavn!==void 0&&l.fornavn.trim()!=="").map(l=>[l.fornavn,l.mellomnavn!==void 0?l.mellomnavn:""].join(" ")):void 0,fnr:a!==void 0&&a.length>0?a.filter(l=>l.fnr!==void 0).map(l=>l.fnr):void 0,alleBarnaLever:a!==void 0&&a.length>0?a.every(l=>h(l)):!1}},j=(e,t)=>{const o=e.mellomnavn!==void 0?[e.fornavn,e.mellomnavn].join(" "):e.fornavn;return{id:u(),type:v.IKKE_UTFYLT,antallBarn:1,fødselsdatoer:[s.utc(e.fødselsdato).toDate()],fornavn:o!==void 0?[o]:void 0,fnr:[e.fnr],sortableDato:s.utc(e.fødselsdato).toDate(),alleBarnaLever:h(e),annenForelder:t}},b=(e,t,o)=>{const r=[e].concat(t).sort(K);if(!(r.find(d=>!h(d)&&g(d))||r.length==0))return{id:u(),type:v.IKKE_UTFYLT,antallBarn:r.length,fødselsdatoer:r.map(d=>s.utc(d.fødselsdato).toDate()),fornavn:r.map(d=>[d.fornavn,d.mellomnavn!==void 0?d.mellomnavn:""].join(" ")),fnr:r.map(d=>d.fnr),sortableDato:s.utc(r[0].fødselsdato).toDate(),alleBarnaLever:r.every(d=>h(d)),annenForelder:o}},I=(e,t)=>e.filter(o=>o.barn!==void 0&&o.barn.length>0||o.familiehendelse.termindato!==void 0||o.familiehendelse.fødselsdato!==void 0||o.familiehendelse.omsorgsovertakelse!==void 0).map(o=>U(o,t)),k=(e,t,o)=>{const r=e.filter(n=>!o.find(f=>E(n.fødselsdato,m(f.familiehendelse.fødselsdato)))),i="tempFnr",d=r.map(n=>n.fnr===void 0?{...n,fnr:i+u().toString()}:n),a=t.map(n=>n.fnr).flat(),S=t.filter(n=>n.fødselsdatoer!==void 0&&n.fødselsdatoer.length>0).map(n=>n.fødselsdatoer).flat(),c=[];return d.filter(n=>!(n.dødsdato!==void 0&&S.find(f=>s(f).isSame(s.utc(n.fødselsdato),"day")))).forEach(n=>{if(!a.includes(n.fnr)&&!A(n.fødselsdato)){const f=L(n.fnr,n.fødselsdato,d),D=n.annenForelder!==void 0?{fnr:n.annenForelder.fnr,fornavn:n.annenForelder.fornavn,mellomnavn:n.annenForelder.mellomnavn,etternavn:n.annenForelder.etternavn}:void 0;if(a.push(n.fnr),f.length===0){if(!g(n)){const F=j(n,D);c.push(F)}}else{const F=b(n,f,D);f.forEach(B=>{a.push(B.fnr)}),F!==void 0&&c.push(F)}}}),c.map(n=>n.fnr&&n.fnr.length>0?{...n,fnr:n.fnr.filter(f=>f&&!f.startsWith(i))}:n)},w=(e,t)=>{const o=e.filter(a=>!a.sakAvsluttet),r=e.filter(a=>a.sakAvsluttet),i=I(o,t),d=k(t,i,r);return i.concat(d)},C=(e,t)=>{var i,d;const o=t.filter(a=>a.sak!==void 0&&a.id!==e.id&&a.familiehendelsesdato!==void 0&&s(a.familiehendelsesdato).isAfter(e.familiehendelsesdato,"day"));o.sort(R);const r=o[o.length-1];if(r!==void 0)return{familiehendelsesdato:r.familiehendelsesdato,startdatoFørsteStønadsperiode:r.startdatoFørsteStønadsperiode,fnr:r.fnr,annenForelderFnr:(d=(i=r.sak)==null?void 0:i.annenPart)==null?void 0:d.fnr}},K=(e,t)=>s(e.fødselsdato).isAfter(t.fødselsdato,"d")?1:s(e.fødselsdato).isBefore(t.fødselsdato,"d")||e.fornavn<t.fornavn?-1:1,R=(e,t)=>s(e.sortableDato).isBefore(t.sortableDato,"d")?1:s(e.sortableDato).isAfter(t.sortableDato,"d")?-1:0;export{v as V,C as a,E as b,K as c,w as g,R as s};
